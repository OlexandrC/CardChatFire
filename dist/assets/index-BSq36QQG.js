var Cu=Object.defineProperty;var Ru=(s,e,t)=>e in s?Cu(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var he=(s,e,t)=>Ru(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var Kt=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(Kt||{}),zh=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(zh||{}),Rn=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(Rn||{}),oe=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(oe||{}),at=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(at||{}),H=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(H||{}),mr=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(mr||{}),ae=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(ae||{}),j=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(j||{}),pt=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(pt||{}),Mt=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(Mt||{}),lt=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(lt||{}),Oe=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Oe||{}),nt=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(nt||{}),fa=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(fa||{}),Ge=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(Ge||{}),Ce=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(Ce||{}),Se=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(Se||{}),ot=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(ot||{});const Pu={createCanvas:(s,e)=>{const t=document.createElement("canvas");return t.width=s,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,e)=>fetch(s,e),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},q={ADAPTER:Pu,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var os=/iPhone/i,La=/iPod/i,Na=/iPad/i,ka=/\biOS-universal(?:.+)Mac\b/i,hs=/\bAndroid(?:.+)Mobile\b/i,Ua=/Android/i,sr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Kr=/Silk/i,ct=/Windows Phone/i,Ga=/\bWindows(?:.+)ARM\b/i,Ha=/BlackBerry/i,$a=/BB10/i,Xa=/Opera Mini/i,Va=/\b(CriOS|Chrome)(?:.+)Mobile/i,Wa=/Mobile(?:.+)Firefox\b/i,za=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function Mu(s){return function(e){return e.test(s)}}function ja(s){var e={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?e.userAgent=s:s&&s.userAgent&&(e={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var i=Mu(t),n={apple:{phone:i(os)&&!i(ct),ipod:i(La),tablet:!i(os)&&(i(Na)||za(e))&&!i(ct),universal:i(ka),device:(i(os)||i(La)||i(Na)||i(ka)||za(e))&&!i(ct)},amazon:{phone:i(sr),tablet:!i(sr)&&i(Kr),device:i(sr)||i(Kr)},android:{phone:!i(ct)&&i(sr)||!i(ct)&&i(hs),tablet:!i(ct)&&!i(sr)&&!i(hs)&&(i(Kr)||i(Ua)),device:!i(ct)&&(i(sr)||i(Kr)||i(hs)||i(Ua))||i(/\bokhttp\b/i)},windows:{phone:i(ct),tablet:i(Ga),device:i(ct)||i(Ga)},other:{blackberry:i(Ha),blackberry10:i($a),opera:i(Xa),firefox:i(Wa),chrome:i(Va),device:i(Ha)||i($a)||i(Xa)||i(Wa)||i(Va)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Du=ja.default??ja,mt=Du(globalThis.navigator);q.RETINA_PREFIX=/@([0-9\.]+)x/;q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pa(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Bu(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var i=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return s[r]}})}),t}var ls={exports:{}},qa;function Fu(){return qa||(qa=1,function(s){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,f){this.fn=l,this.context=c,this.once=f||!1}function n(l,c,f,o,u){if(typeof f!="function")throw new TypeError("The listener must be a function");var d=new i(f,o||l,u),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],d]:l._events[p].push(d):(l._events[p]=d,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function h(){this._events=new r,this._eventsCount=0}h.prototype.eventNames=function(){var c=[],f,o;if(this._eventsCount===0)return c;for(o in f=this._events)e.call(f,o)&&c.push(t?o.slice(1):o);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},h.prototype.listeners=function(c){var f=t?t+c:c,o=this._events[f];if(!o)return[];if(o.fn)return[o.fn];for(var u=0,d=o.length,p=new Array(d);u<d;u++)p[u]=o[u].fn;return p},h.prototype.listenerCount=function(c){var f=t?t+c:c,o=this._events[f];return o?o.fn?1:o.length:0},h.prototype.emit=function(c,f,o,u,d,p){var _=t?t+c:c;if(!this._events[_])return!1;var m=this._events[_],g=arguments.length,v,y;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),g){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,o),!0;case 4:return m.fn.call(m.context,f,o,u),!0;case 5:return m.fn.call(m.context,f,o,u,d),!0;case 6:return m.fn.call(m.context,f,o,u,d,p),!0}for(y=1,v=new Array(g-1);y<g;y++)v[y-1]=arguments[y];m.fn.apply(m.context,v)}else{var w=m.length,T;for(y=0;y<w;y++)switch(m[y].once&&this.removeListener(c,m[y].fn,void 0,!0),g){case 1:m[y].fn.call(m[y].context);break;case 2:m[y].fn.call(m[y].context,f);break;case 3:m[y].fn.call(m[y].context,f,o);break;case 4:m[y].fn.call(m[y].context,f,o,u);break;default:if(!v)for(T=1,v=new Array(g-1);T<g;T++)v[T-1]=arguments[T];m[y].fn.apply(m[y].context,v)}}return!0},h.prototype.on=function(c,f,o){return n(this,c,f,o,!1)},h.prototype.once=function(c,f,o){return n(this,c,f,o,!0)},h.prototype.removeListener=function(c,f,o,u){var d=t?t+c:c;if(!this._events[d])return this;if(!f)return a(this,d),this;var p=this._events[d];if(p.fn)p.fn===f&&(!u||p.once)&&(!o||p.context===o)&&a(this,d);else{for(var _=0,m=[],g=p.length;_<g;_++)(p[_].fn!==f||u&&!p[_].once||o&&p[_].context!==o)&&m.push(p[_]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},h.prototype.removeAllListeners=function(c){var f;return c?(f=t?t+c:c,this._events[f]&&a(this,f)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,s.exports=h}(ls)),ls.exports}var Ou=Fu();const Vr=pa(Ou);var Zr={exports:{}},Ya;function Lu(){if(Ya)return Zr.exports;Ya=1,Zr.exports=s,Zr.exports.default=s;function s(A,E,x){x=x||2;var P=E&&E.length,S=P?E[0]*x:A.length,I=e(A,0,S,x,!0),O=[];if(!I||I.next===I.prev)return O;var F,G,$,Y,Z,J,ie;if(P&&(I=l(A,E,I,x)),A.length>80*x){F=$=A[0],G=Y=A[1];for(var X=x;X<S;X+=x)Z=A[X],J=A[X+1],Z<F&&(F=Z),J<G&&(G=J),Z>$&&($=Z),J>Y&&(Y=J);ie=Math.max($-F,Y-G),ie=ie!==0?32767/ie:0}return r(I,O,x,F,G,ie,0),O}function e(A,E,x,P,S){var I,O;if(S===z(A,E,x,P)>0)for(I=E;I<x;I+=P)O=C(I,A[I],A[I+1],O);else for(I=x-P;I>=E;I-=P)O=C(I,A[I],A[I+1],O);return O&&w(O,O.next)&&(M(O),O=O.next),O}function t(A,E){if(!A)return A;E||(E=A);var x=A,P;do if(P=!1,!x.steiner&&(w(x,x.next)||y(x.prev,x,x.next)===0)){if(M(x),x=E=x.prev,x===x.next)break;P=!0}else x=x.next;while(P||x!==E);return E}function r(A,E,x,P,S,I,O){if(A){!O&&I&&d(A,P,S,I);for(var F=A,G,$;A.prev!==A.next;){if(G=A.prev,$=A.next,I?n(A,P,S,I):i(A)){E.push(G.i/x|0),E.push(A.i/x|0),E.push($.i/x|0),M(A),A=$.next,F=$.next;continue}if(A=$,A===F){O?O===1?(A=a(t(A),E,x),r(A,E,x,P,S,I,2)):O===2&&h(A,E,x,P,S,I):r(t(A),E,x,P,S,I,1);break}}}}function i(A){var E=A.prev,x=A,P=A.next;if(y(E,x,P)>=0)return!1;for(var S=E.x,I=x.x,O=P.x,F=E.y,G=x.y,$=P.y,Y=S<I?S<O?S:O:I<O?I:O,Z=F<G?F<$?F:$:G<$?G:$,J=S>I?S>O?S:O:I>O?I:O,ie=F>G?F>$?F:$:G>$?G:$,X=P.next;X!==E;){if(X.x>=Y&&X.x<=J&&X.y>=Z&&X.y<=ie&&g(S,F,I,G,O,$,X.x,X.y)&&y(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(A,E,x,P){var S=A.prev,I=A,O=A.next;if(y(S,I,O)>=0)return!1;for(var F=S.x,G=I.x,$=O.x,Y=S.y,Z=I.y,J=O.y,ie=F<G?F<$?F:$:G<$?G:$,X=Y<Z?Y<J?Y:J:Z<J?Z:J,te=F>G?F>$?F:$:G>$?G:$,se=Y>Z?Y>J?Y:J:Z>J?Z:J,le=_(ie,X,E,x,P),pe=_(te,se,E,x,P),re=A.prevZ,ne=A.nextZ;re&&re.z>=le&&ne&&ne.z<=pe;){if(re.x>=ie&&re.x<=te&&re.y>=X&&re.y<=se&&re!==S&&re!==O&&g(F,Y,G,Z,$,J,re.x,re.y)&&y(re.prev,re,re.next)>=0||(re=re.prevZ,ne.x>=ie&&ne.x<=te&&ne.y>=X&&ne.y<=se&&ne!==S&&ne!==O&&g(F,Y,G,Z,$,J,ne.x,ne.y)&&y(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;re&&re.z>=le;){if(re.x>=ie&&re.x<=te&&re.y>=X&&re.y<=se&&re!==S&&re!==O&&g(F,Y,G,Z,$,J,re.x,re.y)&&y(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ne&&ne.z<=pe;){if(ne.x>=ie&&ne.x<=te&&ne.y>=X&&ne.y<=se&&ne!==S&&ne!==O&&g(F,Y,G,Z,$,J,ne.x,ne.y)&&y(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function a(A,E,x){var P=A;do{var S=P.prev,I=P.next.next;!w(S,I)&&T(S,P,P.next,I)&&N(S,I)&&N(I,S)&&(E.push(S.i/x|0),E.push(P.i/x|0),E.push(I.i/x|0),M(P),M(P.next),P=A=I),P=P.next}while(P!==A);return t(P)}function h(A,E,x,P,S,I){var O=A;do{for(var F=O.next.next;F!==O.prev;){if(O.i!==F.i&&v(O,F)){var G=V(O,F);O=t(O,O.next),G=t(G,G.next),r(O,E,x,P,S,I,0),r(G,E,x,P,S,I,0);return}F=F.next}O=O.next}while(O!==A)}function l(A,E,x,P){var S=[],I,O,F,G,$;for(I=0,O=E.length;I<O;I++)F=E[I]*P,G=I<O-1?E[I+1]*P:A.length,$=e(A,F,G,P,!1),$===$.next&&($.steiner=!0),S.push(m($));for(S.sort(c),I=0;I<S.length;I++)x=f(S[I],x);return x}function c(A,E){return A.x-E.x}function f(A,E){var x=o(A,E);if(!x)return E;var P=V(x,A);return t(P,P.next),t(x,x.next)}function o(A,E){var x=E,P=A.x,S=A.y,I=-1/0,O;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var F=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(F<=P&&F>I&&(I=F,O=x.x<x.next.x?x:x.next,F===P))return O}x=x.next}while(x!==E);if(!O)return null;var G=O,$=O.x,Y=O.y,Z=1/0,J;x=O;do P>=x.x&&x.x>=$&&P!==x.x&&g(S<Y?P:I,S,$,Y,S<Y?I:P,S,x.x,x.y)&&(J=Math.abs(S-x.y)/(P-x.x),N(x,A)&&(J<Z||J===Z&&(x.x>O.x||x.x===O.x&&u(O,x)))&&(O=x,Z=J)),x=x.next;while(x!==G);return O}function u(A,E){return y(A.prev,A,E.prev)<0&&y(E.next,A,A.next)<0}function d(A,E,x,P){var S=A;do S.z===0&&(S.z=_(S.x,S.y,E,x,P)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==A);S.prevZ.nextZ=null,S.prevZ=null,p(S)}function p(A){var E,x,P,S,I,O,F,G,$=1;do{for(x=A,A=null,I=null,O=0;x;){for(O++,P=x,F=0,E=0;E<$&&(F++,P=P.nextZ,!!P);E++);for(G=$;F>0||G>0&&P;)F!==0&&(G===0||!P||x.z<=P.z)?(S=x,x=x.nextZ,F--):(S=P,P=P.nextZ,G--),I?I.nextZ=S:A=S,S.prevZ=I,I=S;x=P}I.nextZ=null,$*=2}while(O>1);return A}function _(A,E,x,P,S){return A=(A-x)*S|0,E=(E-P)*S|0,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,E=(E|E<<8)&16711935,E=(E|E<<4)&252645135,E=(E|E<<2)&858993459,E=(E|E<<1)&1431655765,A|E<<1}function m(A){var E=A,x=A;do(E.x<x.x||E.x===x.x&&E.y<x.y)&&(x=E),E=E.next;while(E!==A);return x}function g(A,E,x,P,S,I,O,F){return(S-O)*(E-F)>=(A-O)*(I-F)&&(A-O)*(P-F)>=(x-O)*(E-F)&&(x-O)*(I-F)>=(S-O)*(P-F)}function v(A,E){return A.next.i!==E.i&&A.prev.i!==E.i&&!B(A,E)&&(N(A,E)&&N(E,A)&&U(A,E)&&(y(A.prev,A,E.prev)||y(A,E.prev,E))||w(A,E)&&y(A.prev,A,A.next)>0&&y(E.prev,E,E.next)>0)}function y(A,E,x){return(E.y-A.y)*(x.x-E.x)-(E.x-A.x)*(x.y-E.y)}function w(A,E){return A.x===E.x&&A.y===E.y}function T(A,E,x,P){var S=b(y(A,E,x)),I=b(y(A,E,P)),O=b(y(x,P,A)),F=b(y(x,P,E));return!!(S!==I&&O!==F||S===0&&R(A,x,E)||I===0&&R(A,P,E)||O===0&&R(x,A,P)||F===0&&R(x,E,P))}function R(A,E,x){return E.x<=Math.max(A.x,x.x)&&E.x>=Math.min(A.x,x.x)&&E.y<=Math.max(A.y,x.y)&&E.y>=Math.min(A.y,x.y)}function b(A){return A>0?1:A<0?-1:0}function B(A,E){var x=A;do{if(x.i!==A.i&&x.next.i!==A.i&&x.i!==E.i&&x.next.i!==E.i&&T(x,x.next,A,E))return!0;x=x.next}while(x!==A);return!1}function N(A,E){return y(A.prev,A,A.next)<0?y(A,E,A.next)>=0&&y(A,A.prev,E)>=0:y(A,E,A.prev)<0||y(A,A.next,E)<0}function U(A,E){var x=A,P=!1,S=(A.x+E.x)/2,I=(A.y+E.y)/2;do x.y>I!=x.next.y>I&&x.next.y!==x.y&&S<(x.next.x-x.x)*(I-x.y)/(x.next.y-x.y)+x.x&&(P=!P),x=x.next;while(x!==A);return P}function V(A,E){var x=new k(A.i,A.x,A.y),P=new k(E.i,E.x,E.y),S=A.next,I=E.prev;return A.next=E,E.prev=A,x.next=S,S.prev=x,P.next=x,x.prev=P,I.next=P,P.prev=I,P}function C(A,E,x,P){var S=new k(A,E,x);return P?(S.next=P.next,S.prev=P,P.next.prev=S,P.next=S):(S.prev=S,S.next=S),S}function M(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function k(A,E,x){this.i=A,this.x=E,this.y=x,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}s.deviation=function(A,E,x,P){var S=E&&E.length,I=S?E[0]*x:A.length,O=Math.abs(z(A,0,I,x));if(S)for(var F=0,G=E.length;F<G;F++){var $=E[F]*x,Y=F<G-1?E[F+1]*x:A.length;O-=Math.abs(z(A,$,Y,x))}var Z=0;for(F=0;F<P.length;F+=3){var J=P[F]*x,ie=P[F+1]*x,X=P[F+2]*x;Z+=Math.abs((A[J]-A[X])*(A[ie+1]-A[J+1])-(A[J]-A[ie])*(A[X+1]-A[J+1]))}return O===0&&Z===0?0:Math.abs((Z-O)/O)};function z(A,E,x,P){for(var S=0,I=E,O=x-P;I<x;I+=P)S+=(A[O]-A[I])*(A[I+1]+A[O+1]),O=I;return S}return s.flatten=function(A){for(var E=A[0][0].length,x={vertices:[],holes:[],dimensions:E},P=0,S=0;S<A.length;S++){for(var I=0;I<A[S].length;I++)for(var O=0;O<E;O++)x.vertices.push(A[S][I][O]);S>0&&(P+=A[S-1].length,x.holes.push(P))}return x},Zr.exports}var Nu=Lu();const ku=pa(Nu);var Ot={},Dr={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Uu=Dr.exports,Ka;function Gu(){return Ka||(Ka=1,function(s,e){(function(t){var r=e&&!e.nodeType&&e,i=s&&!s.nodeType&&s,n=typeof ft=="object"&&ft;(n.global===n||n.window===n||n.self===n)&&(t=n);var a,h=2147483647,l=36,c=1,f=26,o=38,u=700,d=72,p=128,_="-",m=/^xn--/,g=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-c,T=Math.floor,R=String.fromCharCode,b;function B(S){throw new RangeError(y[S])}function N(S,I){for(var O=S.length,F=[];O--;)F[O]=I(S[O]);return F}function U(S,I){var O=S.split("@"),F="";O.length>1&&(F=O[0]+"@",S=O[1]),S=S.replace(v,".");var G=S.split("."),$=N(G,I).join(".");return F+$}function V(S){for(var I=[],O=0,F=S.length,G,$;O<F;)G=S.charCodeAt(O++),G>=55296&&G<=56319&&O<F?($=S.charCodeAt(O++),($&64512)==56320?I.push(((G&1023)<<10)+($&1023)+65536):(I.push(G),O--)):I.push(G);return I}function C(S){return N(S,function(I){var O="";return I>65535&&(I-=65536,O+=R(I>>>10&1023|55296),I=56320|I&1023),O+=R(I),O}).join("")}function M(S){return S-48<10?S-22:S-65<26?S-65:S-97<26?S-97:l}function k(S,I){return S+22+75*(S<26)-((I!=0)<<5)}function z(S,I,O){var F=0;for(S=O?T(S/u):S>>1,S+=T(S/I);S>w*f>>1;F+=l)S=T(S/w);return T(F+(w+1)*S/(S+o))}function A(S){var I=[],O=S.length,F,G=0,$=p,Y=d,Z,J,ie,X,te,se,le,pe,re;for(Z=S.lastIndexOf(_),Z<0&&(Z=0),J=0;J<Z;++J)S.charCodeAt(J)>=128&&B("not-basic"),I.push(S.charCodeAt(J));for(ie=Z>0?Z+1:0;ie<O;){for(X=G,te=1,se=l;ie>=O&&B("invalid-input"),le=M(S.charCodeAt(ie++)),(le>=l||le>T((h-G)/te))&&B("overflow"),G+=le*te,pe=se<=Y?c:se>=Y+f?f:se-Y,!(le<pe);se+=l)re=l-pe,te>T(h/re)&&B("overflow"),te*=re;F=I.length+1,Y=z(G-X,F,X==0),T(G/F)>h-$&&B("overflow"),$+=T(G/F),G%=F,I.splice(G++,0,$)}return C(I)}function E(S){var I,O,F,G,$,Y,Z,J,ie,X,te,se=[],le,pe,re,ne;for(S=V(S),le=S.length,I=p,O=0,$=d,Y=0;Y<le;++Y)te=S[Y],te<128&&se.push(R(te));for(F=G=se.length,G&&se.push(_);F<le;){for(Z=h,Y=0;Y<le;++Y)te=S[Y],te>=I&&te<Z&&(Z=te);for(pe=F+1,Z-I>T((h-O)/pe)&&B("overflow"),O+=(Z-I)*pe,I=Z,Y=0;Y<le;++Y)if(te=S[Y],te<I&&++O>h&&B("overflow"),te==I){for(J=O,ie=l;X=ie<=$?c:ie>=$+f?f:ie-$,!(J<X);ie+=l)ne=J-X,re=l-X,se.push(R(k(X+ne%re,0))),J=T(ne/re);se.push(R(k(J,0))),$=z(O,pe,F==G),O=0,++F}++O,++I}return se.join("")}function x(S){return U(S,function(I){return m.test(I)?A(I.slice(4).toLowerCase()):I})}function P(S){return U(S,function(I){return g.test(I)?"xn--"+E(I):I})}if(a={version:"1.4.1",ucs2:{decode:V,encode:C},decode:A,encode:E,toASCII:P,toUnicode:x},r&&i)if(s.exports==r)i.exports=a;else for(b in a)a.hasOwnProperty(b)&&(r[b]=a[b]);else t.punycode=a})(Uu)}(Dr,Dr.exports)),Dr.exports}var us,Za;function Ar(){return Za||(Za=1,us=TypeError),us}const Hu={},$u=Object.freeze(Object.defineProperty({__proto__:null,default:Hu},Symbol.toStringTag,{value:"Module"})),Xu=Bu($u);var cs,Qa;function $i(){if(Qa)return cs;Qa=1;var s=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=s&&e&&typeof e.get=="function"?e.get:null,r=s&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=i&&n&&typeof n.get=="function"?n.get:null,h=i&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,f=typeof WeakSet=="function"&&WeakSet.prototype,o=f?WeakSet.prototype.has:null,u=typeof WeakRef=="function"&&WeakRef.prototype,d=u?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,_=Object.prototype.toString,m=Function.prototype.toString,g=String.prototype.match,v=String.prototype.slice,y=String.prototype.replace,w=String.prototype.toUpperCase,T=String.prototype.toLowerCase,R=RegExp.prototype.test,b=Array.prototype.concat,B=Array.prototype.join,N=Array.prototype.slice,U=Math.floor,V=typeof BigInt=="function"?BigInt.prototype.valueOf:null,C=Object.getOwnPropertySymbols,M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,k=typeof Symbol=="function"&&typeof Symbol.iterator=="object",z=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===k||!0)?Symbol.toStringTag:null,A=Object.prototype.propertyIsEnumerable,E=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(D){return D.__proto__}:null);function x(D,L){if(D===1/0||D===-1/0||D!==D||D&&D>-1e3&&D<1e3||R.call(/e/,L))return L;var ge=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof D=="number"){var _e=D<0?-U(-D):U(D);if(_e!==D){var ye=String(_e),de=v.call(L,ye.length+1);return y.call(ye,ge,"$&_")+"."+y.call(y.call(de,/([0-9]{3})/g,"$&_"),/_$/,"")}}return y.call(L,ge,"$&_")}var P=Xu,S=P.custom,I=pe(S)?S:null,O={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};cs=function D(L,ge,_e,ye){var de=ge||{};if(Ae(de,"quoteStyle")&&!Ae(O,de.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ae(de,"maxStringLength")&&(typeof de.maxStringLength=="number"?de.maxStringLength<0&&de.maxStringLength!==1/0:de.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Tt=Ae(de,"customInspect")?de.customInspect:!0;if(typeof Tt!="boolean"&&Tt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ae(de,"indent")&&de.indent!==null&&de.indent!=="	"&&!(parseInt(de.indent,10)===de.indent&&de.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ae(de,"numericSeparator")&&typeof de.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ft=de.numericSeparator;if(typeof L>"u")return"undefined";if(L===null)return"null";if(typeof L=="boolean")return L?"true":"false";if(typeof L=="string")return Sa(L,de);if(typeof L=="number"){if(L===0)return 1/0/L>0?"0":"-0";var Ne=String(L);return Ft?x(L,Ne):Ne}if(typeof L=="bigint"){var At=String(L)+"n";return Ft?x(L,At):At}var es=typeof de.depth>"u"?5:de.depth;if(typeof _e>"u"&&(_e=0),_e>=es&&es>0&&typeof L=="object")return Z(L)?"[Array]":"[Object]";var rr=Eu(de,_e);if(typeof ye>"u")ye=[];else if(bt(ye,L)>=0)return"[Circular]";function Xe(ir,Yr,Iu){if(Yr&&(ye=N.call(ye),ye.push(Yr)),Iu){var Oa={depth:de.depth};return Ae(de,"quoteStyle")&&(Oa.quoteStyle=de.quoteStyle),D(ir,Oa,_e+1,ye)}return D(ir,de,_e+1,ye)}if(typeof L=="function"&&!ie(L)){var Ca=Qt(L),Ra=jr(L,Xe);return"[Function"+(Ca?": "+Ca:" (anonymous)")+"]"+(Ra.length>0?" { "+B.call(Ra,", ")+" }":"")}if(pe(L)){var Pa=k?y.call(String(L),/^(Symbol\(.*\))_[^)]*$/,"$1"):M.call(L);return typeof L=="object"&&!k?Sr(Pa):Pa}if(Tu(L)){for(var Ir="<"+T.call(String(L.nodeName)),ts=L.attributes||[],qr=0;qr<ts.length;qr++)Ir+=" "+ts[qr].name+"="+G($(ts[qr].value),"double",de);return Ir+=">",L.childNodes&&L.childNodes.length&&(Ir+="..."),Ir+="</"+T.call(String(L.nodeName))+">",Ir}if(Z(L)){if(L.length===0)return"[]";var rs=jr(L,Xe);return rr&&!wu(rs)?"["+Ji(rs,rr)+"]":"[ "+B.call(rs,", ")+" ]"}if(X(L)){var is=jr(L,Xe);return!("cause"in Error.prototype)&&"cause"in L&&!A.call(L,"cause")?"{ ["+String(L)+"] "+B.call(b.call("[cause]: "+Xe(L.cause),is),", ")+" }":is.length===0?"["+String(L)+"]":"{ ["+String(L)+"] "+B.call(is,", ")+" }"}if(typeof L=="object"&&Tt){if(I&&typeof L[I]=="function"&&P)return P(L,{depth:es-_e});if(Tt!=="symbol"&&typeof L.inspect=="function")return L.inspect()}if($e(L)){var Ma=[];return r&&r.call(L,function(ir,Yr){Ma.push(Xe(Yr,L,!0)+" => "+Xe(ir,L))}),Ia("Map",t.call(L),Ma,rr)}if(tr(L)){var Da=[];return h&&h.call(L,function(ir){Da.push(Xe(ir,L))}),Ia("Set",a.call(L),Da,rr)}if(Jt(L))return Qi("WeakMap");if(bu(L))return Qi("WeakSet");if(er(L))return Qi("WeakRef");if(se(L))return Sr(Xe(Number(L)));if(re(L))return Sr(Xe(V.call(L)));if(le(L))return Sr(p.call(L));if(te(L))return Sr(Xe(String(L)));if(typeof window<"u"&&L===window)return"{ [object Window] }";if(typeof globalThis<"u"&&L===globalThis||typeof ft<"u"&&L===ft)return"{ [object globalThis] }";if(!J(L)&&!ie(L)){var ss=jr(L,Xe),Ba=E?E(L)===Object.prototype:L instanceof Object||L.constructor===Object,ns=L instanceof Object?"":"null prototype",Fa=!Ba&&z&&Object(L)===L&&z in L?v.call(Ie(L),8,-1):ns?"Object":"",Su=Ba||typeof L.constructor!="function"?"":L.constructor.name?L.constructor.name+" ":"",as=Su+(Fa||ns?"["+B.call(b.call([],Fa||[],ns||[]),": ")+"] ":"");return ss.length===0?as+"{}":rr?as+"{"+Ji(ss,rr)+"}":as+"{ "+B.call(ss,", ")+" }"}return String(L)};function G(D,L,ge){var _e=ge.quoteStyle||L,ye=O[_e];return ye+D+ye}function $(D){return y.call(String(D),/"/g,"&quot;")}function Y(D){return!z||!(typeof D=="object"&&(z in D||typeof D[z]<"u"))}function Z(D){return Ie(D)==="[object Array]"&&Y(D)}function J(D){return Ie(D)==="[object Date]"&&Y(D)}function ie(D){return Ie(D)==="[object RegExp]"&&Y(D)}function X(D){return Ie(D)==="[object Error]"&&Y(D)}function te(D){return Ie(D)==="[object String]"&&Y(D)}function se(D){return Ie(D)==="[object Number]"&&Y(D)}function le(D){return Ie(D)==="[object Boolean]"&&Y(D)}function pe(D){if(k)return D&&typeof D=="object"&&D instanceof Symbol;if(typeof D=="symbol")return!0;if(!D||typeof D!="object"||!M)return!1;try{return M.call(D),!0}catch{}return!1}function re(D){if(!D||typeof D!="object"||!V)return!1;try{return V.call(D),!0}catch{}return!1}var ne=Object.prototype.hasOwnProperty||function(D){return D in this};function Ae(D,L){return ne.call(D,L)}function Ie(D){return _.call(D)}function Qt(D){if(D.name)return D.name;var L=g.call(m.call(D),/^function\s*([\w$]+)/);return L?L[1]:null}function bt(D,L){if(D.indexOf)return D.indexOf(L);for(var ge=0,_e=D.length;ge<_e;ge++)if(D[ge]===L)return ge;return-1}function $e(D){if(!t||!D||typeof D!="object")return!1;try{t.call(D);try{a.call(D)}catch{return!0}return D instanceof Map}catch{}return!1}function Jt(D){if(!c||!D||typeof D!="object")return!1;try{c.call(D,c);try{o.call(D,o)}catch{return!0}return D instanceof WeakMap}catch{}return!1}function er(D){if(!d||!D||typeof D!="object")return!1;try{return d.call(D),!0}catch{}return!1}function tr(D){if(!a||!D||typeof D!="object")return!1;try{a.call(D);try{t.call(D)}catch{return!0}return D instanceof Set}catch{}return!1}function bu(D){if(!o||!D||typeof D!="object")return!1;try{o.call(D,o);try{c.call(D,c)}catch{return!0}return D instanceof WeakSet}catch{}return!1}function Tu(D){return!D||typeof D!="object"?!1:typeof HTMLElement<"u"&&D instanceof HTMLElement?!0:typeof D.nodeName=="string"&&typeof D.getAttribute=="function"}function Sa(D,L){if(D.length>L.maxStringLength){var ge=D.length-L.maxStringLength,_e="... "+ge+" more character"+(ge>1?"s":"");return Sa(v.call(D,0,L.maxStringLength),L)+_e}var ye=F[L.quoteStyle||"single"];ye.lastIndex=0;var de=y.call(y.call(D,ye,"\\$1"),/[\x00-\x1f]/g,Au);return G(de,"single",L)}function Au(D){var L=D.charCodeAt(0),ge={8:"b",9:"t",10:"n",12:"f",13:"r"}[L];return ge?"\\"+ge:"\\x"+(L<16?"0":"")+w.call(L.toString(16))}function Sr(D){return"Object("+D+")"}function Qi(D){return D+" { ? }"}function Ia(D,L,ge,_e){var ye=_e?Ji(ge,_e):B.call(ge,", ");return D+" ("+L+") {"+ye+"}"}function wu(D){for(var L=0;L<D.length;L++)if(bt(D[L],`
`)>=0)return!1;return!0}function Eu(D,L){var ge;if(D.indent==="	")ge="	";else if(typeof D.indent=="number"&&D.indent>0)ge=B.call(Array(D.indent+1)," ");else return null;return{base:ge,prev:B.call(Array(L+1),ge)}}function Ji(D,L){if(D.length===0)return"";var ge=`
`+L.prev+L.base;return ge+B.call(D,","+ge)+`
`+L.prev}function jr(D,L){var ge=Z(D),_e=[];if(ge){_e.length=D.length;for(var ye=0;ye<D.length;ye++)_e[ye]=Ae(D,ye)?L(D[ye],D):""}var de=typeof C=="function"?C(D):[],Tt;if(k){Tt={};for(var Ft=0;Ft<de.length;Ft++)Tt["$"+de[Ft]]=de[Ft]}for(var Ne in D)Ae(D,Ne)&&(ge&&String(Number(Ne))===Ne&&Ne<D.length||k&&Tt["$"+Ne]instanceof Symbol||(R.call(/[^\w$]/,Ne)?_e.push(L(Ne,D)+": "+L(D[Ne],D)):_e.push(Ne+": "+L(D[Ne],D))));if(typeof C=="function")for(var At=0;At<de.length;At++)A.call(D,de[At])&&_e.push("["+L(de[At])+"]: "+L(D[de[At]],D));return _e}return cs}var ds,Ja;function Vu(){if(Ja)return ds;Ja=1;var s=$i(),e=Ar(),t=function(h,l,c){for(var f=h,o;(o=f.next)!=null;f=o)if(o.key===l)return f.next=o.next,c||(o.next=h.next,h.next=o),o},r=function(h,l){if(h){var c=t(h,l);return c&&c.value}},i=function(h,l,c){var f=t(h,l);f?f.value=c:h.next={key:l,next:h.next,value:c}},n=function(h,l){return h?!!t(h,l):!1},a=function(h,l){if(h)return t(h,l,!0)};return ds=function(){var l,c={assert:function(f){if(!c.has(f))throw new e("Side channel does not contain "+s(f))},delete:function(f){var o=l&&l.next,u=a(l,f);return u&&o&&o===u&&(l=void 0),!!u},get:function(f){return r(l,f)},has:function(f){return n(l,f)},set:function(f,o){l||(l={next:void 0}),i(l,f,o)}};return c},ds}var fs,eo;function jh(){return eo||(eo=1,fs=Object),fs}var ps,to;function Wu(){return to||(to=1,ps=Error),ps}var ms,ro;function zu(){return ro||(ro=1,ms=EvalError),ms}var gs,io;function ju(){return io||(io=1,gs=RangeError),gs}var _s,so;function qu(){return so||(so=1,_s=ReferenceError),_s}var ys,no;function Yu(){return no||(no=1,ys=SyntaxError),ys}var vs,ao;function Ku(){return ao||(ao=1,vs=URIError),vs}var xs,oo;function Zu(){return oo||(oo=1,xs=Math.abs),xs}var bs,ho;function Qu(){return ho||(ho=1,bs=Math.floor),bs}var Ts,lo;function Ju(){return lo||(lo=1,Ts=Math.max),Ts}var As,uo;function ec(){return uo||(uo=1,As=Math.min),As}var ws,co;function tc(){return co||(co=1,ws=Math.pow),ws}var Es,fo;function rc(){return fo||(fo=1,Es=Math.round),Es}var Ss,po;function ic(){return po||(po=1,Ss=Number.isNaN||function(e){return e!==e}),Ss}var Is,mo;function sc(){if(mo)return Is;mo=1;var s=ic();return Is=function(t){return s(t)||t===0?t:t<0?-1:1},Is}var Cs,go;function nc(){return go||(go=1,Cs=Object.getOwnPropertyDescriptor),Cs}var Rs,_o;function qh(){if(_o)return Rs;_o=1;var s=nc();if(s)try{s([],"length")}catch{s=null}return Rs=s,Rs}var Ps,yo;function ac(){if(yo)return Ps;yo=1;var s=Object.defineProperty||!1;if(s)try{s({},"a",{value:1})}catch{s=!1}return Ps=s,Ps}var Ms,vo;function oc(){return vo||(vo=1,Ms=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(e,t);if(h.value!==i||h.enumerable!==!0)return!1}return!0}),Ms}var Ds,xo;function hc(){if(xo)return Ds;xo=1;var s=typeof Symbol<"u"&&Symbol,e=oc();return Ds=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Ds}var Bs,bo;function Yh(){return bo||(bo=1,Bs=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Bs}var Fs,To;function Kh(){if(To)return Fs;To=1;var s=jh();return Fs=s.getPrototypeOf||null,Fs}var Os,Ao;function lc(){if(Ao)return Os;Ao=1;var s="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(l,c){for(var f=[],o=0;o<l.length;o+=1)f[o]=l[o];for(var u=0;u<c.length;u+=1)f[u+l.length]=c[u];return f},n=function(l,c){for(var f=[],o=c,u=0;o<l.length;o+=1,u+=1)f[u]=l[o];return f},a=function(h,l){for(var c="",f=0;f<h.length;f+=1)c+=h[f],f+1<h.length&&(c+=l);return c};return Os=function(l){var c=this;if(typeof c!="function"||e.apply(c)!==r)throw new TypeError(s+c);for(var f=n(arguments,1),o,u=function(){if(this instanceof o){var g=c.apply(this,i(f,arguments));return Object(g)===g?g:this}return c.apply(l,i(f,arguments))},d=t(0,c.length-f.length),p=[],_=0;_<d;_++)p[_]="$"+_;if(o=Function("binder","return function ("+a(p,",")+"){ return binder.apply(this,arguments); }")(u),c.prototype){var m=function(){};m.prototype=c.prototype,o.prototype=new m,m.prototype=null}return o},Os}var Ls,wo;function Xi(){if(wo)return Ls;wo=1;var s=lc();return Ls=Function.prototype.bind||s,Ls}var Ns,Eo;function ma(){return Eo||(Eo=1,Ns=Function.prototype.call),Ns}var ks,So;function Zh(){return So||(So=1,ks=Function.prototype.apply),ks}var Us,Io;function uc(){return Io||(Io=1,Us=typeof Reflect<"u"&&Reflect&&Reflect.apply),Us}var Gs,Co;function cc(){if(Co)return Gs;Co=1;var s=Xi(),e=Zh(),t=ma(),r=uc();return Gs=r||s.call(t,e),Gs}var Hs,Ro;function Qh(){if(Ro)return Hs;Ro=1;var s=Xi(),e=Ar(),t=ma(),r=cc();return Hs=function(n){if(n.length<1||typeof n[0]!="function")throw new e("a function is required");return r(s,t,n)},Hs}var $s,Po;function dc(){if(Po)return $s;Po=1;var s=Qh(),e=qh(),t;try{t=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,n=i.getPrototypeOf;return $s=r&&typeof r.get=="function"?s([r.get]):typeof n=="function"?function(h){return n(h==null?h:i(h))}:!1,$s}var Xs,Mo;function fc(){if(Mo)return Xs;Mo=1;var s=Yh(),e=Kh(),t=dc();return Xs=s?function(i){return s(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,Xs}var Vs,Do;function pc(){if(Do)return Vs;Do=1;var s=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Xi();return Vs=t.call(s,e),Vs}var Ws,Bo;function ga(){if(Bo)return Ws;Bo=1;var s,e=jh(),t=Wu(),r=zu(),i=ju(),n=qu(),a=Yu(),h=Ar(),l=Ku(),c=Zu(),f=Qu(),o=Ju(),u=ec(),d=tc(),p=rc(),_=sc(),m=Function,g=function(ie){try{return m('"use strict"; return ('+ie+").constructor;")()}catch{}},v=qh(),y=ac(),w=function(){throw new h},T=v?function(){try{return arguments.callee,w}catch{try{return v(arguments,"callee").get}catch{return w}}}():w,R=hc()(),b=fc(),B=Kh(),N=Yh(),U=Zh(),V=ma(),C={},M=typeof Uint8Array>"u"||!b?s:b(Uint8Array),k={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?s:ArrayBuffer,"%ArrayIteratorPrototype%":R&&b?b([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":C,"%AsyncGenerator%":C,"%AsyncGeneratorFunction%":C,"%AsyncIteratorPrototype%":C,"%Atomics%":typeof Atomics>"u"?s:Atomics,"%BigInt%":typeof BigInt>"u"?s:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?s:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?s:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?s:Float16Array,"%Float32Array%":typeof Float32Array>"u"?s:Float32Array,"%Float64Array%":typeof Float64Array>"u"?s:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?s:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":C,"%Int8Array%":typeof Int8Array>"u"?s:Int8Array,"%Int16Array%":typeof Int16Array>"u"?s:Int16Array,"%Int32Array%":typeof Int32Array>"u"?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":R&&b?b(b([][Symbol.iterator]())):s,"%JSON%":typeof JSON=="object"?JSON:s,"%Map%":typeof Map>"u"?s:Map,"%MapIteratorPrototype%":typeof Map>"u"||!R||!b?s:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":v,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?s:Promise,"%Proxy%":typeof Proxy>"u"?s:Proxy,"%RangeError%":i,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?s:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?s:Set,"%SetIteratorPrototype%":typeof Set>"u"||!R||!b?s:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":R&&b?b(""[Symbol.iterator]()):s,"%Symbol%":R?Symbol:s,"%SyntaxError%":a,"%ThrowTypeError%":T,"%TypedArray%":M,"%TypeError%":h,"%Uint8Array%":typeof Uint8Array>"u"?s:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?s:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?s:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?s:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?s:WeakMap,"%WeakRef%":typeof WeakRef>"u"?s:WeakRef,"%WeakSet%":typeof WeakSet>"u"?s:WeakSet,"%Function.prototype.call%":V,"%Function.prototype.apply%":U,"%Object.defineProperty%":y,"%Object.getPrototypeOf%":B,"%Math.abs%":c,"%Math.floor%":f,"%Math.max%":o,"%Math.min%":u,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":_,"%Reflect.getPrototypeOf%":N};if(b)try{null.error}catch(ie){var z=b(b(ie));k["%Error.prototype%"]=z}var A=function ie(X){var te;if(X==="%AsyncFunction%")te=g("async function () {}");else if(X==="%GeneratorFunction%")te=g("function* () {}");else if(X==="%AsyncGeneratorFunction%")te=g("async function* () {}");else if(X==="%AsyncGenerator%"){var se=ie("%AsyncGeneratorFunction%");se&&(te=se.prototype)}else if(X==="%AsyncIteratorPrototype%"){var le=ie("%AsyncGenerator%");le&&b&&(te=b(le.prototype))}return k[X]=te,te},E={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},x=Xi(),P=pc(),S=x.call(V,Array.prototype.concat),I=x.call(U,Array.prototype.splice),O=x.call(V,String.prototype.replace),F=x.call(V,String.prototype.slice),G=x.call(V,RegExp.prototype.exec),$=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,Z=function(X){var te=F(X,0,1),se=F(X,-1);if(te==="%"&&se!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(se==="%"&&te!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var le=[];return O(X,$,function(pe,re,ne,Ae){le[le.length]=ne?O(Ae,Y,"$1"):re||pe}),le},J=function(X,te){var se=X,le;if(P(E,se)&&(le=E[se],se="%"+le[0]+"%"),P(k,se)){var pe=k[se];if(pe===C&&(pe=A(se)),typeof pe>"u"&&!te)throw new h("intrinsic "+X+" exists, but is not available. Please file an issue!");return{alias:le,name:se,value:pe}}throw new a("intrinsic "+X+" does not exist!")};return Ws=function(X,te){if(typeof X!="string"||X.length===0)throw new h("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof te!="boolean")throw new h('"allowMissing" argument must be a boolean');if(G(/^%?[^%]*%?$/,X)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var se=Z(X),le=se.length>0?se[0]:"",pe=J("%"+le+"%",te),re=pe.name,ne=pe.value,Ae=!1,Ie=pe.alias;Ie&&(le=Ie[0],I(se,S([0,1],Ie)));for(var Qt=1,bt=!0;Qt<se.length;Qt+=1){var $e=se[Qt],Jt=F($e,0,1),er=F($e,-1);if((Jt==='"'||Jt==="'"||Jt==="`"||er==='"'||er==="'"||er==="`")&&Jt!==er)throw new a("property names with quotes must have matching quotes");if(($e==="constructor"||!bt)&&(Ae=!0),le+="."+$e,re="%"+le+"%",P(k,re))ne=k[re];else if(ne!=null){if(!($e in ne)){if(!te)throw new h("base intrinsic for "+X+" exists, but the property is not available.");return}if(v&&Qt+1>=se.length){var tr=v(ne,$e);bt=!!tr,bt&&"get"in tr&&!("originalValue"in tr.get)?ne=tr.get:ne=ne[$e]}else bt=P(ne,$e),ne=ne[$e];bt&&!Ae&&(k[re]=ne)}}return ne},Ws}var zs,Fo;function Jh(){if(Fo)return zs;Fo=1;var s=ga(),e=Qh(),t=e([s("%String.prototype.indexOf%")]);return zs=function(i,n){var a=s(i,!!n);return typeof a=="function"&&t(i,".prototype.")>-1?e([a]):a},zs}var js,Oo;function el(){if(Oo)return js;Oo=1;var s=ga(),e=Jh(),t=$i(),r=Ar(),i=s("%Map%",!0),n=e("Map.prototype.get",!0),a=e("Map.prototype.set",!0),h=e("Map.prototype.has",!0),l=e("Map.prototype.delete",!0),c=e("Map.prototype.size",!0);return js=!!i&&function(){var o,u={assert:function(d){if(!u.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(o){var p=l(o,d);return c(o)===0&&(o=void 0),p}return!1},get:function(d){if(o)return n(o,d)},has:function(d){return o?h(o,d):!1},set:function(d,p){o||(o=new i),a(o,d,p)}};return u},js}var qs,Lo;function mc(){if(Lo)return qs;Lo=1;var s=ga(),e=Jh(),t=$i(),r=el(),i=Ar(),n=s("%WeakMap%",!0),a=e("WeakMap.prototype.get",!0),h=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),c=e("WeakMap.prototype.delete",!0);return qs=n?function(){var o,u,d={assert:function(p){if(!d.has(p))throw new i("Side channel does not contain "+t(p))},delete:function(p){if(n&&p&&(typeof p=="object"||typeof p=="function")){if(o)return c(o,p)}else if(r&&u)return u.delete(p);return!1},get:function(p){return n&&p&&(typeof p=="object"||typeof p=="function")&&o?a(o,p):u&&u.get(p)},has:function(p){return n&&p&&(typeof p=="object"||typeof p=="function")&&o?l(o,p):!!u&&u.has(p)},set:function(p,_){n&&p&&(typeof p=="object"||typeof p=="function")?(o||(o=new n),h(o,p,_)):r&&(u||(u=r()),u.set(p,_))}};return d}:r,qs}var Ys,No;function gc(){if(No)return Ys;No=1;var s=Ar(),e=$i(),t=Vu(),r=el(),i=mc(),n=i||r||t;return Ys=function(){var h,l={assert:function(c){if(!l.has(c))throw new s("Side channel does not contain "+e(c))},delete:function(c){return!!h&&h.delete(c)},get:function(c){return h&&h.get(c)},has:function(c){return!!h&&h.has(c)},set:function(c,f){h||(h=n()),h.set(c,f)}};return l},Ys}var Ks,ko;function _a(){if(ko)return Ks;ko=1;var s=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Ks={default:t.RFC3986,formatters:{RFC1738:function(r){return s.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},Ks}var Zs,Uo;function tl(){if(Uo)return Zs;Uo=1;var s=_a(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var m=[],g=0;g<256;++g)m.push("%"+((g<16?"0":"")+g.toString(16)).toUpperCase());return m}(),i=function(g){for(;g.length>1;){var v=g.pop(),y=v.obj[v.prop];if(t(y)){for(var w=[],T=0;T<y.length;++T)typeof y[T]<"u"&&w.push(y[T]);v.obj[v.prop]=w}}},n=function(g,v){for(var y=v&&v.plainObjects?{__proto__:null}:{},w=0;w<g.length;++w)typeof g[w]<"u"&&(y[w]=g[w]);return y},a=function m(g,v,y){if(!v)return g;if(typeof v!="object"&&typeof v!="function"){if(t(g))g.push(v);else if(g&&typeof g=="object")(y&&(y.plainObjects||y.allowPrototypes)||!e.call(Object.prototype,v))&&(g[v]=!0);else return[g,v];return g}if(!g||typeof g!="object")return[g].concat(v);var w=g;return t(g)&&!t(v)&&(w=n(g,y)),t(g)&&t(v)?(v.forEach(function(T,R){if(e.call(g,R)){var b=g[R];b&&typeof b=="object"&&T&&typeof T=="object"?g[R]=m(b,T,y):g.push(T)}else g[R]=T}),g):Object.keys(v).reduce(function(T,R){var b=v[R];return e.call(T,R)?T[R]=m(T[R],b,y):T[R]=b,T},w)},h=function(g,v){return Object.keys(v).reduce(function(y,w){return y[w]=v[w],y},g)},l=function(m,g,v){var y=m.replace(/\+/g," ");if(v==="iso-8859-1")return y.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(y)}catch{return y}},c=1024,f=function(g,v,y,w,T){if(g.length===0)return g;var R=g;if(typeof g=="symbol"?R=Symbol.prototype.toString.call(g):typeof g!="string"&&(R=String(g)),y==="iso-8859-1")return escape(R).replace(/%u[0-9a-f]{4}/gi,function(M){return"%26%23"+parseInt(M.slice(2),16)+"%3B"});for(var b="",B=0;B<R.length;B+=c){for(var N=R.length>=c?R.slice(B,B+c):R,U=[],V=0;V<N.length;++V){var C=N.charCodeAt(V);if(C===45||C===46||C===95||C===126||C>=48&&C<=57||C>=65&&C<=90||C>=97&&C<=122||T===s.RFC1738&&(C===40||C===41)){U[U.length]=N.charAt(V);continue}if(C<128){U[U.length]=r[C];continue}if(C<2048){U[U.length]=r[192|C>>6]+r[128|C&63];continue}if(C<55296||C>=57344){U[U.length]=r[224|C>>12]+r[128|C>>6&63]+r[128|C&63];continue}V+=1,C=65536+((C&1023)<<10|N.charCodeAt(V)&1023),U[U.length]=r[240|C>>18]+r[128|C>>12&63]+r[128|C>>6&63]+r[128|C&63]}b+=U.join("")}return b},o=function(g){for(var v=[{obj:{o:g},prop:"o"}],y=[],w=0;w<v.length;++w)for(var T=v[w],R=T.obj[T.prop],b=Object.keys(R),B=0;B<b.length;++B){var N=b[B],U=R[N];typeof U=="object"&&U!==null&&y.indexOf(U)===-1&&(v.push({obj:R,prop:N}),y.push(U))}return i(v),g},u=function(g){return Object.prototype.toString.call(g)==="[object RegExp]"},d=function(g){return!g||typeof g!="object"?!1:!!(g.constructor&&g.constructor.isBuffer&&g.constructor.isBuffer(g))},p=function(g,v){return[].concat(g,v)},_=function(g,v){if(t(g)){for(var y=[],w=0;w<g.length;w+=1)y.push(v(g[w]));return y}return v(g)};return Zs={arrayToObject:n,assign:h,combine:p,compact:o,decode:l,encode:f,isBuffer:d,isRegExp:u,maybeMap:_,merge:a},Zs}var Qs,Go;function _c(){if(Go)return Qs;Go=1;var s=gc(),e=tl(),t=_a(),r=Object.prototype.hasOwnProperty,i={brackets:function(m){return m+"[]"},comma:"comma",indices:function(m,g){return m+"["+g+"]"},repeat:function(m){return m}},n=Array.isArray,a=Array.prototype.push,h=function(_,m){a.apply(_,n(m)?m:[m])},l=Date.prototype.toISOString,c=t.default,f={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:c,formatter:t.formatters[c],indices:!1,serializeDate:function(m){return l.call(m)},skipNulls:!1,strictNullHandling:!1},o=function(m){return typeof m=="string"||typeof m=="number"||typeof m=="boolean"||typeof m=="symbol"||typeof m=="bigint"},u={},d=function _(m,g,v,y,w,T,R,b,B,N,U,V,C,M,k,z,A,E){for(var x=m,P=E,S=0,I=!1;(P=P.get(u))!==void 0&&!I;){var O=P.get(m);if(S+=1,typeof O<"u"){if(O===S)throw new RangeError("Cyclic object value");I=!0}typeof P.get(u)>"u"&&(S=0)}if(typeof N=="function"?x=N(g,x):x instanceof Date?x=C(x):v==="comma"&&n(x)&&(x=e.maybeMap(x,function(re){return re instanceof Date?C(re):re})),x===null){if(T)return B&&!z?B(g,f.encoder,A,"key",M):g;x=""}if(o(x)||e.isBuffer(x)){if(B){var F=z?g:B(g,f.encoder,A,"key",M);return[k(F)+"="+k(B(x,f.encoder,A,"value",M))]}return[k(g)+"="+k(String(x))]}var G=[];if(typeof x>"u")return G;var $;if(v==="comma"&&n(x))z&&B&&(x=e.maybeMap(x,B)),$=[{value:x.length>0?x.join(",")||null:void 0}];else if(n(N))$=N;else{var Y=Object.keys(x);$=U?Y.sort(U):Y}var Z=b?String(g).replace(/\./g,"%2E"):String(g),J=y&&n(x)&&x.length===1?Z+"[]":Z;if(w&&n(x)&&x.length===0)return J+"[]";for(var ie=0;ie<$.length;++ie){var X=$[ie],te=typeof X=="object"&&X&&typeof X.value<"u"?X.value:x[X];if(!(R&&te===null)){var se=V&&b?String(X).replace(/\./g,"%2E"):String(X),le=n(x)?typeof v=="function"?v(J,se):J:J+(V?"."+se:"["+se+"]");E.set(m,S);var pe=s();pe.set(u,E),h(G,_(te,le,v,y,w,T,R,b,v==="comma"&&z&&n(x)?null:B,N,U,V,C,M,k,z,A,pe))}}return G},p=function(m){if(!m)return f;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.encodeDotInKeys<"u"&&typeof m.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(m.encoder!==null&&typeof m.encoder<"u"&&typeof m.encoder!="function")throw new TypeError("Encoder has to be a function.");var g=m.charset||f.charset;if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var v=t.default;if(typeof m.format<"u"){if(!r.call(t.formatters,m.format))throw new TypeError("Unknown format option provided.");v=m.format}var y=t.formatters[v],w=f.filter;(typeof m.filter=="function"||n(m.filter))&&(w=m.filter);var T;if(m.arrayFormat in i?T=m.arrayFormat:"indices"in m?T=m.indices?"indices":"repeat":T=f.arrayFormat,"commaRoundTrip"in m&&typeof m.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var R=typeof m.allowDots>"u"?m.encodeDotInKeys===!0?!0:f.allowDots:!!m.allowDots;return{addQueryPrefix:typeof m.addQueryPrefix=="boolean"?m.addQueryPrefix:f.addQueryPrefix,allowDots:R,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:f.allowEmptyArrays,arrayFormat:T,charset:g,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:f.charsetSentinel,commaRoundTrip:!!m.commaRoundTrip,delimiter:typeof m.delimiter>"u"?f.delimiter:m.delimiter,encode:typeof m.encode=="boolean"?m.encode:f.encode,encodeDotInKeys:typeof m.encodeDotInKeys=="boolean"?m.encodeDotInKeys:f.encodeDotInKeys,encoder:typeof m.encoder=="function"?m.encoder:f.encoder,encodeValuesOnly:typeof m.encodeValuesOnly=="boolean"?m.encodeValuesOnly:f.encodeValuesOnly,filter:w,format:v,formatter:y,serializeDate:typeof m.serializeDate=="function"?m.serializeDate:f.serializeDate,skipNulls:typeof m.skipNulls=="boolean"?m.skipNulls:f.skipNulls,sort:typeof m.sort=="function"?m.sort:null,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:f.strictNullHandling}};return Qs=function(_,m){var g=_,v=p(m),y,w;typeof v.filter=="function"?(w=v.filter,g=w("",g)):n(v.filter)&&(w=v.filter,y=w);var T=[];if(typeof g!="object"||g===null)return"";var R=i[v.arrayFormat],b=R==="comma"&&v.commaRoundTrip;y||(y=Object.keys(g)),v.sort&&y.sort(v.sort);for(var B=s(),N=0;N<y.length;++N){var U=y[N],V=g[U];v.skipNulls&&V===null||h(T,d(V,U,R,b,v.allowEmptyArrays,v.strictNullHandling,v.skipNulls,v.encodeDotInKeys,v.encode?v.encoder:null,v.filter,v.sort,v.allowDots,v.serializeDate,v.format,v.formatter,v.encodeValuesOnly,v.charset,B))}var C=T.join(v.delimiter),M=v.addQueryPrefix===!0?"?":"";return v.charsetSentinel&&(v.charset==="iso-8859-1"?M+="utf8=%26%2310003%3B&":M+="utf8=%E2%9C%93&"),C.length>0?M+C:""},Qs}var Js,Ho;function yc(){if(Ho)return Js;Ho=1;var s=tl(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:s.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(u){return u.replace(/&#(\d+);/g,function(d,p){return String.fromCharCode(parseInt(p,10))})},n=function(u,d,p){if(u&&typeof u=="string"&&d.comma&&u.indexOf(",")>-1)return u.split(",");if(d.throwOnLimitExceeded&&p>=d.arrayLimit)throw new RangeError("Array limit exceeded. Only "+d.arrayLimit+" element"+(d.arrayLimit===1?"":"s")+" allowed in an array.");return u},a="utf8=%26%2310003%3B",h="utf8=%E2%9C%93",l=function(d,p){var _={__proto__:null},m=p.ignoreQueryPrefix?d.replace(/^\?/,""):d;m=m.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var g=p.parameterLimit===1/0?void 0:p.parameterLimit,v=m.split(p.delimiter,p.throwOnLimitExceeded?g+1:g);if(p.throwOnLimitExceeded&&v.length>g)throw new RangeError("Parameter limit exceeded. Only "+g+" parameter"+(g===1?"":"s")+" allowed.");var y=-1,w,T=p.charset;if(p.charsetSentinel)for(w=0;w<v.length;++w)v[w].indexOf("utf8=")===0&&(v[w]===h?T="utf-8":v[w]===a&&(T="iso-8859-1"),y=w,w=v.length);for(w=0;w<v.length;++w)if(w!==y){var R=v[w],b=R.indexOf("]="),B=b===-1?R.indexOf("="):b+1,N,U;B===-1?(N=p.decoder(R,r.decoder,T,"key"),U=p.strictNullHandling?null:""):(N=p.decoder(R.slice(0,B),r.decoder,T,"key"),U=s.maybeMap(n(R.slice(B+1),p,t(_[N])?_[N].length:0),function(C){return p.decoder(C,r.decoder,T,"value")})),U&&p.interpretNumericEntities&&T==="iso-8859-1"&&(U=i(String(U))),R.indexOf("[]=")>-1&&(U=t(U)?[U]:U);var V=e.call(_,N);V&&p.duplicates==="combine"?_[N]=s.combine(_[N],U):(!V||p.duplicates==="last")&&(_[N]=U)}return _},c=function(u,d,p,_){var m=0;if(u.length>0&&u[u.length-1]==="[]"){var g=u.slice(0,-1).join("");m=Array.isArray(d)&&d[g]?d[g].length:0}for(var v=_?d:n(d,p,m),y=u.length-1;y>=0;--y){var w,T=u[y];if(T==="[]"&&p.parseArrays)w=p.allowEmptyArrays&&(v===""||p.strictNullHandling&&v===null)?[]:s.combine([],v);else{w=p.plainObjects?{__proto__:null}:{};var R=T.charAt(0)==="["&&T.charAt(T.length-1)==="]"?T.slice(1,-1):T,b=p.decodeDotInKeys?R.replace(/%2E/g,"."):R,B=parseInt(b,10);!p.parseArrays&&b===""?w={0:v}:!isNaN(B)&&T!==b&&String(B)===b&&B>=0&&p.parseArrays&&B<=p.arrayLimit?(w=[],w[B]=v):b!=="__proto__"&&(w[b]=v)}v=w}return v},f=function(d,p,_,m){if(d){var g=_.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,v=/(\[[^[\]]*])/,y=/(\[[^[\]]*])/g,w=_.depth>0&&v.exec(g),T=w?g.slice(0,w.index):g,R=[];if(T){if(!_.plainObjects&&e.call(Object.prototype,T)&&!_.allowPrototypes)return;R.push(T)}for(var b=0;_.depth>0&&(w=y.exec(g))!==null&&b<_.depth;){if(b+=1,!_.plainObjects&&e.call(Object.prototype,w[1].slice(1,-1))&&!_.allowPrototypes)return;R.push(w[1])}if(w){if(_.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+_.depth+" and strictDepth is true");R.push("["+g.slice(w.index)+"]")}return c(R,p,_,m)}},o=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof d.charset>"u"?r.charset:d.charset,_=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(_!=="combine"&&_!=="first"&&_!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var m=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:m,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||s.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:_,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return Js=function(u,d){var p=o(d);if(u===""||u===null||typeof u>"u")return p.plainObjects?{__proto__:null}:{};for(var _=typeof u=="string"?l(u,p):u,m=p.plainObjects?{__proto__:null}:{},g=Object.keys(_),v=0;v<g.length;++v){var y=g[v],w=f(y,_[y],p,typeof u=="string");m=s.merge(m,w,p)}return p.allowSparse===!0?m:s.compact(m)},Js}var en,$o;function vc(){if($o)return en;$o=1;var s=_c(),e=yc(),t=_a();return en={formats:t,parse:e,stringify:s},en}var Xo;function xc(){if(Xo)return Ot;Xo=1;var s=Gu();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),h=["'"].concat(a),l=["%","/","?",";","#"].concat(h),c=["/","?","#"],f=255,o=/^[+a-z0-9A-Z_-]{0,63}$/,u=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=vc();function g(T,R,b){if(T&&typeof T=="object"&&T instanceof e)return T;var B=new e;return B.parse(T,R,b),B}e.prototype.parse=function(T,R,b){if(typeof T!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof T);var B=T.indexOf("?"),N=B!==-1&&B<T.indexOf("#")?"?":"#",U=T.split(N),V=/\\/g;U[0]=U[0].replace(V,"/"),T=U.join(N);var C=T;if(C=C.trim(),!b&&T.split("#").length===1){var M=i.exec(C);if(M)return this.path=C,this.href=C,this.pathname=M[1],M[2]?(this.search=M[2],R?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):R&&(this.search="",this.query={}),this}var k=t.exec(C);if(k){k=k[0];var z=k.toLowerCase();this.protocol=z,C=C.substr(k.length)}if(b||k||C.match(/^\/\/[^@/]+@[^@/]+/)){var A=C.substr(0,2)==="//";A&&!(k&&p[k])&&(C=C.substr(2),this.slashes=!0)}if(!p[k]&&(A||k&&!_[k])){for(var E=-1,x=0;x<c.length;x++){var P=C.indexOf(c[x]);P!==-1&&(E===-1||P<E)&&(E=P)}var S,I;E===-1?I=C.lastIndexOf("@"):I=C.lastIndexOf("@",E),I!==-1&&(S=C.slice(0,I),C=C.slice(I+1),this.auth=decodeURIComponent(S)),E=-1;for(var x=0;x<l.length;x++){var P=C.indexOf(l[x]);P!==-1&&(E===-1||P<E)&&(E=P)}E===-1&&(E=C.length),this.host=C.slice(0,E),C=C.slice(E),this.parseHost(),this.hostname=this.hostname||"";var O=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!O)for(var F=this.hostname.split(/\./),x=0,G=F.length;x<G;x++){var $=F[x];if($&&!$.match(o)){for(var Y="",Z=0,J=$.length;Z<J;Z++)$.charCodeAt(Z)>127?Y+="x":Y+=$[Z];if(!Y.match(o)){var ie=F.slice(0,x),X=F.slice(x+1),te=$.match(u);te&&(ie.push(te[1]),X.unshift(te[2])),X.length&&(C="/"+X.join(".")+C),this.hostname=ie.join(".");break}}}this.hostname.length>f?this.hostname="":this.hostname=this.hostname.toLowerCase(),O||(this.hostname=s.toASCII(this.hostname));var se=this.port?":"+this.port:"",le=this.hostname||"";this.host=le+se,this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),C[0]!=="/"&&(C="/"+C))}if(!d[z])for(var x=0,G=h.length;x<G;x++){var pe=h[x];if(C.indexOf(pe)!==-1){var re=encodeURIComponent(pe);re===pe&&(re=escape(pe)),C=C.split(pe).join(re)}}var ne=C.indexOf("#");ne!==-1&&(this.hash=C.substr(ne),C=C.slice(0,ne));var Ae=C.indexOf("?");if(Ae!==-1?(this.search=C.substr(Ae),this.query=C.substr(Ae+1),R&&(this.query=m.parse(this.query)),C=C.slice(0,Ae)):R&&(this.search="",this.query={}),C&&(this.pathname=C),_[z]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var se=this.pathname||"",Ie=this.search||"";this.path=se+Ie}return this.href=this.format(),this};function v(T){return typeof T=="string"&&(T=g(T)),T instanceof e?T.format():e.prototype.format.call(T)}e.prototype.format=function(){var T=this.auth||"";T&&(T=encodeURIComponent(T),T=T.replace(/%3A/i,":"),T+="@");var R=this.protocol||"",b=this.pathname||"",B=this.hash||"",N=!1,U="";this.host?N=T+this.host:this.hostname&&(N=T+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(N+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(U=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var V=this.search||U&&"?"+U||"";return R&&R.substr(-1)!==":"&&(R+=":"),this.slashes||(!R||_[R])&&N!==!1?(N="//"+(N||""),b&&b.charAt(0)!=="/"&&(b="/"+b)):N||(N=""),B&&B.charAt(0)!=="#"&&(B="#"+B),V&&V.charAt(0)!=="?"&&(V="?"+V),b=b.replace(/[?#]/g,function(C){return encodeURIComponent(C)}),V=V.replace("#","%23"),R+N+b+V+B};function y(T,R){return g(T,!1,!0).resolve(R)}e.prototype.resolve=function(T){return this.resolveObject(g(T,!1,!0)).format()};function w(T,R){return T?g(T,!1,!0).resolveObject(R):R}return e.prototype.resolveObject=function(T){if(typeof T=="string"){var R=new e;R.parse(T,!1,!0),T=R}for(var b=new e,B=Object.keys(this),N=0;N<B.length;N++){var U=B[N];b[U]=this[U]}if(b.hash=T.hash,T.href==="")return b.href=b.format(),b;if(T.slashes&&!T.protocol){for(var V=Object.keys(T),C=0;C<V.length;C++){var M=V[C];M!=="protocol"&&(b[M]=T[M])}return _[b.protocol]&&b.hostname&&!b.pathname&&(b.pathname="/",b.path=b.pathname),b.href=b.format(),b}if(T.protocol&&T.protocol!==b.protocol){if(!_[T.protocol]){for(var k=Object.keys(T),z=0;z<k.length;z++){var A=k[z];b[A]=T[A]}return b.href=b.format(),b}if(b.protocol=T.protocol,!T.host&&!p[T.protocol]){for(var G=(T.pathname||"").split("/");G.length&&!(T.host=G.shift()););T.host||(T.host=""),T.hostname||(T.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),b.pathname=G.join("/")}else b.pathname=T.pathname;if(b.search=T.search,b.query=T.query,b.host=T.host||"",b.auth=T.auth,b.hostname=T.hostname||T.host,b.port=T.port,b.pathname||b.search){var E=b.pathname||"",x=b.search||"";b.path=E+x}return b.slashes=b.slashes||T.slashes,b.href=b.format(),b}var P=b.pathname&&b.pathname.charAt(0)==="/",S=T.host||T.pathname&&T.pathname.charAt(0)==="/",I=S||P||b.host&&T.pathname,O=I,F=b.pathname&&b.pathname.split("/")||[],G=T.pathname&&T.pathname.split("/")||[],$=b.protocol&&!_[b.protocol];if($&&(b.hostname="",b.port=null,b.host&&(F[0]===""?F[0]=b.host:F.unshift(b.host)),b.host="",T.protocol&&(T.hostname=null,T.port=null,T.host&&(G[0]===""?G[0]=T.host:G.unshift(T.host)),T.host=null),I=I&&(G[0]===""||F[0]==="")),S)b.host=T.host||T.host===""?T.host:b.host,b.hostname=T.hostname||T.hostname===""?T.hostname:b.hostname,b.search=T.search,b.query=T.query,F=G;else if(G.length)F||(F=[]),F.pop(),F=F.concat(G),b.search=T.search,b.query=T.query;else if(T.search!=null){if($){b.host=F.shift(),b.hostname=b.host;var Y=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;Y&&(b.auth=Y.shift(),b.hostname=Y.shift(),b.host=b.hostname)}return b.search=T.search,b.query=T.query,(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.href=b.format(),b}if(!F.length)return b.pathname=null,b.search?b.path="/"+b.search:b.path=null,b.href=b.format(),b;for(var Z=F.slice(-1)[0],J=(b.host||T.host||F.length>1)&&(Z==="."||Z==="..")||Z==="",ie=0,X=F.length;X>=0;X--)Z=F[X],Z==="."?F.splice(X,1):Z===".."?(F.splice(X,1),ie++):ie&&(F.splice(X,1),ie--);if(!I&&!O)for(;ie--;ie)F.unshift("..");I&&F[0]!==""&&(!F[0]||F[0].charAt(0)!=="/")&&F.unshift(""),J&&F.join("/").substr(-1)!=="/"&&F.push("");var te=F[0]===""||F[0]&&F[0].charAt(0)==="/";if($){b.hostname=te?"":F.length?F.shift():"",b.host=b.hostname;var Y=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;Y&&(b.auth=Y.shift(),b.hostname=Y.shift(),b.host=b.hostname)}return I=I||b.host&&F.length,I&&!te&&F.unshift(""),F.length>0?b.pathname=F.join("/"):(b.pathname=null,b.path=null),(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.auth=T.auth||b.auth,b.slashes=b.slashes||T.slashes,b.href=b.format(),b},e.prototype.parseHost=function(){var T=this.host,R=r.exec(T);R&&(R=R[0],R!==":"&&(this.port=R.substr(1)),T=T.substr(0,T.length-R.length)),T&&(this.hostname=T)},Ot.parse=g,Ot.resolve=y,Ot.resolveObject=w,Ot.format=v,Ot.Url=e,Ot}xc();const Vo={};function fe(s,e,t=3){if(Vo[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${s}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`),console.warn(r))),Vo[e]=!0}function Ve(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function Cr(s){return s.split("?")[0].split("#")[0]}function bc(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Tc(s,e,t){return s.replace(new RegExp(bc(e),"g"),t)}function Ac(s,e){let t="",r=0,i=-1,n=0,a=-1;for(let h=0;h<=s.length;++h){if(h<s.length)a=s.charCodeAt(h);else{if(a===47)break;a=47}if(a===47){if(!(i===h-1||n===1))if(i!==h-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=h,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=h,n=0;continue}}}else t.length>0?t+=`/${s.slice(i+1,h)}`:t=s.slice(i+1,h),r=h-i-1;i=h,n=0}else a===46&&n!==-1?++n:n=-1}return t}const Pe={toPosix(s){return Tc(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Ve(s),s=this.toPosix(s);const e=/^file:\/\/\//.exec(s);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(s);return t?t[0]:""},toAbsolute(s,e,t){if(Ve(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const r=Cr(this.toPosix(e??q.ADAPTER.getBaseUrl())),i=Cr(this.toPosix(t??this.rootname(r)));return s=this.toPosix(s),s.startsWith("/")?Pe.join(i,s.slice(1)):this.isAbsolute(s)?s:this.join(r,s)},normalize(s){if(Ve(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let e="";const t=s.startsWith("/");this.hasProtocol(s)&&(e=this.rootname(s),s=s.slice(e.length));const r=s.endsWith("/");return s=Ac(s),s.length>0&&r&&(s+="/"),t?`/${s}`:e+s},isAbsolute(s){return Ve(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let e;for(let t=0;t<s.length;++t){const r=s[t];if(Ve(r),r.length>0)if(e===void 0)e=r;else{const i=s[t-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?e+=`/../${r}`:e+=`/${r}`}}return e===void 0?".":this.normalize(e)},dirname(s){if(Ve(s),s.length===0)return".";s=this.toPosix(s);let e=s.charCodeAt(0);const t=e===47;let r=-1,i=!0;const n=this.getProtocol(s),a=s;s=s.slice(n.length);for(let h=s.length-1;h>=1;--h)if(e=s.charCodeAt(h),e===47){if(!i){r=h;break}}else i=!1;return r===-1?t?"/":this.isUrl(a)?n+s:n:t&&r===1?"//":n+s.slice(0,r)},rootname(s){Ve(s),s=this.toPosix(s);let e="";if(s.startsWith("/")?e="/":e=this.getProtocol(s),this.isUrl(s)){const t=s.indexOf("/",e.length);t!==-1?e=s.slice(0,t):e=s,e.endsWith("/")||(e+="/")}return e},basename(s,e){Ve(s),e&&Ve(e),s=Cr(this.toPosix(s));let t=0,r=-1,i=!0,n;if(e!==void 0&&e.length>0&&e.length<=s.length){if(e.length===s.length&&e===s)return"";let a=e.length-1,h=-1;for(n=s.length-1;n>=0;--n){const l=s.charCodeAt(n);if(l===47){if(!i){t=n+1;break}}else h===-1&&(i=!1,h=n+1),a>=0&&(l===e.charCodeAt(a)?--a===-1&&(r=n):(a=-1,r=h))}return t===r?r=h:r===-1&&(r=s.length),s.slice(t,r)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!i){t=n+1;break}}else r===-1&&(i=!1,r=n+1);return r===-1?"":s.slice(t,r)},extname(s){Ve(s),s=Cr(this.toPosix(s));let e=-1,t=0,r=-1,i=!0,n=0;for(let a=s.length-1;a>=0;--a){const h=s.charCodeAt(a);if(h===47){if(!i){t=a+1;break}continue}r===-1&&(i=!1,r=a+1),h===46?e===-1?e=a:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||r===-1||n===0||n===1&&e===r-1&&e===t+1?"":s.slice(e,r)},parse(s){Ve(s);const e={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return e;s=Cr(this.toPosix(s));let t=s.charCodeAt(0);const r=this.isAbsolute(s);let i;e.root=this.rootname(s),r||this.hasProtocol(s)?i=1:i=0;let n=-1,a=0,h=-1,l=!0,c=s.length-1,f=0;for(;c>=i;--c){if(t=s.charCodeAt(c),t===47){if(!l){a=c+1;break}continue}h===-1&&(l=!1,h=c+1),t===46?n===-1?n=c:f!==1&&(f=1):n!==-1&&(f=-1)}return n===-1||h===-1||f===0||f===1&&n===h-1&&n===a+1?h!==-1&&(a===0&&r?e.base=e.name=s.slice(1,h):e.base=e.name=s.slice(a,h)):(a===0&&r?(e.name=s.slice(1,n),e.base=s.slice(1,h)):(e.name=s.slice(a,n),e.base=s.slice(a,h)),e.ext=s.slice(n,h)),e.dir=this.dirname(s),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let tn;async function wc(){return tn??(tn=(async()=>{var n;const s=document.createElement("canvas").getContext("webgl");if(!s)return Oe.UNPACK;const e=await new Promise(a=>{const h=document.createElement("video");h.onloadeddata=()=>a(h),h.onerror=()=>a(null),h.autoplay=!1,h.crossOrigin="anonymous",h.preload="auto",h.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",h.load()});if(!e)return Oe.UNPACK;const t=s.createTexture();s.bindTexture(s.TEXTURE_2D,t);const r=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,r),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e);const i=new Uint8Array(4);return s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,i),s.deleteFramebuffer(r),s.deleteTexture(t),(n=s.getExtension("WEBGL_lose_context"))==null||n.loseContext(),i[0]<=i[3]?Oe.PMA:Oe.UNPACK})()),tn}let rn;function Ec(){return typeof rn>"u"&&(rn=function(){var e;const s={stencil:!0,failIfMajorPerformanceCaveat:q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!q.ADAPTER.getWebGLRenderingContext())return!1;const t=q.ADAPTER.createCanvas();let r=t.getContext("webgl",s)||t.getContext("experimental-webgl",s);const i=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch{return!1}}()),rn}var Sc={grad:.9,turn:360,rad:360/(2*Math.PI)},dt=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},Re=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*s)/t+0},He=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),s>t?t:s>e?s:e},rl=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},Wo=function(s){return{r:He(s.r,0,255),g:He(s.g,0,255),b:He(s.b,0,255),a:He(s.a)}},sn=function(s){return{r:Re(s.r),g:Re(s.g),b:Re(s.b),a:Re(s.a,3)}},Ic=/^#([0-9a-f]{3,8})$/i,Qr=function(s){var e=s.toString(16);return e.length<2?"0"+e:e},il=function(s){var e=s.r,t=s.g,r=s.b,i=s.a,n=Math.max(e,t,r),a=n-Math.min(e,t,r),h=a?n===e?(t-r)/a:n===t?2+(r-e)/a:4+(e-t)/a:0;return{h:60*(h<0?h+6:h),s:n?a/n*100:0,v:n/255*100,a:i}},sl=function(s){var e=s.h,t=s.s,r=s.v,i=s.a;e=e/360*6,t/=100,r/=100;var n=Math.floor(e),a=r*(1-t),h=r*(1-(e-n)*t),l=r*(1-(1-e+n)*t),c=n%6;return{r:255*[r,h,a,a,l,r][c],g:255*[l,r,r,h,a,a][c],b:255*[a,a,l,r,r,h][c],a:i}},zo=function(s){return{h:rl(s.h),s:He(s.s,0,100),l:He(s.l,0,100),a:He(s.a)}},jo=function(s){return{h:Re(s.h),s:Re(s.s),l:Re(s.l),a:Re(s.a,3)}},qo=function(s){return sl((t=(e=s).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},Gr=function(s){return{h:(e=il(s)).h,s:(i=(200-(t=e.s))*(r=e.v)/100)>0&&i<200?t*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,r,i},Cc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Rc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Pc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Mc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Pn={string:[[function(s){var e=Ic.exec(s);return e?(s=e[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?Re(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?Re(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var e=Pc.exec(s)||Mc.exec(s);return e?e[2]!==e[4]||e[4]!==e[6]?null:Wo({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(s){var e=Cc.exec(s)||Rc.exec(s);if(!e)return null;var t,r,i=zo({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(Sc[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return qo(i)},"hsl"]],object:[[function(s){var e=s.r,t=s.g,r=s.b,i=s.a,n=i===void 0?1:i;return dt(e)&&dt(t)&&dt(r)?Wo({r:Number(e),g:Number(t),b:Number(r),a:Number(n)}):null},"rgb"],[function(s){var e=s.h,t=s.s,r=s.l,i=s.a,n=i===void 0?1:i;if(!dt(e)||!dt(t)||!dt(r))return null;var a=zo({h:Number(e),s:Number(t),l:Number(r),a:Number(n)});return qo(a)},"hsl"],[function(s){var e=s.h,t=s.s,r=s.v,i=s.a,n=i===void 0?1:i;if(!dt(e)||!dt(t)||!dt(r))return null;var a=function(h){return{h:rl(h.h),s:He(h.s,0,100),v:He(h.v,0,100),a:He(h.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(n)});return sl(a)},"hsv"]]},Yo=function(s,e){for(var t=0;t<e.length;t++){var r=e[t][0](s);if(r)return[r,e[t][1]]}return[null,void 0]},Dc=function(s){return typeof s=="string"?Yo(s.trim(),Pn.string):typeof s=="object"&&s!==null?Yo(s,Pn.object):[null,void 0]},nn=function(s,e){var t=Gr(s);return{h:t.h,s:He(t.s+100*e,0,100),l:t.l,a:t.a}},an=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Ko=function(s,e){var t=Gr(s);return{h:t.h,s:t.s,l:He(t.l+100*e,0,100),a:t.a}},Mn=function(){function s(e){this.parsed=Dc(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return Re(an(this.rgba),2)},s.prototype.isDark=function(){return an(this.rgba)<.5},s.prototype.isLight=function(){return an(this.rgba)>=.5},s.prototype.toHex=function(){return e=sn(this.rgba),t=e.r,r=e.g,i=e.b,a=(n=e.a)<1?Qr(Re(255*n)):"","#"+Qr(t)+Qr(r)+Qr(i)+a;var e,t,r,i,n,a},s.prototype.toRgb=function(){return sn(this.rgba)},s.prototype.toRgbString=function(){return e=sn(this.rgba),t=e.r,r=e.g,i=e.b,(n=e.a)<1?"rgba("+t+", "+r+", "+i+", "+n+")":"rgb("+t+", "+r+", "+i+")";var e,t,r,i,n},s.prototype.toHsl=function(){return jo(Gr(this.rgba))},s.prototype.toHslString=function(){return e=jo(Gr(this.rgba)),t=e.h,r=e.s,i=e.l,(n=e.a)<1?"hsla("+t+", "+r+"%, "+i+"%, "+n+")":"hsl("+t+", "+r+"%, "+i+"%)";var e,t,r,i,n},s.prototype.toHsv=function(){return e=il(this.rgba),{h:Re(e.h),s:Re(e.s),v:Re(e.v),a:Re(e.a,3)};var e},s.prototype.invert=function(){return et({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},s.prototype.saturate=function(e){return e===void 0&&(e=.1),et(nn(this.rgba,e))},s.prototype.desaturate=function(e){return e===void 0&&(e=.1),et(nn(this.rgba,-e))},s.prototype.grayscale=function(){return et(nn(this.rgba,-1))},s.prototype.lighten=function(e){return e===void 0&&(e=.1),et(Ko(this.rgba,e))},s.prototype.darken=function(e){return e===void 0&&(e=.1),et(Ko(this.rgba,-e))},s.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},s.prototype.alpha=function(e){return typeof e=="number"?et({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Re(this.rgba.a,3);var t},s.prototype.hue=function(e){var t=Gr(this.rgba);return typeof e=="number"?et({h:e,s:t.s,l:t.l,a:t.a}):Re(t.h)},s.prototype.isEqual=function(e){return this.toHex()===et(e).toHex()},s}(),et=function(s){return s instanceof Mn?s:new Mn(s)},Zo=[],Bc=function(s){s.forEach(function(e){Zo.indexOf(e)<0&&(e(Mn,Pn),Zo.push(e))})};function Fc(s,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in t)r[t[i]]=i;var n={};s.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var h,l,c=r[this.toHex()];if(c)return c;if(a!=null&&a.closest){var f=this.toRgb(),o=1/0,u="black";if(!n.length)for(var d in t)n[d]=new s(t[d]).toRgb();for(var p in t){var _=(h=f,l=n[p],Math.pow(h.r-l.r,2)+Math.pow(h.g-l.g,2)+Math.pow(h.b-l.b,2));_<o&&(o=_,u=p)}return u}},e.string.push([function(a){var h=a.toLowerCase(),l=h==="transparent"?"#0000":t[h];return l?new s(l).toRgb():null},"name"])}Bc([Fc]);const or=class yi{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof yi)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((i,n)=>i===t[n]);if(e!==null&&t!==null){const i=Object.keys(e),n=Object.keys(t);return i.length!==n.length?!1:i.every(a=>e[a]===t[a])}return e===t}toRgba(){const[e,t,r,i]=this._components;return{r:e,g:t,b:r,a:i}}toRgb(){const[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){const[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){const[t,r,i]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(i*255),e}toRgbArray(e){e=e??[];const[t,r,i]=this._components;return e[0]=t,e[1]=r,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,r,i,n]=yi.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return t&&(r=r*e+.5|0,i=i*e+.5|0,n=n*e+.5|0),(e*255<<24)+(r<<16)+(i<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,r,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,r,i,n]=this._components;return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}normalize(e){let t,r,i,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;t=(a>>16&255)/255,r=(a>>8&255)/255,i=(a&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,i,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,i,n=255]=e,t/=255,r/=255,i/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const h=yi.HEX_PATTERN.exec(e);h&&(e=`#${h[2]}`)}const a=et(e);a.isValid()&&({r:t,g:r,b:i,a:n}=a.rgba,t/=255,r/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=i,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((i,n)=>{e[n]=Math.min(Math.max(i,t),r)}),e)}};or.shared=new or,or.temp=new or,or.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let ve=or;function Oc(s){return fe("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),ve.shared.setValue(s).toHex()}function Lc(s){return fe("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),ve.shared.setValue(s).toNumber()}function Nc(){const s=[],e=[];for(let r=0;r<32;r++)s[r]=r,e[r]=r;s[oe.NORMAL_NPM]=oe.NORMAL,s[oe.ADD_NPM]=oe.ADD,s[oe.SCREEN_NPM]=oe.SCREEN,e[oe.NORMAL]=oe.NORMAL_NPM,e[oe.ADD]=oe.ADD_NPM,e[oe.SCREEN]=oe.SCREEN_NPM;const t=[];return t.push(e),t.push(s),t}const nl=Nc();function al(s,e){return nl[e?1:0][s]}function kc(s,e=null){const t=s*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let r=0,i=0;r<t;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}function ol(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function Ii(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Qo(s){return!(s&s-1)&&!!s}function Jo(s){let e=(s>65535?1:0)<<4;s>>>=e;let t=(s>255?1:0)<<3;return s>>>=t,e|=t,t=(s>15?1:0)<<2,s>>>=t,e|=t,t=(s>3?1:0)<<1,s>>>=t,e|=t,e|s>>1}function gr(s,e,t){const r=s.length;let i;if(e>=r||t===0)return;t=e+t>r?r-e:t;const n=r-t;for(i=e;i<n;++i)s[i]=s[i+t];s.length=n}function Rt(s){return s===0?0:s<0?-1:1}let Uc=0;function qt(){return++Uc}const Dn=class{constructor(s,e,t,r){this.left=s,this.top=e,this.right=t,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Dn.EMPTY=new Dn(0,0,0,0);let eh=Dn;const th={},tt=Object.create(null),wt=Object.create(null);class Gc{constructor(e,t,r){this._canvas=q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||q.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function rh(s,e,t){for(let r=0,i=4*t*e;r<e;++r,i+=4)if(s[i+3]!==0)return!1;return!0}function ih(s,e,t,r,i){const n=4*e;for(let a=r,h=r*n+4*t;a<=i;++a,h+=n)if(s[h+3]!==0)return!1;return!0}function Hc(s){const{width:e,height:t}=s,r=s.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const i=r.getImageData(0,0,e,t).data;let n=0,a=0,h=e-1,l=t-1;for(;a<t&&rh(i,e,a);)++a;if(a===t)return eh.EMPTY;for(;rh(i,e,l);)--l;for(;ih(i,e,n,a,l);)++n;for(;ih(i,e,h,a,l);)--h;return++h,++l,new eh(n,a,h,l)}function $c(s){const e=Hc(s),{width:t,height:r}=e;let i=null;if(!e.isEmpty()){const n=s.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");i=n.getImageData(e.left,e.top,t,r)}return{width:t,height:r,data:i}}function Xc(s,e=globalThis.location){if(s.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(s,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function vt(s,e=1){var r;const t=(r=q.RETINA_PREFIX)==null?void 0:r.exec(s);return t?parseFloat(t[1]):e}var W=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(W||{});const Bn=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},sh=(s,e)=>Bn(s).priority??e,Q={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Bn).forEach(e=>{e.type.forEach(t=>{var r,i;return(i=(r=this._removeHandlers)[t])==null?void 0:i.call(r,e)})}),this},add(...s){return s.map(Bn).forEach(e=>{e.type.forEach(t=>{var n,a;const r=this._addHandlers,i=this._queue;r[t]?(n=r[t])==null||n.call(r,e):(i[t]=i[t]||[],(a=i[t])==null||a.push(e))})}),this},handle(s,e,t){var a;const r=this._addHandlers,i=this._removeHandlers;if(r[s]||i[s])throw new Error(`Extension type ${s} already has a handler`);r[s]=e,i[s]=t;const n=this._queue;return n[s]&&((a=n[s])==null||a.forEach(h=>e(h)),delete n[s]),this},handleByMap(s,e){return this.handle(s,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(s,e,t=-1){return this.handle(s,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((i,n)=>sh(n,t)-sh(i,t)))},r=>{const i=e.indexOf(r.ref);i!==-1&&e.splice(i,1)})}};class Fn{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const Vc=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Wc(s){let e="";for(let t=0;t<s;++t)t>0&&(e+=`
else `),t<s-1&&(e+=`if(test == ${t}.0){}`);return e}function zc(s,e){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=Vc.replace(/%forloop%/gi,Wc(s));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))s=s/2|0;else break}return s}const on=0,hn=1,ln=2,un=3,cn=4,dn=5;class ut{constructor(){this.data=0,this.blendMode=oe.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<on)}set blend(e){!!(this.data&1<<on)!==e&&(this.data^=1<<on)}get offsets(){return!!(this.data&1<<hn)}set offsets(e){!!(this.data&1<<hn)!==e&&(this.data^=1<<hn)}get culling(){return!!(this.data&1<<ln)}set culling(e){!!(this.data&1<<ln)!==e&&(this.data^=1<<ln)}get depthTest(){return!!(this.data&1<<un)}set depthTest(e){!!(this.data&1<<un)!==e&&(this.data^=1<<un)}get depthMask(){return!!(this.data&1<<dn)}set depthMask(e){!!(this.data&1<<dn)!==e&&(this.data^=1<<dn)}get clockwiseFrontFace(){return!!(this.data&1<<cn)}set clockwiseFrontFace(e){!!(this.data&1<<cn)!==e&&(this.data^=1<<cn)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==oe.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new ut;return e.depthTest=!1,e.blend=!0,e}}ut.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const On=[];function hl(s,e){if(!s)return null;let t="";if(typeof s=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);r&&(t=r[1].toLowerCase())}for(let r=On.length-1;r>=0;--r){const i=On[r];if(i.test&&i.test(s,t))return new i(s,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ke{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,i,n,a,h,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:f}=this;this._aliasCount++;for(let o=0,u=f.length;o<u;o++)f[o][c](e,t,r,i,n,a,h,l);return f===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Ke.prototype,{dispatch:{value:Ke.prototype.emit},run:{value:Ke.prototype.emit}});class Hr{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Ke("setRealSize"),this.onUpdate=new Ke("update"),this.onError=new Ke("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class Vi extends Hr{constructor(e,t){const{width:r,height:i}=t||{};if(!r||!i)throw new Error("BufferResource width or height invalid");super(r,i),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,r){const i=e.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Oe.UNPACK);const n=t.realWidth,a=t.realHeight;return r.width===n&&r.height===a?i.texSubImage2D(t.target,0,0,0,n,a,t.format,r.type,this.data):(r.width=n,r.height=a,i.texImage2D(t.target,0,r.internalFormat,n,a,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const jc={scaleMode:pt.NEAREST,alphaMode:Oe.NPM},Ln=class hr extends Vr{constructor(e=null,t=null){super(),t=Object.assign({},hr.defaultOptions,t);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:a,width:h,height:l,wrapMode:c,format:f,type:o,target:u,resolution:d,resourceOptions:p}=t;e&&!(e instanceof Hr)&&(e=hl(e,p),e.internal=!0),this.resolution=d||q.RESOLUTION,this.width=Math.round((h||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=c,this._scaleMode=a,this.format=f,this.type=o,this.target=u,this.alphaMode=r,this.uid=qt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=h>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Qo(this.realWidth)&&Qo(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete wt[this.cacheId],delete tt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),hr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=q.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else{if(!e._pixiId){const h=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${h}_${qt()}`}n=e._pixiId}let a=wt[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new hr(e,t),a.cacheId=n,hr.addToCache(a,n)),a}static fromBuffer(e,t,r,i){e=e||new Float32Array(t*r*4);const n=new Vi(e,{width:t,height:r,...i==null?void 0:i.resourceOptions});let a,h;return e instanceof Float32Array?(a=H.RGBA,h=ae.FLOAT):e instanceof Int32Array?(a=H.RGBA_INTEGER,h=ae.INT):e instanceof Uint32Array?(a=H.RGBA_INTEGER,h=ae.UNSIGNED_INT):e instanceof Int16Array?(a=H.RGBA_INTEGER,h=ae.SHORT):e instanceof Uint16Array?(a=H.RGBA_INTEGER,h=ae.UNSIGNED_SHORT):e instanceof Int8Array?(a=H.RGBA,h=ae.BYTE):(a=H.RGBA,h=ae.UNSIGNED_BYTE),n.internal=!0,new hr(n,Object.assign({},jc,{type:h,format:a},i))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),wt[t]&&wt[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),wt[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=wt[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete wt[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete wt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};Ln.defaultOptions={mipmap:lt.POW2,anisotropicLevel:0,scaleMode:pt.LINEAR,wrapMode:Mt.CLAMP,alphaMode:Oe.UNPACK,target:mr.TEXTURE_2D,format:H.RGBA,type:ae.UNSIGNED_BYTE},Ln._globalBatch=0;let ue=Ln;class Nn{constructor(){this.texArray=null,this.blend=0,this.type=at.TRIANGLES,this.start=0,this.size=0,this.data=null}}let qc=0;class we{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=qc++,this.disposeRunner=new Ke("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?ot.ELEMENT_ARRAY_BUFFER:ot.ARRAY_BUFFER}get index(){return this.type===ot.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new we(e)}}class Ci{constructor(e,t=0,r=!1,i=ae.FLOAT,n,a,h,l=1){this.buffer=e,this.size=t,this.normalized=r,this.type=i,this.stride=n,this.start=a,this.instance=h,this.divisor=l}destroy(){this.buffer=null}static from(e,t,r,i,n){return new Ci(e,t,r,i,n)}}const Yc={Float32Array,Uint32Array,Int32Array,Uint8Array};function Kc(s,e){let t=0,r=0;const i={};for(let l=0;l<s.length;l++)r+=e[l],t+=s[l].length;const n=new ArrayBuffer(t*4);let a=null,h=0;for(let l=0;l<s.length;l++){const c=e[l],f=s[l],o=ol(f);i[o]||(i[o]=new Yc[o](n)),a=i[o];for(let u=0;u<f.length;u++){const d=(u/c|0)*r+h,p=u%c;a[d+p]=f[u]}h+=c}return new Float32Array(n)}const nh={5126:4,5123:2,5121:1};let Zc=0;const Qc={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Dt{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Zc++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ke("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,i=!1,n,a,h,l=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof we||(t instanceof Array&&(t=new Float32Array(t)),t=new we(t));const c=e.split("|");if(c.length>1){for(let o=0;o<c.length;o++)this.addAttribute(c[o],t,r,i,n);return this}let f=this.buffers.indexOf(t);return f===-1&&(this.buffers.push(t),f=this.buffers.length-1),this.attributes[e]=new Ci(f,r,i,n,a,h,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof we||(e instanceof Array&&(e=new Uint16Array(e)),e=new we(e)),e.type=ot.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],r=new we;let i;for(i in this.attributes){const n=this.attributes[i],a=this.buffers[n.buffer];e.push(a.data),t.push(n.size*nh[n.type]/4),n.buffer=0}for(r.data=Kc(e,t),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Dt;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new we(this.buffers[t].data.slice(0));for(const t in this.attributes){const r=this.attributes[t];e.attributes[t]=new Ci(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=ot.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new Dt,r=[],i=[],n=[];let a;for(let h=0;h<e.length;h++){a=e[h];for(let l=0;l<a.buffers.length;l++)i[l]=i[l]||0,i[l]+=a.buffers[l].data.length,n[l]=0}for(let h=0;h<a.buffers.length;h++)r[h]=new Qc[ol(a.buffers[h].data)](i[h]),t.buffers[h]=new we(r[h]);for(let h=0;h<e.length;h++){a=e[h];for(let l=0;l<a.buffers.length;l++)r[l].set(a.buffers[l].data,n[l]),n[l]+=a.buffers[l].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=ot.ELEMENT_ARRAY_BUFFER;let h=0,l=0,c=0,f=0;for(let o=0;o<a.buffers.length;o++)if(a.buffers[o]!==a.indexBuffer){f=o;break}for(const o in a.attributes){const u=a.attributes[o];(u.buffer|0)===f&&(l+=u.size*nh[u.type]/4)}for(let o=0;o<e.length;o++){const u=e[o].indexBuffer.data;for(let d=0;d<u.length;d++)t.indexBuffer.data[d+c]+=h;h+=e[o].buffers[f].data.length/l,c+=u.length}}return t}}class ll extends Dt{constructor(e=!1){super(),this._buffer=new we(null,e,!1),this._indexBuffer=new we(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ae.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ae.FLOAT).addAttribute("aColor",this._buffer,4,!0,ae.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ae.FLOAT).addIndex(this._indexBuffer)}}const Ri=Math.PI*2,Jc=180/Math.PI,ed=Math.PI/180;var Be=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(Be||{});class me{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new me(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}me.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Jr=[new me,new me,new me,new me];class ce{constructor(e=0,t=0,r=0,i=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(i),this.type=Be.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ce(0,0,0,0)}clone(){return new ce(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const B=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=B)return!1;const N=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>N}const r=this.left,i=this.right,n=this.top,a=this.bottom;if(i<=r||a<=n)return!1;const h=Jr[0].set(e.left,e.top),l=Jr[1].set(e.left,e.bottom),c=Jr[2].set(e.right,e.top),f=Jr[3].set(e.right,e.bottom);if(c.x<=h.x||l.y<=h.y)return!1;const o=Math.sign(t.a*t.d-t.b*t.c);if(o===0||(t.apply(h,h),t.apply(l,l),t.apply(c,c),t.apply(f,f),Math.max(h.x,l.x,c.x,f.x)<=r||Math.min(h.x,l.x,c.x,f.x)>=i||Math.max(h.y,l.y,c.y,f.y)<=n||Math.min(h.y,l.y,c.y,f.y)>=a))return!1;const u=o*(l.y-h.y),d=o*(h.x-l.x),p=u*r+d*n,_=u*i+d*n,m=u*r+d*a,g=u*i+d*a;if(Math.max(p,_,m,g)<=u*h.x+d*h.y||Math.min(p,_,m,g)>=u*f.x+d*f.y)return!1;const v=o*(h.y-c.y),y=o*(c.x-h.x),w=v*r+y*n,T=v*i+y*n,R=v*r+y*a,b=v*i+y*a;return!(Math.max(w,T,R,b)<=v*h.x+y*h.y||Math.min(w,T,R,b)>=v*f.x+y*f.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(e=1,t=.001){const r=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=i-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=i,this.height=n-i,this}}ce.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Wi{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.radius=r,this.type=Be.CIRC}clone(){return new Wi(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-e,n=this.y-t;return i*=i,n*=n,i+n<=r}getBounds(){return new ce(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Wi.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class zi{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i,this.type=Be.ELIP}clone(){return new zi(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,i=(t-this.y)/this.height;return r*=r,i*=i,r+i<=1}getBounds(){return new ce(this.x-this.width,this.y-this.height,this.width,this.height)}}zi.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class zt{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const r=[];for(let i=0,n=t.length;i<n;i++)r.push(t[i].x,t[i].y);t=r}this.points=t,this.type=Be.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new zt(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let r=!1;const i=this.points.length/2;for(let n=0,a=i-1;n<i;a=n++){const h=this.points[n*2],l=this.points[n*2+1],c=this.points[a*2],f=this.points[a*2+1];l>t!=f>t&&e<(c-h)*((t-l)/(f-l))+h&&(r=!r)}return r}}zt.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,e)=>`${s}, ${e}`,"")}]`};class ji{constructor(e=0,t=0,r=0,i=0,n=20){this.x=e,this.y=t,this.width=r,this.height=i,this.radius=n,this.type=Be.RREC}clone(){return new ji(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let i=e-(this.x+r),n=t-(this.y+r);const a=r*r;if(i*i+n*n<=a||(i=e-(this.x+this.width-r),i*i+n*n<=a)||(n=t-(this.y+this.height-r),i*i+n*n<=a)||(i=e-(this.x+r),i*i+n*n<=a))return!0}return!1}}ji.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class xe{constructor(e=1,t=0,r=0,i=1,n=0,a=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=i,this.tx=n,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,i,n,a){return this.a=e,this.b=t,this.c=r,this.d=i,this.tx=n,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new me;const r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t}applyInverse(e,t){t=t||new me;const r=1/(this.a*this.d+this.c*-this.b),i=e.x,n=e.y;return t.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.a,n=this.c,a=this.tx;return this.a=i*t-this.b*r,this.b=i*r+this.b*t,this.c=n*t-this.d*r,this.d=n*r+this.d*t,this.tx=a*t-this.ty*r,this.ty=a*r+this.ty*t,this}append(e){const t=this.a,r=this.b,i=this.c,n=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*r+e.b*n,this.c=e.c*t+e.d*i,this.d=e.c*r+e.d*n,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,t,r,i,n,a,h,l,c){return this.a=Math.cos(h+c)*n,this.b=Math.sin(h+c)*n,this.c=-Math.sin(h-l)*a,this.d=Math.cos(h-l)*a,this.tx=e-(r*this.a+i*this.c),this.ty=t-(r*this.b+i*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const r=this.a,i=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,r=this.b,i=this.c,n=this.d,a=e.pivot,h=-Math.atan2(-i,n),l=Math.atan2(r,t),c=Math.abs(h+l);return c<1e-5||Math.abs(Ri-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=h,e.skew.y=l),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(i*i+n*n),e.position.x=this.tx+(a.x*t+a.y*i),e.position.y=this.ty+(a.x*r+a.y*n),e}invert(){const e=this.a,t=this.b,r=this.c,i=this.d,n=this.tx,a=e*i-t*r;return this.a=i/a,this.b=-t/a,this.c=-r/a,this.d=e/a,this.tx=(r*this.ty-i*n)/a,this.ty=-(e*this.ty-t*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new xe;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new xe}static get TEMP_MATRIX(){return new xe}}xe.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const kt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ut=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Gt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ht=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],kn=[],ul=[],ei=Math.sign;function td(){for(let s=0;s<16;s++){const e=[];kn.push(e);for(let t=0;t<16;t++){const r=ei(kt[s]*kt[t]+Gt[s]*Ut[t]),i=ei(Ut[s]*kt[t]+Ht[s]*Ut[t]),n=ei(kt[s]*Gt[t]+Gt[s]*Ht[t]),a=ei(Ut[s]*Gt[t]+Ht[s]*Ht[t]);for(let h=0;h<16;h++)if(kt[h]===r&&Ut[h]===i&&Gt[h]===n&&Ht[h]===a){e.push(h);break}}}for(let s=0;s<16;s++){const e=new xe;e.set(kt[s],Ut[s],Gt[s],Ht[s],0,0),ul.push(e)}}td();const be={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>kt[s],uY:s=>Ut[s],vX:s=>Gt[s],vY:s=>Ht[s],inv:s=>s&8?s&15:-s&7,add:(s,e)=>kn[s][e],sub:(s,e)=>kn[s][be.inv(e)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,e)=>Math.abs(s)*2<=Math.abs(e)?e>=0?be.S:be.N:Math.abs(e)*2<=Math.abs(s)?s>0?be.E:be.W:e>0?s>0?be.SE:be.SW:s>0?be.NE:be.NW,matrixAppendRotationInv:(s,e,t=0,r=0)=>{const i=ul[be.inv(e)];i.tx=t,i.ty=r,s.append(i)}};class gt{constructor(e,t,r=0,i=0){this._x=r,this._y=i,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new gt(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}gt.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Un=class{constructor(){this.worldTransform=new xe,this.localTransform=new xe,this.position=new gt(this.onChange,this,0,0),this.scale=new gt(this.onChange,this,1,1),this.pivot=new gt(this.onChange,this,0,0),this.skew=new gt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const t=s.worldTransform,r=this.worldTransform;r.a=e.a*t.a+e.b*t.c,r.b=e.a*t.b+e.b*t.d,r.c=e.c*t.a+e.d*t.c,r.d=e.c*t.b+e.d*t.d,r.tx=e.tx*t.a+e.ty*t.c+t.tx,r.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};Un.IDENTITY=new Un;let ya=Un;ya.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var rd=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,id=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function ah(s,e,t){const r=s.createShader(e);return s.shaderSource(r,t),s.compileShader(r),r}function fn(s){const e=new Array(s);for(let t=0;t<e.length;t++)e[t]=!1;return e}function cl(s,e){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return fn(2*e);case"bvec3":return fn(3*e);case"bvec4":return fn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const _r=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,e)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(e==null||e.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,e)=>s.type==="mat3"&&s.size===1&&!s.isArray&&e.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,e)=>s.type==="vec2"&&s.size===1&&!s.isArray&&e.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,e)=>s.type==="vec3"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],sd={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},nd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function ad(s,e){var r;const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in s.uniforms){const n=e[i];if(!n){((r=s.uniforms[i])==null?void 0:r.group)===!0&&(s.uniforms[i].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const a=s.uniforms[i];let h=!1;for(let l=0;l<_r.length;l++)if(_r[l].test(n,a)){t.push(_r[l].code(i,a)),h=!0;break}if(!h){const l=(n.size===1&&!n.isArray?sd:nd)[n.type].replace("location",`ud["${i}"].location`);t.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const dl={};let nr=dl;function od(){if(nr===dl||nr!=null&&nr.isContextLost()){const s=q.ADAPTER.createCanvas();let e;q.PREFER_ENV>=Kt.WEBGL2&&(e=s.getContext("webgl2",{})),e||(e=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),nr=e}return nr}let ti;function hd(){if(!ti){ti=Ge.MEDIUM;const s=od();if(s&&s.getShaderPrecisionFormat){const e=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);e&&(ti=e.precision?Ge.HIGH:Ge.MEDIUM)}}return ti}function oh(s,e){const t=s.getShaderSource(e).split(`
`).map((c,f)=>`${f}: ${c}`),r=s.getShaderInfoLog(e),i=r.split(`
`),n={},a=i.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!n[c]?(n[c]=!0,!0):!1),h=[""];a.forEach(c=>{t[c-1]=`%c${t[c-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join(`
`);h[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function ld(s,e,t,r){s.getProgramParameter(e,s.LINK_STATUS)||(s.getShaderParameter(t,s.COMPILE_STATUS)||oh(s,t),s.getShaderParameter(r,s.COMPILE_STATUS)||oh(s,r),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(e)))}const ud={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function fl(s){return ud[s]}let ri=null;const hh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function pl(s,e){if(!ri){const t=Object.keys(hh);ri={};for(let r=0;r<t.length;++r){const i=t[r];ri[s[i]]=hh[i]}}return ri[e]}function lh(s,e,t){if(s.substring(0,9)!=="precision"){let r=e;return e===Ge.HIGH&&t!==Ge.HIGH&&(r=Ge.MEDIUM),`precision ${r} float;
${s}`}else if(t!==Ge.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let Rr;function cd(){if(typeof Rr=="boolean")return Rr;try{Rr=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Rr=!1}return Rr}let dd=0;const ii={},Gn=class lr{constructor(e,t,r="pixi-shader",i={}){this.extra={},this.id=dd++,this.vertexSrc=e||lr.defaultVertexSrc,this.fragmentSrc=t||lr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),ii[r]?(ii[r]++,r+=`-${ii[r]}`):ii[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=lh(this.vertexSrc,lr.defaultVertexPrecision,Ge.HIGH),this.fragmentSrc=lh(this.fragmentSrc,lr.defaultFragmentPrecision,hd())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return id}static get defaultFragmentSrc(){return rd}static from(e,t,r){const i=e+t;let n=th[i];return n||(th[i]=n=new lr(e,t,r)),n}};Gn.defaultVertexPrecision=Ge.HIGH,Gn.defaultFragmentPrecision=mt.apple.device?Ge.HIGH:Ge.MEDIUM;let _t=Gn,fd=0;class Ze{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=fd++,this.static=!!t,this.ubo=!!r,e instanceof we?(this.buffer=e,this.buffer.type=ot.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new we(new Float32Array(1)),this.buffer.type=ot.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(!this.ubo)this.uniforms[e]=new Ze(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,r){return new Ze(e,t,r)}static uboFrom(e,t){return new Ze(e,t??!0,!0)}}class ht{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof Ze?this.uniformGroup=t:this.uniformGroup=new Ze(t):this.uniformGroup=new Ze({}),this.disposeRunner=new Ke("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const r in t.uniforms){const i=t.uniforms[r];if(i.group===!0&&this.checkUniformExists(e,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){const i=_t.from(e,t);return new ht(i,r)}}class pd{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Ze.from({uSamplers:r},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${e}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new _t(this.vertexSrc,i)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new xe,default:this.defaultGroupCache[e]};return new ht(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class Hn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function md(){return!mt.apple.device}function gd(s){let e=!0;const t=q.ADAPTER.getNavigator();if(mt.tablet||mt.phone){if(mt.apple.device){const r=t.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(mt.android.device){const r=t.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?s:4}class qi{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var _d=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,yd=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Br=class ze extends qi{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=ll,this.vertexSize=6,this.state=ut.for2d(),this.size=ze.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??gd(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??md(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return fe("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return yd}static get defaultFragmentTemplate(){return _d}setShaderGenerator({vertex:e=ze.defaultVertexSrc,fragment:t=ze.defaultFragmentTemplate}={}){this.shaderGenerator=new pd(e,t)}contextChange(){const e=this.renderer.gl;q.PREFER_ENV===Kt.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ze.defaultMaxTextures),this.maxTextures=zc(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=ze,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new Nn);for(;t.length<i;)t.push(new Hn);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=ze._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let h=++ue._globalBatch,l=0,c=r[0],f=0;i.copyBoundTextures(n,t);for(let o=0;o<this._bufferSize;++o){const u=e[o];e[o]=null,u._batchEnabled!==h&&(c.count>=t&&(i.boundArray(c,n,h,t),this.buildDrawCalls(c,f,o),f=o,c=r[++l],++h),u._batchEnabled=h,u.touched=a,c.elements[c.count++]=u)}c.count>0&&(i.boundArray(c,n,h,t),this.buildDrawCalls(c,f,this._bufferSize),++l,++h);for(let o=0;o<n.length;o++)n[o]=null;ue._globalBatch=h}buildDrawCalls(e,t,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:a,vertexSize:h}=this,l=ze._drawCallPool;let c=this._dcIndex,f=this._aIndex,o=this._iIndex,u=l[c];u.start=this._iIndex,u.texArray=e;for(let d=t;d<r;++d){const p=i[d],_=p._texture.baseTexture,m=nl[_.alphaMode?1:0][p.blendMode];i[d]=null,t<d&&u.blend!==m&&(u.size=o-u.start,t=d,u=l[++c],u.texArray=e,u.start=o),this.packInterleavedGeometry(p,n,a,f,o),f+=p.vertexData.length/2*h,o+=p.indices.length,u.blend=m}t<r&&(u.size=o-u.start,++c),this._dcIndex=c,this._aIndex=f,this._iIndex=o}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;ze.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,i=ze._drawCallPool;let n=null;for(let a=0;a<e;a++){const{texArray:h,type:l,size:c,start:f,blend:o}=i[a];n!==h&&(n=h,this.bindAndClearTexArray(h)),this.state.blendMode=o,r.set(this.state),t.drawElements(l,c,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ze.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Ii(Math.ceil(e/8)),r=Jo(t),i=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Fn(i*this.vertexSize*4)),n}getIndexBuffer(e){const t=Ii(Math.ceil(e/12)),r=Jo(t),i=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(e,t,r,i,n){const{uint32View:a,float32View:h}=t,l=i/this.vertexSize,c=e.uvs,f=e.indices,o=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),p=ve.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let _=0;_<o.length;_+=2)h[i++]=o[_],h[i++]=o[_+1],h[i++]=c[_],h[i++]=c[_+1],a[i++]=p,h[i++]=u;for(let _=0;_<f.length;_++)r[n++]=l+f[_]}};Br.defaultBatchSize=4096,Br.extension={name:"batch",type:W.RendererPlugin},Br._drawCallPool=[],Br._textureArrayPool=[];let $t=Br;Q.add($t);var vd=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,xd=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const $n=class Fr extends ht{constructor(e,t,r){const i=_t.from(e||Fr.defaultVertexSrc,t||Fr.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=Fr.defaultResolution,this.multisample=Fr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ut}apply(e,t,r,i,n){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return xd}static get defaultFragmentSrc(){return vd}};$n.defaultResolution=1,$n.defaultMultisample=Se.NONE;let Fe=$n;class Pi{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ve(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:r,backgroundAlpha:i}=e,n=r??t;n!==void 0&&(this.color=n),this.alpha=i}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Pi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Pi.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"background"};Q.add(Pi);class ml{constructor(e){this.renderer=e,this.emptyRenderer=new qi(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:r}=this.renderer.texture;for(let i=t-1;i>=0;--i)e[i]=r[i]||null,e[i]&&(e[i]._batchLocation=i)}boundArray(e,t,r,i){const{elements:n,ids:a,count:h}=e;let l=0;for(let c=0;c<h;c++){const f=n[c],o=f._batchLocation;if(o>=0&&o<i&&t[o]===f){a[c]=o;continue}for(;l<i;){const u=t[l];if(u&&u._batchEnabled===r&&u._batchLocation===l){l++;continue}a[c]=l,f._batchLocation=l,t[l]=f;break}}}destroy(){this.renderer=null}}ml.extension={type:W.RendererSystem,name:"batch"};Q.add(ml);let uh=0;class Mi{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=uh++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=uh++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(q.PREFER_ENV>=Kt.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Mi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Mi.extension={type:W.RendererSystem,name:"context"};Q.add(Mi);class Xn{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ke("disposeFramebuffer"),this.multisample=Se.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new ue(null,{scaleMode:pt.NEAREST,resolution:1,mipmap:lt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new ue(null,{scaleMode:pt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:lt.OFF,format:H.DEPTH_COMPONENT,type:ae.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],n=i.resolution;i.setSize(e/n,t/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class gl extends ue{constructor(e={}){if(typeof e=="number"){const t=arguments[0],r=arguments[1],i=arguments[2],n=arguments[3];e={width:t,height:r,scaleMode:i,resolution:n}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=Se.NONE),super(null,e),this.mipmap=lt.OFF,this.valid=!0,this._clear=new ve([0,0,0,0]),this.framebuffer=new Xn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class xt extends Hr{constructor(e){const t=e,r=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,i=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(r,i),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){r===void 0&&!t.startsWith("data:")?e.crossOrigin=Xc(t):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,t,r,i){const n=e.gl,a=t.realWidth,h=t.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||i.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Oe.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&r.width===a&&r.height===h?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,r.type,i):(r.width=a,r.height=h,n.texImage2D(t.target,0,r.internalFormat,t.format,r.type,i)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}}class _l extends xt{constructor(e,t){if(t=t||{},typeof e=="string"){const r=new Image;xt.crossOrigin(r,e,t.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,r)=>{const i=this.source;this.url=i.src;const n=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?n():(i.onload=n,i.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(i=>i.blob()).then(i=>t(i,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Oe.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let i=!0;const n=t._glTextures;for(const a in n){const h=n[a];if(h!==r&&h.dirtyId!==t.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class va{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){const i=t.width,n=t.height;if(r){const a=e.width/2/i,h=e.height/2/n,l=e.x/i+a,c=e.y/n+h;r=be.add(r,be.NW),this.x0=l+a*be.uX(r),this.y0=c+h*be.uY(r),r=be.add(r,2),this.x1=l+a*be.uX(r),this.y1=c+h*be.uY(r),r=be.add(r,2),this.x2=l+a*be.uX(r),this.y2=c+h*be.uY(r),r=be.add(r,2),this.x3=l+a*be.uX(r),this.y3=c+h*be.uY(r)}else this.x0=e.x/i,this.y0=e.y/n,this.x1=(e.x+e.width)/i,this.y1=e.y/n,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/n,this.x3=e.x/i,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}va.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const ch=new va;function si(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class K extends Vr{constructor(e,t,r,i,n,a,h){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new ce(0,0,1,1)),e instanceof K&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=ch,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new me(a.x,a.y):new me(0,0),this.defaultBorders=h,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&tt[t.url]&&K.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,K.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var i;const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new K(this.baseTexture,!this.noFrame&&e,t,(i=this.trim)==null?void 0:i.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===ch&&(this._uvs=new va),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=q.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else if(e instanceof ue){if(!e.cacheId){const h=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${h}-${qt()}`,ue.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){const h=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${h}_${qt()}`}n=e._pixiId}let a=tt[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(e instanceof ue)?(t.resolution||(t.resolution=vt(e)),a=new K(new ue(e,t)),a.baseTexture.cacheId=n,ue.addToCache(a.baseTexture,n),K.addToCache(a,n)):!a&&e instanceof ue&&(a=new K(e),K.addToCache(a,n)),a}static fromURL(e,t){const r=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),i=K.from(e,Object.assign({resourceOptions:r},t),!1),n=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):n.load().then(()=>Promise.resolve(i))}static fromBuffer(e,t,r,i){return new K(ue.fromBuffer(e,t,r,i))}static fromLoader(e,t,r,i){const n=new ue(e,Object.assign({scaleMode:ue.defaultOptions.scaleMode,resolution:vt(t)},i)),{resource:a}=n;a instanceof _l&&(a.url=t);const h=new K(n);return r||(r=t),ue.addToCache(h.baseTexture,r),K.addToCache(h,r),r!==t&&(ue.addToCache(h.baseTexture,t),K.addToCache(h,t)),h.baseTexture.valid?Promise.resolve(h):new Promise(l=>{h.baseTexture.once("loaded",()=>l(h))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),tt[t]&&tt[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),tt[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=tt[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete tt[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)tt[e.textureCacheIds[t]]===e&&delete tt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:r,width:i,height:n}=e,a=t+i>this.baseTexture.width,h=r+n>this.baseTexture.height;if(a||h){const l=a&&h?"and":"or",c=`X: ${t} + ${i} = ${t+i} > ${this.baseTexture.width}`,f=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${l} ${f}`)}this.valid=i&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return K._EMPTY||(K._EMPTY=new K(new ue),si(K._EMPTY),si(K._EMPTY.baseTexture)),K._EMPTY}static get WHITE(){if(!K._WHITE){const e=q.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),K._WHITE=new K(ue.from(e)),si(K._WHITE),si(K._WHITE.baseTexture)}return K._WHITE}}class Zt extends K{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){const i=this.baseTexture.resolution,n=Math.round(e*i)/i,a=Math.round(t*i)/i;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Zt(new gl(e))}}class yl{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=Se.NONE){const i=new gl(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new Zt(i)}getOptimalTexture(e,t,r=1,i=Se.NONE){let n;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Ii(e),t=Ii(t),n=((e&65535)<<16|t&65535)>>>0,i>1&&(n+=i*4294967296)):n=i>1?-i:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(e,t,i)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(e,t,r){const i=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||Se.NONE);return i.filterFrame=e.filterFrame,i}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const r=this.texturePool[t];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const r=this.texturePool[t];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}yl.SCREEN_KEY=-1;class bd extends Dt{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class vl extends Dt{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new we(this.vertices),this.uvBuffer=new we(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+t.width/e.width,this.uvs[3]=i,this.uvs[4]=r+t.width/e.width,this.uvs[5]=i+t.height/e.height,this.uvs[6]=r,this.uvs[7]=i+t.height/e.height,r=t.x,i=t.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+t.width,this.vertices[3]=i,this.vertices[4]=r+t.width,this.vertices[5]=i+t.height,this.vertices[6]=r,this.vertices[7]=i+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Td{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Se.NONE,this.sourceFrame=new ce,this.destinationFrame=new ce,this.bindingSourceFrame=new ce,this.bindingDestinationFrame=new ce,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ni=[new me,new me,new me,new me],pn=new xe;class xl{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new yl,this.statePool=[],this.quad=new bd,this.quadUv=new vl,this.tempRect=new ce,this.activeState={},this.globalUniforms=new Ze({outputFrame:new ce,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new Td,a=r.renderTexture;let h,l;if(a.current){const m=a.current;h=m.resolution,l=m.multisample}else h=r.resolution,l=r.multisample;let c=t[0].resolution||h,f=t[0].multisample??l,o=t[0].padding,u=t[0].autoFit,d=t[0].legacy??!0;for(let m=1;m<t.length;m++){const g=t[m];c=Math.min(c,g.resolution||h),f=Math.min(f,g.multisample??l),o=this.useMaxPadding?Math.max(o,g.padding):o+g.padding,u=u&&g.autoFit,d=d||(g.legacy??!0)}i.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),i.push(n),n.resolution=c,n.multisample=f,n.legacy=d,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(o);const p=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(pn.copyFrom(r.projection.transform).invert(),p),u?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,c,f),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const _=this.tempRect;_.x=0,_.y=0,_.width=n.sourceFrame.width,_.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,_),r.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;const i=this.globalUniforms.uniforms;i.outputFrame=t.sourceFrame,i.resolution=t.resolution;const n=i.inputSize,a=i.inputPixel,h=i.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*t.resolution),a[1]=Math.round(n[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],h[0]=.5*a[2],h[1]=.5*a[3],h[2]=t.sourceFrame.width*n[2]-.5*a[2],h[3]=t.sourceFrame.height*n[3]-.5*a[3],t.legacy){const c=i.filterArea;c[0]=t.destinationFrame.width,c[1]=t.destinationFrame.height,c[2]=t.sourceFrame.x,c[3]=t.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,l.renderTexture,nt.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let c=t.renderTexture,f=this.getOptimalFilterTexture(c.width,c.height,t.resolution);f.filterFrame=c.filterFrame;let o=0;for(o=0;o<r.length-1;++o){o===1&&t.multisample>1&&(f=this.getOptimalFilterTexture(c.width,c.height,t.resolution),f.filterFrame=c.filterFrame),r[o].apply(this,c,f,nt.CLEAR,t);const u=c;c=f,f=u}r[o].apply(this,c,l.renderTexture,nt.BLEND,t),o>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(f)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=nt.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,r.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=i.stateId&1||this.forceClear;(t===nt.CLEAR||t===nt.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,i){const n=this.renderer;n.state.set(e.state),this.bindAndClear(r,i),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(at.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(at.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:n}=t._texture,a=e.set(i.width,0,0,i.height,r.x,r.y),h=t.worldTransform.copyTo(xe.TEMP_MATRIX);return h.invert(),a.prepend(h),a.scale(1/n.width,1/n.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,i=Se.NONE){return this.texturePool.getOptimalTexture(e,t,r,i)}getFilterTexture(e,t,r){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||Se.NONE);return i.filterFrame=e.filterFrame,i}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const r=ni[0],i=ni[1],n=ni[2],a=ni[3];r.set(t.left,t.top),i.set(t.left,t.bottom),n.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(r,r),e.apply(i,i),e.apply(n,n),e.apply(a,a);const h=Math.min(r.x,i.x,n.x,a.x),l=Math.min(r.y,i.y,n.y,a.y),c=Math.max(r.x,i.x,n.x,a.x),f=Math.max(r.y,i.y,n.y,a.y);t.x=h,t.y=l,t.width=c-h,t.height=f-l}roundFrame(e,t,r,i,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:h,c:l,d:c}=n;if((Math.abs(h)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(c)>1e-4))return}n=n?pn.copyFrom(n):pn.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}}xl.extension={type:W.RendererSystem,name:"filter"};Q.add(xl);class Ad{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Se.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const wd=new ce;class bl{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Xn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ce,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;q.PREFER_ENV===Kt.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=i=>t.drawBuffersWEBGL(i):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){const{gl:i}=this;if(e){const n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let a=0;a<e.colorTextures.length;a++){const h=e.colorTextures[a];this.renderer.texture.unbind(h.parentTextureArray||h)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const a=t.width>>r,h=t.height>>r,l=a/t.width;this.setViewport(t.x*l,t.y*l,a,h)}else{const a=e.width>>r,h=e.height>>r;this.setViewport(0,0,a,h)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,i){const n=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),i=Math.round(i),(n.width!==r||n.height!==i||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,i,n=Rn.COLOR|Rn.DEPTH){const{gl:a}=this;a.clearColor(e,t,r,i),a.clear(n)}initFramebuffer(e){const{gl:t}=this,r=new Ad(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){const{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];if(r.stencil){t.bindRenderbuffer(t.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=t.DEPTH_STENCIL:e.depth&&e.stencil?a=t.DEPTH24_STENCIL8:e.depth?a=t.DEPTH_COMPONENT24:a=t.STENCIL_INDEX8,r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,a,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}const i=e.colorTextures;let n=i.length;t.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const h=i[a],l=h.parentTextureArray||h;this.renderer.texture.bind(l,0),a===0&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:r}=this,i=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),i.multisample>1&&this.canMultisampleFramebuffer(e)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const h=[];for(let l=0;l<a;l++){const c=n[l],f=c.parentTextureArray||c;this.renderer.texture.bind(f,0),l===0&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,f._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,c.target,f._glTextures[this.CONTEXT_UID].texture,t),h.push(r.COLOR_ATTACHMENT0+l))}if(h.length>1&&r.drawBuffers(h),e.depthTexture&&this.writeDepthTexture){const l=e.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){i.stencil=i.stencil||r.createRenderbuffer();let l,c;this.renderer.context.webGLVersion===1?(l=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH_STENCIL):e.depth&&e.stencil?(l=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH24_STENCIL8):e.depth?(l=r.DEPTH_ATTACHMENT,c=r.DEPTH_COMPONENT24):(l=r.STENCIL_ATTACHMENT,c=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,c,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,c,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,l,r.RENDERBUFFER,i.stencil)}else i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let r=Se.NONE;if(e<=1||t===null)return r;for(let i=0;i<t.length;i++)if(t[i]<=e){r=t[i];break}return r===1&&(r=Se.NONE),r}blit(e,t,r){const{current:i,renderer:n,gl:a,CONTEXT_UID:h}=this;if(n.context.webGLVersion!==2||!i)return;const l=i.glFramebuffers[h];if(!l)return;if(!e){if(!l.msaaBuffer)return;const f=i.colorTextures[0];if(!f)return;l.blitFramebuffer||(l.blitFramebuffer=new Xn(i.width,i.height),l.blitFramebuffer.addColorTexture(0,f)),e=l.blitFramebuffer,e.colorTextures[0]!==f&&(e.colorTextures[0]=f,e.dirtyId++,e.dirtyFormat++),(e.width!==i.width||e.height!==i.height)&&(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}t||(t=wd,t.width=i.width,t.height=i.height),r||(r=t);const c=t.width===r.width&&t.height===r.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,c?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const r=e.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const r=e.width,i=e.height,n=this.gl,a=t.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let h,l;this.renderer.context.webGLVersion===1?(h=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH_STENCIL):e.depth?(h=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH24_STENCIL8):(h=n.STENCIL_ATTACHMENT,l=n.STENCIL_INDEX8),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,l,r,i):n.renderbufferStorage(n.RENDERBUFFER,l,r,i),n.framebufferRenderbuffer(n.FRAMEBUFFER,h,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ce}destroy(){this.renderer=null}}bl.extension={type:W.RendererSystem,name:"framebuffer"};Q.add(bl);const mn={5126:4,5123:2,5121:1};class Tl{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;q.PREFER_ENV===Kt.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=i=>r.bindVertexArrayOES(i),e.deleteVertexArray=i=>r.deleteVertexArrayOES(i)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(i,n)=>r.vertexAttribDivisorANGLE(i,n),e.drawElementsInstanced=(i,n,a,h,l)=>r.drawElementsInstancedANGLE(i,n,a,h,l),e.drawArraysInstanced=(i,n,a,h)=>r.drawArraysInstancedANGLE(i,n,a,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:r}=this;let i=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);const a=i[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){const i=e.buffers[r];t.update(i)}}checkCompatibility(e,t){const r=e.attributes,i=t.attributeData;for(const n in i)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const r=e.attributes,i=t.attributeData,n=["g",e.id];for(const a in r)i[a]&&n.push(a,i[a].location);return n.join("-")}initGeometryVao(e,t,r=!0){const i=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,h=t.program;h.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,h);const l=this.getSignature(e,h),c=e.glVertexArrayObjects[this.CONTEXT_UID];let f=c[l];if(f)return c[h.id]=f,f;const o=e.buffers,u=e.attributes,d={},p={};for(const _ in o)d[_]=0,p[_]=0;for(const _ in u)!u[_].size&&h.attributeData[_]?u[_].size=h.attributeData[_].size:u[_].size||console.warn(`PIXI Geometry attribute '${_}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[_].buffer]+=u[_].size*mn[u[_].type];for(const _ in u){const m=u[_],g=m.size;m.stride===void 0&&(d[m.buffer]===g*mn[m.type]?m.stride=0:m.stride=d[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=g*mn[m.type])}f=i.createVertexArray(),i.bindVertexArray(f);for(let _=0;_<o.length;_++){const m=o[_];a.bind(m),r&&m._glBuffers[n].refCount++}return this.activateVao(e,h),c[h.id]=f,c[l]=f,i.bindVertexArray(null),a.unbind(ot.ARRAY_BUFFER),f}disposeGeometry(e,t){var h;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=e.buffers,a=(h=this.renderer)==null?void 0:h.buffer;if(e.disposeRunner.remove(this),!!r){if(a)for(let l=0;l<n.length;l++){const c=n[l]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!t&&a.dispose(n[l],t))}if(!t){for(const l in r)if(l[0]==="g"){const c=r[l];this._activeVao===c&&this.unbind(),i.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){const r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,a=e.buffers,h=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(const c in h){const f=h[c],o=a[f.buffer],u=o._glBuffers[i];if(t.attributeData[c]){l!==u&&(n.bind(o),l=u);const d=t.attributeData[c].location;if(r.enableVertexAttribArray(d),r.vertexAttribPointer(d,f.size,f.type||r.FLOAT,f.normalized,f.stride,f.start),f.instance)if(this.hasInstance)r.vertexAttribDivisor(d,f.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,i){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const h=a.indexBuffer.data.BYTES_PER_ELEMENT,l=h===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(e,t||a.indexBuffer.data.length,l,(r||0)*h,i||1):n.drawElements(e,t||a.indexBuffer.data.length,l,(r||0)*h):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(e,r,t||a.getSize(),i||1):n.drawArrays(e,r,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Tl.extension={type:W.RendererSystem,name:"geometry"};Q.add(Tl);const dh=new xe;class Al{constructor(e,t){this._texture=e,this.mapCoord=new xe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const r=this.mapCoord;for(let i=0;i<e.length;i+=2){const n=e[i],a=e[i+1];t[i]=n*r.a+a*r.c+r.tx,t[i+1]=n*r.b+a*r.d+r.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=t.orig,n=t.trim;n&&(dh.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(dh));const a=t.baseTexture,h=this.uClampFrame,l=this.clampMargin/a.resolution,c=this.clampOffset;return h[0]=(t._frame.x+l+c)/a.width,h[1]=(t._frame.y+l+c)/a.height,h[2]=(t._frame.x+t._frame.width-l+c)/a.width,h[3]=(t._frame.y+t._frame.height-l+c)/a.height,this.uClampOffset[0]=c/a.realWidth,this.uClampOffset[1]=c/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0}}var Ed=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Sd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Id extends Fe{constructor(e,t,r){let i=null;typeof e!="string"&&t===void 0&&r===void 0&&(i=e,e=void 0,t=void 0,r=void 0),super(e||Sd,t||Ed,r),this.maskSprite=i,this.maskMatrix=new xe}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,i){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Al(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,r,i))}}class Cd{constructor(e=null){this.type=Ce.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Fe.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ce.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class wl{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){const n=this.maskDataPool.pop()||new Cd;n.pooled=!0,n.maskObject=t,r=n}const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==Ce.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Ce.SCISSOR:this.renderer.scissor.push(r);break;case Ce.STENCIL:this.renderer.stencil.push(r);break;case Ce.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Ce.COLOR:this.pushColorMask(r);break}r.type===Ce.SPRITE&&this.maskStack.push(r)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case Ce.SCISSOR:this.renderer.scissor.pop(t);break;case Ce.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case Ce.SPRITE:this.popSpriteMask(t);break;case Ce.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Ce.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=Ce.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Ce.SCISSOR:e.type=Ce.STENCIL:e.type=Ce.COLOR}pushSpriteMask(e){const{maskObject:t}=e,r=e._target;let i=e._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Id])),i[0].resolution=e.resolution,i[0].multisample=e.multisample,i[0].maskSprite=t;const n=r.filterArea;r.filterArea=t.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){const t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}wl.extension={type:W.RendererSystem,name:"mask"};Q.add(wl);class El{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;const i=this.getStackLength();i!==r&&(i===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const fh=new xe,ph=[],Sl=class vi extends El{constructor(e){super(e),this.glConst=q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,n=i.renderTexture,a=r.getBounds(!0,ph.pop()??new ce);this.roundFrameToPixels(a,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&a.fit(t),e._scissorRectLocal=a}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:i,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||vi.isMatrixRotated(t.worldTransform)||vi.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,i,n){vi.isMatrixRotated(n)||(n=n?fh.copyFrom(n):fh.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&ph.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Sl.extension={type:W.RendererSystem,name:"scissor"};let Rd=Sl;Q.add(Rd);class Il extends El{constructor(e){super(e),this.glConst=q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:r}=this.renderer,i=e._stencilCounter;i===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;i!==0&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,i!==0&&(r._colorMask=i,t.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Il.extension={type:W.RendererSystem,name:"stencil"};Q.add(Il);class Cl{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return fe("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return fe("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return fe("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Cl.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_plugin"};Q.add(Cl);class Rl{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new xe,this.transform=null}update(e,t,r,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,r,i){const n=this.projectionMatrix,a=i?-1:1;n.identity(),n.a=1/t.width*2,n.d=a*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-a-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}}Rl.extension={type:W.RendererSystem,name:"projection"};Q.add(Rl);const Pd=new ya,mh=new ce;class Pl{constructor(e){this.renderer=e,this._tempMatrix=new xe}generateTexture(e,t){const{region:r,...i}=t||{},n=(r==null?void 0:r.copyTo(mh))||e.getLocalBounds(mh,!0),a=i.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),i.width=n.width,i.height=n.height,i.resolution=a,i.multisample??(i.multisample=this.renderer.multisample);const h=Zt.create(i);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const l=e.transform;return e.transform=Pd,this.renderer.render(e,{renderTexture:h,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=l,h}destroy(){}}Pl.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"textureGenerator"};Q.add(Pl);const Lt=new ce,Pr=new ce;class Ml{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ce,this.destinationFrame=new ce,this.viewportFrame=new ce}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,r){const i=this.renderer;this.current=e;let n,a,h;e?(n=e.baseTexture,h=n.resolution,t||(Lt.width=e.frame.width,Lt.height=e.frame.height,t=Lt),r||(Pr.x=e.frame.x,Pr.y=e.frame.y,Pr.width=t.width,Pr.height=t.height,r=Pr),a=n.framebuffer):(h=i.resolution,t||(Lt.width=i._view.screen.width,Lt.height=i._view.screen.height,t=Lt),r||(r=Lt,r.width=t.width,r.height=t.height));const l=this.viewportFrame;l.x=r.x*h,l.y=r.y*h,l.width=r.width*h,l.height=r.height*h,e||(l.y=i.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(a,l),this.renderer.projection.update(r,t,h,!a),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=ve.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,h=n.width!==a.width||n.height!==a.height;if(h){let{x:l,y:c,width:f,height:o}=this.viewportFrame;l=Math.round(l),c=Math.round(c),f=Math.round(f),o=Math.round(o),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,c,f,o)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,t),h&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Ml.extension={type:W.RendererSystem,name:"renderTexture"};Q.add(Ml);class Md{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Dd(s,e){const t={},r=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const n=e.getActiveAttrib(s,i);if(n.name.startsWith("gl_"))continue;const a=pl(e,n.type),h={type:a,name:n.name,size:fl(a),location:e.getAttribLocation(s,n.name)};t[n.name]=h}return t}function Bd(s,e){const t={},r=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const n=e.getActiveUniform(s,i),a=n.name.replace(/\[.*?\]$/,""),h=!!n.name.match(/\[.*?\]$/),l=pl(e,n.type);t[a]={name:a,index:i,type:l,size:n.size,isArray:h,value:cl(l,n.size)}}return t}function Fd(s,e){var h;const t=ah(s,s.VERTEX_SHADER,e.vertexSrc),r=ah(s,s.FRAGMENT_SHADER,e.fragmentSrc),i=s.createProgram();s.attachShader(i,t),s.attachShader(i,r);const n=(h=e.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(i,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(i),s.getProgramParameter(i,s.LINK_STATUS)||ld(s,i,t,r),e.attributeData=Dd(i,s),e.uniformData=Bd(i,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const l=Object.keys(e.attributeData);l.sort((c,f)=>c>f?1:-1);for(let c=0;c<l.length;c++)e.attributeData[l[c]].location=c,s.bindAttribLocation(i,c,l[c]);s.linkProgram(i)}s.deleteShader(t),s.deleteShader(r);const a={};for(const l in e.uniformData){const c=e.uniformData[l];a[l]={location:s.getUniformLocation(i,l),value:cl(c.type,c.size)}}return new Md(i,a)}function Od(s,e,t,r,i){t.buffer.update(i)}const Ld={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Dl={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Nd(s){const e=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let t=0,r=0,i=0;for(let n=0;n<e.length;n++){const a=e[n];if(t=Dl[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,r%t!==0&&r<16){const h=r%t%16;r+=h,i+=h}r+t>16?(i=Math.ceil(i/16)*16,a.offset=i,i+=t,r=t):(a.offset=i,r+=t,i+=t)}return i=Math.ceil(i/16)*16,{uboElements:e,size:i}}function kd(s,e){const t=[];for(const r in s)e[r]&&t.push(e[r]);return t.sort((r,i)=>r.index-i.index),t}function Ud(s,e){if(!s.autoManage)return{size:0,syncFunc:Od};const t=kd(s.uniforms,e),{uboElements:r,size:i}=Nd(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const h=r[a],l=s.uniforms[h.data.name],c=h.data.name;let f=!1;for(let o=0;o<_r.length;o++){const u=_r[o];if(u.codeUbo&&u.test(h.data,l)){n.push(`offset = ${h.offset/4};`,_r[o].codeUbo(h.data.name,l)),f=!0;break}}if(!f)if(h.data.size>1){const o=fl(h.data.type),u=Math.max(Dl[h.data.type]/16,1),d=o/u,p=(4-d%4)%4;n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*u}; i++)
                {
                    for(var j = 0; j < ${d}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const o=Ld[h.data.type];n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${h.offset/4};
                ${o};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Gd=0;const ai={textureCount:0,uboCount:0};class Bl{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Gd++}systemCheck(){if(!cd())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const r=e.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),t||(ai.textureCount=0,ai.uboCount=0,this.syncUniformGroup(e.uniformGroup,ai)),i}setUniforms(e){const t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){const r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=ad(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;const i=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),i(r.uniformData,e.uniforms,this.renderer,ai,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);const n=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let h=this._uboCache[a];if(h||(h=this._uboCache[a]=Ud(e,this.shader.program.uniformData)),e.autoManage){const l=new Float32Array(h.size/4);e.buffer.update(l)}return t.uniformGroups[e.id]=h.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){const i=e.uniforms,n=[`${r}-`];for(const a in i)n.push(a),t[a]&&n.push(t[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,r=e.program,i=Fd(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Bl.extension={type:W.RendererSystem,name:"shader"};Q.add(Bl);class Di{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}Di.defaultOptions={hello:!1},Di.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"startup"};Q.add(Di);function Hd(s,e=[]){return e[oe.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.ADD]=[s.ONE,s.ONE],e[oe.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.NONE]=[0,0],e[oe.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],e[oe.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[oe.SRC_IN]=[s.DST_ALPHA,s.ZERO],e[oe.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],e[oe.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[oe.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],e[oe.DST_IN]=[s.ZERO,s.SRC_ALPHA],e[oe.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],e[oe.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],e[oe.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[oe.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],e}const $d=0,Xd=1,Vd=2,Wd=3,zd=4,jd=5,Fl=class Vn{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=oe.NONE,this._blendEq=!1,this.map=[],this.map[$d]=this.setBlend,this.map[Xd]=this.setOffset,this.map[Vd]=this.setCullFace,this.map[Wd]=this.setDepthTest,this.map[zd]=this.setFrontFace,this.map[jd]=this.setDepthMask,this.checks=[],this.defaultState=new ut,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=Hd(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Vn.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Vn.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};Fl.extension={type:W.RendererSystem,name:"state"};let qd=Fl;Q.add(qd);class Yd extends Vr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(i=>e.systems[i]),r=[...t,...Object.keys(e.systems).filter(i=>!t.includes(i))];for(const i of r)this.addSystem(e.systems[i],i)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Ke(t)})}addSystem(e,t){const r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(const i in this.runners)this.runners[i].add(r);return this}emitWithCustomOptions(e,t){const r=Object.keys(this._systemsHash);e.items.forEach(i=>{const n=r.find(a=>this._systemsHash[a]===i);i[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const Or=class xi{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=xi.defaultMaxIdle,this.checkCountMax=xi.defaultCheckCountMax,this.mode=xi.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==fa.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let i=0;i<t.length;i++){const n=t[i];n.resource&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[i++]=t[n]);t.length=i}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};Or.defaultMode=fa.AUTO,Or.defaultMaxIdle=60*60,Or.defaultCheckCountMax=60*10,Or.extension={type:W.RendererSystem,name:"textureGC"};let Xt=Or;Q.add(Xt);class gn{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ae.UNSIGNED_BYTE,this.internalFormat=H.RGBA,this.samplerType=0}}function Kd(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[s.RGB]:j.FLOAT,[s.RGBA]:j.FLOAT,[s.ALPHA]:j.FLOAT,[s.LUMINANCE]:j.FLOAT,[s.LUMINANCE_ALPHA]:j.FLOAT,[s.R8]:j.FLOAT,[s.R8_SNORM]:j.FLOAT,[s.RG8]:j.FLOAT,[s.RG8_SNORM]:j.FLOAT,[s.RGB8]:j.FLOAT,[s.RGB8_SNORM]:j.FLOAT,[s.RGB565]:j.FLOAT,[s.RGBA4]:j.FLOAT,[s.RGB5_A1]:j.FLOAT,[s.RGBA8]:j.FLOAT,[s.RGBA8_SNORM]:j.FLOAT,[s.RGB10_A2]:j.FLOAT,[s.RGB10_A2UI]:j.FLOAT,[s.SRGB8]:j.FLOAT,[s.SRGB8_ALPHA8]:j.FLOAT,[s.R16F]:j.FLOAT,[s.RG16F]:j.FLOAT,[s.RGB16F]:j.FLOAT,[s.RGBA16F]:j.FLOAT,[s.R32F]:j.FLOAT,[s.RG32F]:j.FLOAT,[s.RGB32F]:j.FLOAT,[s.RGBA32F]:j.FLOAT,[s.R11F_G11F_B10F]:j.FLOAT,[s.RGB9_E5]:j.FLOAT,[s.R8I]:j.INT,[s.R8UI]:j.UINT,[s.R16I]:j.INT,[s.R16UI]:j.UINT,[s.R32I]:j.INT,[s.R32UI]:j.UINT,[s.RG8I]:j.INT,[s.RG8UI]:j.UINT,[s.RG16I]:j.INT,[s.RG16UI]:j.UINT,[s.RG32I]:j.INT,[s.RG32UI]:j.UINT,[s.RGB8I]:j.INT,[s.RGB8UI]:j.UINT,[s.RGB16I]:j.INT,[s.RGB16UI]:j.UINT,[s.RGB32I]:j.INT,[s.RGB32UI]:j.UINT,[s.RGBA8I]:j.INT,[s.RGBA8UI]:j.UINT,[s.RGBA16I]:j.INT,[s.RGBA16UI]:j.UINT,[s.RGBA32I]:j.INT,[s.RGBA32UI]:j.UINT,[s.DEPTH_COMPONENT16]:j.FLOAT,[s.DEPTH_COMPONENT24]:j.FLOAT,[s.DEPTH_COMPONENT32F]:j.FLOAT,[s.DEPTH_STENCIL]:j.FLOAT,[s.DEPTH24_STENCIL8]:j.FLOAT,[s.DEPTH32F_STENCIL8]:j.FLOAT}:e={[s.RGB]:j.FLOAT,[s.RGBA]:j.FLOAT,[s.ALPHA]:j.FLOAT,[s.LUMINANCE]:j.FLOAT,[s.LUMINANCE_ALPHA]:j.FLOAT,[s.DEPTH_STENCIL]:j.FLOAT},e}function Zd(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[ae.UNSIGNED_BYTE]:{[H.RGBA]:s.RGBA8,[H.RGB]:s.RGB8,[H.RG]:s.RG8,[H.RED]:s.R8,[H.RGBA_INTEGER]:s.RGBA8UI,[H.RGB_INTEGER]:s.RGB8UI,[H.RG_INTEGER]:s.RG8UI,[H.RED_INTEGER]:s.R8UI,[H.ALPHA]:s.ALPHA,[H.LUMINANCE]:s.LUMINANCE,[H.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[ae.BYTE]:{[H.RGBA]:s.RGBA8_SNORM,[H.RGB]:s.RGB8_SNORM,[H.RG]:s.RG8_SNORM,[H.RED]:s.R8_SNORM,[H.RGBA_INTEGER]:s.RGBA8I,[H.RGB_INTEGER]:s.RGB8I,[H.RG_INTEGER]:s.RG8I,[H.RED_INTEGER]:s.R8I},[ae.UNSIGNED_SHORT]:{[H.RGBA_INTEGER]:s.RGBA16UI,[H.RGB_INTEGER]:s.RGB16UI,[H.RG_INTEGER]:s.RG16UI,[H.RED_INTEGER]:s.R16UI,[H.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[ae.SHORT]:{[H.RGBA_INTEGER]:s.RGBA16I,[H.RGB_INTEGER]:s.RGB16I,[H.RG_INTEGER]:s.RG16I,[H.RED_INTEGER]:s.R16I},[ae.UNSIGNED_INT]:{[H.RGBA_INTEGER]:s.RGBA32UI,[H.RGB_INTEGER]:s.RGB32UI,[H.RG_INTEGER]:s.RG32UI,[H.RED_INTEGER]:s.R32UI,[H.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[ae.INT]:{[H.RGBA_INTEGER]:s.RGBA32I,[H.RGB_INTEGER]:s.RGB32I,[H.RG_INTEGER]:s.RG32I,[H.RED_INTEGER]:s.R32I},[ae.FLOAT]:{[H.RGBA]:s.RGBA32F,[H.RGB]:s.RGB32F,[H.RG]:s.RG32F,[H.RED]:s.R32F,[H.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[ae.HALF_FLOAT]:{[H.RGBA]:s.RGBA16F,[H.RGB]:s.RGB16F,[H.RG]:s.RG16F,[H.RED]:s.R16F},[ae.UNSIGNED_SHORT_5_6_5]:{[H.RGB]:s.RGB565},[ae.UNSIGNED_SHORT_4_4_4_4]:{[H.RGBA]:s.RGBA4},[ae.UNSIGNED_SHORT_5_5_5_1]:{[H.RGBA]:s.RGB5_A1},[ae.UNSIGNED_INT_2_10_10_10_REV]:{[H.RGBA]:s.RGB10_A2,[H.RGBA_INTEGER]:s.RGB10_A2UI},[ae.UNSIGNED_INT_10F_11F_11F_REV]:{[H.RGB]:s.R11F_G11F_B10F},[ae.UNSIGNED_INT_5_9_9_9_REV]:{[H.RGB]:s.RGB9_E5},[ae.UNSIGNED_INT_24_8]:{[H.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[ae.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[H.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:e={[ae.UNSIGNED_BYTE]:{[H.RGBA]:s.RGBA,[H.RGB]:s.RGB,[H.ALPHA]:s.ALPHA,[H.LUMINANCE]:s.LUMINANCE,[H.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[ae.UNSIGNED_SHORT_5_6_5]:{[H.RGB]:s.RGB},[ae.UNSIGNED_SHORT_4_4_4_4]:{[H.RGBA]:s.RGBA},[ae.UNSIGNED_SHORT_5_5_5_1]:{[H.RGBA]:s.RGBA}},e}class Ol{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ue,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Zd(e),this.samplerTypes=Kd(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let i=0;i<t;i++)this.boundTextures[i]=null;this.emptyTextures={};const r=new gn(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new gn(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(e,t=0){const{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):i.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[i]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let n=e-1;n>=0;--n){const a=t[n];a&&a._glTextures[i].samplerType!==j.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(e){const t=new gn(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var r;t.internalFormat=((r=this.internalFormats[e.type])==null?void 0:r[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??j.FLOAT,this.webGLVersion===2&&e.type===ae.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var i;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const r=this.renderer;if(this.initTextureType(e,t),(i=e.resource)==null?void 0:i.upload(r,e,t))t.samplerType!==j.FLOAT&&(this.hasIntegerTextures=!0);else{const n=e.realWidth,a=e.realHeight,h=r.gl;(t.width!==n||t.height!==a||t.dirtyId<0)&&(t.width=n,t.height=a,h.texImage2D(e.target,0,t.internalFormat,n,a,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const i=this.managedTextures.indexOf(e);i!==-1&&gr(this.managedTextures,i,1)}}updateTextureStyle(e){var r;const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===lt.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=Mt.CLAMP:t.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const r=this.gl;if(t.mipmap&&e.mipmap!==lt.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===pt.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&e.anisotropicLevel>0&&e.scaleMode===pt.LINEAR){const n=Math.min(e.anisotropicLevel,r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===pt.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===pt.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Ol.extension={type:W.RendererSystem,name:"texture"};Q.add(Ol);class Ll{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:r,renderer:i}=this;t&&i.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:r,CONTEXT_UID:i}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[i]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let a=0;a<e.buffers.length;a++){const h=e.buffers[a];h&&(r.buffer.update(h),h._glBuffers[i].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,h._glBuffers[i].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){const r=e._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<e.buffers.length;a++){const h=e.buffers[a];if(!h)continue;const l=h._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&n.dispose(h,t))}r&&(t||i.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Ll.extension={type:W.RendererSystem,name:"transformFeedback"};Q.add(Ll);class Bi{constructor(e){this.renderer=e}init(e){this.screen=new ce(0,0,e.width,e.height),this.element=e.view||q.ADAPTER.createCanvas(),this.resolution=e.resolution||q.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Bi.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Bi.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_view"};Q.add(Bi);q.PREFER_ENV=Kt.WEBGL2;q.STRICT_TEXTURE_CACHE=!1;q.RENDER_OPTIONS={...Mi.defaultOptions,...Pi.defaultOptions,...Bi.defaultOptions,...Di.defaultOptions};Object.defineProperties(q,{WRAP_MODE:{get(){return ue.defaultOptions.wrapMode},set(s){fe("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ue.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return ue.defaultOptions.scaleMode},set(s){fe("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ue.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return ue.defaultOptions.mipmap},set(s){fe("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ue.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return ue.defaultOptions.anisotropicLevel},set(s){fe("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ue.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return fe("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Fe.defaultResolution},set(s){Fe.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return fe("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Fe.defaultMultisample},set(s){Fe.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return $t.defaultMaxTextures},set(s){fe("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),$t.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return $t.defaultBatchSize},set(s){fe("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),$t.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return $t.canUploadSameBuffer},set(s){fe("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),$t.canUploadSameBuffer=s}},GC_MODE:{get(){return Xt.defaultMode},set(s){fe("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Xt.defaultMode=s}},GC_MAX_IDLE:{get(){return Xt.defaultMaxIdle},set(s){fe("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Xt.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return Xt.defaultCheckCountMax},set(s){fe("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Xt.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return _t.defaultVertexPrecision},set(s){fe("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),_t.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return _t.defaultFragmentPrecision},set(s){fe("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),_t.defaultFragmentPrecision=s}}});var Yt=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Yt||{});class _n{constructor(e,t=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=i}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const Nl=class ke{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new _n(null,null,1/0),this.deltaMS=1/ke.targetFPMS,this.elapsedMS=1/ke.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Yt.NORMAL){return this._addListener(new _n(e,t,r))}addOnce(e,t,r=Yt.NORMAL){return this._addListener(new _n(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ke.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,ke.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ke._shared){const e=ke._shared=new ke;e.autoStart=!0,e._protected=!0}return ke._shared}static get system(){if(!ke._system){const e=ke._system=new ke;e.autoStart=!0,e._protected=!0}return ke._system}};Nl.targetFPMS=.06;let Ee=Nl;Object.defineProperties(q,{TARGET_FPMS:{get(){return Ee.targetFPMS},set(s){fe("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ee.targetFPMS=s}}});class kl{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Yt.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ee.shared:new Ee,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}kl.extension=W.Application;Q.add(kl);const Ul=[];Q.handleByList(W.Renderer,Ul);function Qd(s){for(const e of Ul)if(e.test(s))return new e(s);throw new Error("Unable to auto-detect a suitable renderer.")}var Jd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,ef=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const tf=Jd,Gl=ef;class Hl{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{const r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=Se.HIGH?this.multisample=Se.HIGH:t>=Se.MEDIUM?this.multisample=Se.MEDIUM:t>=Se.LOW?this.multisample=Se.LOW:this.multisample=Se.NONE}destroy(){}}Hl.extension={type:W.RendererSystem,name:"_multisample"};Q.add(Hl);class rf{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class $l{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,i.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[t]!==e){const n=e._glBuffers[i]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,r){const{gl:i,CONTEXT_UID:n}=this;r=r||0;const a=e._glBuffers[n]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,t||0,a.buffer,r*256,256)}update(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==i.updateID)if(i.updateID=e._updateID,t.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;i.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const r=e._glBuffers[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this),r&&(t||i.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new rf(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}$l.extension={type:W.RendererSystem,name:"buffer"};Q.add($l);class Xl{constructor(e){this.renderer=e}render(e,t){const r=this.renderer;let i,n,a,h;if(t&&(i=t.renderTexture,n=t.clear,a=t.transform,h=t.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(i||(this.lastObjectRendered=e),!h){const l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),i&&(t.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Xl.extension={type:W.RendererSystem,name:"objectRenderer"};Q.add(Xl);const bi=class Wn extends Yd{constructor(e){super(),this.type=zh.WEBGL,e=Object.assign({},q.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ze({projectionMatrix:new xe},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Wn.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(fe("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Wn.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:Ec()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return fe("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return fe("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return fe("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return fe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){fe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return fe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){fe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return fe("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};bi.extension={type:W.Renderer,priority:1},bi.__plugins={},bi.__systems={};let xa=bi;Q.handleByMap(W.RendererPlugin,xa.__plugins);Q.handleByMap(W.RendererSystem,xa.__systems);Q.add(xa);class Vl extends Hr{constructor(e,t){const{width:r,height:i}=t||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const a=new ue;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Hr?this.addResourceAt(e[r],r):this.addResourceAt(hl(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:r}=this.items[0];return this.resize(t,r),this.update(),Promise.resolve(this)}),this._load}}class sf extends Vl{constructor(e,t){const{width:r,height:i}=t||{};let n,a;Array.isArray(e)?(n=e,a=e.length):a=e,super(a,{width:r,height:i}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=mr.TEXTURE_2D_ARRAY}upload(e,t,r){const{length:i,itemDirtyIds:n,items:a}=this,{gl:h}=e;r.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,t.format,r.type,null);for(let l=0;l<i;l++){const c=a[l];n[l]<c.dirtyId&&(n[l]=c.dirtyId,c.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,t.format,r.type,c.resource.source))}return!0}}class nf extends xt{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Wl=class Lr extends Vl{constructor(e,t){const{width:r,height:i,autoLoad:n,linkBaseTexture:a}=t||{};if(e&&e.length!==Lr.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:i});for(let h=0;h<Lr.SIDES;h++)this.items[h].target=mr.TEXTURE_CUBE_MAP_POSITIVE_X+h;this.linkBaseTexture=a!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=mr.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=mr.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const i=this.itemDirtyIds;for(let n=0;n<Lr.SIDES;n++){const a=this.items[n];(i[n]<a.dirtyId||r.dirtyId<t.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,r),i[n]=a.dirtyId):i[n]<-1&&(e.gl.texImage2D(a.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Lr.SIDES}};Wl.SIDES=6;let af=Wl;class fr extends xt{constructor(e,t){t=t||{};let r,i,n;typeof e=="string"?(r=fr.EMPTY,i=e,n=!0):(r=e,i=null,n=!1),super(r),this.url=i,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??n,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const r=await q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(i,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Oe.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;t(r),this.onError.emit(r)}}),this._load)}upload(e,t,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return fr._EMPTY=fr._EMPTY??q.ADAPTER.createCanvas(0,0),fr._EMPTY}}const zn=class Ti extends xt{constructor(e,t){t=t||{},super(q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},Ti.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;xt.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),n=Math.round(n);const a=this.source;a.width=i,a.height=n,a._pixiId=`canvas_${qt()}`,a.getContext("2d").drawImage(e,0,0,t,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(e){const t=Ti.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Ti.SVG_XML.test(e)}};zn.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,zn.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let jn=zn;class of extends xt{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const qn=class Yn extends xt{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");t.autoLoad!==!1&&r.setAttribute("preload","auto"),t.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),t.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),t.loop===!0&&r.setAttribute("loop",""),t.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];xt.crossOrigin(r,i,t.crossorigin);for(let n=0;n<e.length;++n){const a=document.createElement("source");let{src:h,mime:l}=e[n];if(h=h||e[n],h.startsWith("data:"))l=h.slice(5,h.indexOf(";"));else if(!h.startsWith("blob:")){const c=h.split("?").shift().toLowerCase(),f=c.slice(c.lastIndexOf(".")+1);l=l||Yn.MIME_TYPES[f]||`video/${f}`}a.src=h,l&&(a.type=l),r.appendChild(a)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=Ee.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,r)=>{this.valid?t(this):(this._resolve=t,this._reject=r,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ee.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ee.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ee.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Yn.TYPES.includes(t)}};qn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let zl=qn;On.push(fr,_l,nf,zl,of,jn,Vi,af,sf);class Fi{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?ce.EMPTY:(e=e||new ce(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:r,b:i,c:n,d:a,tx:h,ty:l}=e,c=r*t.x+n*t.y+h,f=i*t.x+a*t.y+l;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,f),this.maxY=Math.max(this.maxY,f)}addQuad(e){let t=this.minX,r=this.minY,i=this.maxX,n=this.maxY,a=e[0],h=e[1];t=a<t?a:t,r=h<r?h:r,i=a>i?a:i,n=h>n?h:n,a=e[2],h=e[3],t=a<t?a:t,r=h<r?h:r,i=a>i?a:i,n=h>n?h:n,a=e[4],h=e[5],t=a<t?a:t,r=h<r?h:r,i=a>i?a:i,n=h>n?h:n,a=e[6],h=e[7],t=a<t?a:t,r=h<r?h:r,i=a>i?a:i,n=h>n?h:n,this.minX=t,this.minY=r,this.maxX=i,this.maxY=n}addFrame(e,t,r,i,n){this.addFrameMatrix(e.worldTransform,t,r,i,n)}addFrameMatrix(e,t,r,i,n){const a=e.a,h=e.b,l=e.c,c=e.d,f=e.tx,o=e.ty;let u=this.minX,d=this.minY,p=this.maxX,_=this.maxY,m=a*t+l*r+f,g=h*t+c*r+o;u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,_=g>_?g:_,m=a*i+l*r+f,g=h*i+c*r+o,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,_=g>_?g:_,m=a*t+l*n+f,g=h*t+c*n+o,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,_=g>_?g:_,m=a*i+l*n+f,g=h*i+c*n+o,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,_=g>_?g:_,this.minX=u,this.minY=d,this.maxX=p,this.maxY=_}addVertexData(e,t,r){let i=this.minX,n=this.minY,a=this.maxX,h=this.maxY;for(let l=t;l<r;l+=2){const c=e[l],f=e[l+1];i=c<i?c:i,n=f<n?f:n,a=c>a?c:a,h=f>h?f:h}this.minX=i,this.minY=n,this.maxX=a,this.maxY=h}addVertices(e,t,r,i){this.addVerticesMatrix(e.worldTransform,t,r,i)}addVerticesMatrix(e,t,r,i,n=0,a=n){const h=e.a,l=e.b,c=e.c,f=e.d,o=e.tx,u=e.ty;let d=this.minX,p=this.minY,_=this.maxX,m=this.maxY;for(let g=r;g<i;g+=2){const v=t[g],y=t[g+1],w=h*v+c*y+o,T=f*y+l*v+u;d=Math.min(d,w-n),_=Math.max(_,w+n),p=Math.min(p,T-a),m=Math.max(m,T+a)}this.minX=d,this.minY=p,this.maxX=_,this.maxY=m}addBounds(e){const t=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>i?e.maxX:i,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){const r=e.minX>t.minX?e.minX:t.minX,i=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=n&&i<=a){const h=this.minX,l=this.minY,c=this.maxX,f=this.maxY;this.minX=r<h?r:h,this.minY=i<l?i:l,this.maxX=n>c?n:c,this.maxY=a>f?a:f}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const r=e.minX>t.x?e.minX:t.x,i=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=n&&i<=a){const h=this.minX,l=this.minY,c=this.maxX,f=this.maxY;this.minX=r<h?r:h,this.minY=i<l?i:l,this.maxX=n>c?n:c,this.maxY=a>f?a:f}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,i,n,a){e-=n,t-=a,r+=n,i+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>i?this.maxY:i}}class Te extends Vr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ya,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Fi,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let r=0;r<t.length;++r){const i=t[r];Object.defineProperty(Te.prototype,i,Object.getOwnPropertyDescriptor(e,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new ce),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new ce),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Fi);const t=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=i,this._bounds.updateID+=this._boundsID-n,a}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,i){return t&&(e=t.toGlobal(e,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,r=1,i=1,n=0,a=0,h=0,l=0,c=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=a,this.skew.y=h,this.pivot.x=l,this.pivot.y=c,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new hf),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Jc}set angle(e){this.transform.rotation=e*ed}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class hf extends Te{constructor(){super(...arguments),this.sortDirty=null}}Te.prototype.displayObjectUpdateTransform=Te.prototype.updateTransform;const lf=new xe;function uf(s,e){return s.zIndex===e.zIndex?s._lastSortedIndex-e._lastSortedIndex:s.zIndex-e.zIndex}const jl=class Kn extends Te{constructor(){super(),this.children=[],this.sortableChildren=Kn.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);gr(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,gr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,gr(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,i=t,n=i-r;let a;if(n>0&&n<=i){a=this.children.splice(r,n);for(let h=0;h<a.length;++h)a[h].parent=null,a[h].transform&&(a[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let h=0;h<a.length;++h)a[h].emit("removed",this),this.emit("childRemoved",a[h],this,h);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(uf),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let i=0,n=this.children.length;i<n;++i){const a=this.children[i];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==Kn.prototype._render&&(r=this.getBounds(!0));const n=e.projection.transform;if(n&&(i?(i=lf.copyFrom(i),i.prepend(n)):i=n),r&&t.intersects(r,i))this._render(e);else if(this.cullArea)return;for(let a=0,h=this.children.length;a<h;++a){const l=this.children[a],c=l.cullable;l.cullable=c||!this.cullArea,l.render(e),l.cullable=c}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,i=this.children.length;r<i;++r)this.children[r].render(e)}}renderAdvanced(e){var n,a,h;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<t.length;l++)t[l].enabled&&this._enabledFilters.push(t[l])}const i=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Ce.NONE));if(i&&e.batch.flush(),t&&((a=this._enabledFilters)!=null&&a.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let l=0,c=this.children.length;l<c;++l)this.children[l].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&((h=this._enabledFilters)!=null&&h.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<r.length;++i)r[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};jl.defaultSortableChildren=!1;let Me=jl;Me.prototype.containerUpdateTransform=Me.prototype.updateTransform;Object.defineProperties(q,{SORTABLE_CHILDREN:{get(){return Me.defaultSortableChildren},set(s){fe("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Me.defaultSortableChildren=s}}});const Mr=new me,cf=new Uint16Array([0,1,2,0,2,3]);class Le extends Me{constructor(e){super(),this._anchor=new gt(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new ve(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=oe.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||K.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=cf,this.pluginName="batch",this.isSprite=!0,this._roundPixels=q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Rt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Rt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,r=t.a,i=t.b,n=t.c,a=t.d,h=t.tx,l=t.ty,c=this.vertexData,f=e.trim,o=e.orig,u=this._anchor;let d=0,p=0,_=0,m=0;if(f?(p=f.x-u._x*o.width,d=p+f.width,m=f.y-u._y*o.height,_=m+f.height):(p=-u._x*o.width,d=p+o.width,m=-u._y*o.height,_=m+o.height),c[0]=r*p+n*m+h,c[1]=a*m+i*p+l,c[2]=r*d+n*m+h,c[3]=a*m+i*d+l,c[4]=r*d+n*_+h,c[5]=a*_+i*d+l,c[6]=r*p+n*_+h,c[7]=a*_+i*p+l,this._roundPixels){const g=q.RESOLUTION;for(let v=0;v<c.length;++v)c[v]=Math.round(c[v]*g)/g}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,r=e.orig,i=this._anchor,n=this.transform.worldTransform,a=n.a,h=n.b,l=n.c,c=n.d,f=n.tx,o=n.ty,u=-i._x*r.width,d=u+r.width,p=-i._y*r.height,_=p+r.height;if(t[0]=a*u+l*p+f,t[1]=c*p+h*u+o,t[2]=a*d+l*p+f,t[3]=c*p+h*d+o,t[4]=a*d+l*_+f,t[5]=c*_+h*d+o,t[6]=a*u+l*_+f,t[7]=c*_+h*u+o,this._roundPixels){const m=q.RESOLUTION;for(let g=0;g<t.length;++g)t[g]=Math.round(t[g]*m)/m}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Fi),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ce),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Mr);const t=this._texture.orig.width,r=this._texture.orig.height,i=-t*this.anchor.x;let n=0;return Mr.x>=i&&Mr.x<i+t&&(n=-r*this.anchor.y,Mr.y>=n&&Mr.y<n+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const t=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const r=e instanceof K?e:K.from(e,t);return new Le(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Rt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Rt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||K.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const ql=new xe;Te.prototype._cacheAsBitmap=!1;Te.prototype._cacheData=null;Te.prototype._cacheAsBitmapResolution=null;Te.prototype._cacheAsBitmapMultisample=null;class df{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Te.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(s){if(this._cacheAsBitmap===s)return;this._cacheAsBitmap=s;let e;s?(this._cacheData||(this._cacheData=new df),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});Te.prototype._renderCached=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(s),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(s))};Te.prototype._initCachedDisplayObject=function(s){var u,d;if((u=this._cacheData)!=null&&u.sprite)return;const e=this.alpha;this.alpha=1,s.batch.flush();const t=this.getLocalBounds(new ce,!0);if((d=this.filters)!=null&&d.length){const p=this.filters[0].padding;t.pad(p)}const r=this.cacheAsBitmapResolution||s.resolution;t.ceil(r),t.width=Math.max(t.width,1/r),t.height=Math.max(t.height,1/r);const i=s.renderTexture.current,n=s.renderTexture.sourceFrame.clone(),a=s.renderTexture.destinationFrame.clone(),h=s.projection.transform,l=Zt.create({width:t.width,height:t.height,resolution:r,multisample:this.cacheAsBitmapMultisample??s.multisample}),c=`cacheAsBitmap_${qt()}`;this._cacheData.textureCacheId=c,ue.addToCache(l.baseTexture,c),K.addToCache(l,c);const f=this.transform.localTransform.copyTo(ql).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,s.render(this,{renderTexture:l,clear:!0,transform:f,skipUpdateTransform:!1}),s.framebuffer.blit(),s.projection.transform=h,s.renderTexture.bind(i,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const o=new Le(l);o.transform.worldTransform=this.transform.worldTransform,o.anchor.x=-(t.x/t.width),o.anchor.y=-(t.y/t.height),o.alpha=e,o._bounds=this._bounds,this._cacheData.sprite=o,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=o.containsPoint.bind(o)};Te.prototype._renderCachedCanvas=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(s),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(s))};Te.prototype._initCachedDisplayObjectCanvas=function(s){var f;if((f=this._cacheData)!=null&&f.sprite)return;const e=this.getLocalBounds(new ce,!0),t=this.alpha;this.alpha=1;const r=s.canvasContext.activeContext,i=s._projTransform,n=this.cacheAsBitmapResolution||s.resolution;e.ceil(n),e.width=Math.max(e.width,1/n),e.height=Math.max(e.height,1/n);const a=Zt.create({width:e.width,height:e.height,resolution:n}),h=`cacheAsBitmap_${qt()}`;this._cacheData.textureCacheId=h,ue.addToCache(a.baseTexture,h),K.addToCache(a,h);const l=ql;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,s.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),s.canvasContext.activeContext=r,s._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new Le(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=s._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)};Te.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Te.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Te.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ue.removeFromCache(this._cacheData.textureCacheId),K.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Te.prototype._cacheAsBitmapDestroy=function(s){this.cacheAsBitmap=!1,this.destroy(s)};Te.prototype.name=null;Me.prototype.getChildByName=function(s,e){for(let t=0,r=this.children.length;t<r;t++)if(this.children[t].name===s)return this.children[t];if(e)for(let t=0,r=this.children.length;t<r;t++){const i=this.children[t];if(!i.getChildByName)continue;const n=i.getChildByName(s,!0);if(n)return n}return null};Te.prototype.getGlobalPosition=function(s=new me,e=!1){return this.parent?this.parent.toGlobal(this.position,s,e):(s.x=this.position.x,s.y=this.position.y),s};var ff=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class pf extends Fe{constructor(e=1){super(tf,ff,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const mf={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},gf=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function _f(s){const e=mf[s],t=e.length;let r=gf,i="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let h=0;h<s;h++){let l=n.replace("%index%",h.toString());a=h,h>=t&&(a=s-h-1),l=l.replace("%value%",e[a].toString()),i+=l,i+=`
`}return r=r.replace("%blur%",i),r=r.replace("%size%",s.toString()),r}const yf=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function vf(s,e){const t=Math.ceil(s/2);let r=yf,i="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<s;a++){let h=n.replace("%index%",a.toString());h=h.replace("%sampleIndex%",`${a-(t-1)}.0`),i+=h,i+=`
`}return r=r.replace("%blur%",i),r=r.replace("%size%",s.toString()),r}class Zn extends Fe{constructor(e,t=8,r=4,i=Fe.defaultResolution,n=5){const a=vf(n,e),h=_f(n);super(a,h),this.horizontal=e,this.resolution=i,this._quality=0,this.quality=r,this.blur=t}apply(e,t,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/t.width):this.uniforms.strength=1/r.height*(r.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,r,i);else{const n=e.getFilterTexture(),a=e.renderer;let h=t,l=n;this.state.blend=!1,e.applyFilter(this,h,l,nt.CLEAR);for(let c=1;c<this.passes-1;c++){e.bindAndClear(h,nt.BLIT),this.uniforms.uSampler=l;const f=l;l=h,h=f,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,r,i),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class xf extends Fe{constructor(e=8,t=4,r=Fe.defaultResolution,i=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Zn(!0,e,t,r,i),this.blurYFilter=new Zn(!1,e,t,r,i),this.resolution=r,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,r,i){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const h=e.getFilterTexture();this.blurXFilter.apply(e,t,h,nt.CLEAR),this.blurYFilter.apply(e,h,r,i),e.returnFilterTexture(h)}else a?this.blurYFilter.apply(e,t,r,i):this.blurXFilter.apply(e,t,r,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var bf=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Qn extends Fe{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Gl,bf,e),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){const[r,i,n]=ve.shared.setValue(e).toArray(),a=[r,0,0,0,0,0,i,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const r=Math.cos(e),i=Math.sin(e),n=Math.sqrt,a=1/3,h=n(a),l=r+(1-r)*a,c=a*(1-r)-h*i,f=a*(1-r)+h*i,o=a*(1-r)+h*i,u=r+a*(1-r),d=a*(1-r)-h*i,p=a*(1-r)-h*i,_=a*(1-r)+h*i,m=r+a*(1-r),g=[l,c,f,0,0,o,u,d,0,0,p,_,m,0,0,0,0,0,1,0];this._loadMatrix(g,t)}contrast(e,t){const r=(e||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){const r=e*2/3+1,i=(r-1)*-.5,n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,i,n){e=e||.2,t=t||.15,r=r||16770432,i=i||3375104;const a=ve.shared,[h,l,c]=a.setValue(r).toArray(),[f,o,u]=a.setValue(i).toArray(),d=[.3,.59,.11,0,0,h,l,c,e,0,f,o,u,t,0,h-f,l-o,c-u,0,0];this._loadMatrix(d,n)}night(e,t){e=e||.1;const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Qn.prototype.grayscale=Qn.prototype.greyscale;var Tf=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,Af=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class wf extends Fe{constructor(e,t){const r=new xe;e.renderable=!1,super(Af,Tf,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,t==null&&(t=20),this.scale=new me(t,t)}apply(e,t,r,i){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),h=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&h!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/h,this.uniforms.rotation[3]=n.d/h),e.applyFilter(this,t,r,i)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var Ef=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Sf=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class If extends Fe{constructor(){super(Sf,Ef)}}var Cf=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class Rf extends Fe{constructor(e=.5,t=Math.random()){super(Gl,Cf,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const gh={AlphaFilter:pf,BlurFilter:xf,BlurFilterPass:Zn,ColorMatrixFilter:Qn,DisplacementFilter:wf,FXAAFilter:If,NoiseFilter:Rf};Object.entries(gh).forEach(([s,e])=>{Object.defineProperty(gh,s,{get(){return fe("7.1.0",`filters.${s} has moved to ${s}`),e}})});class Pf{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Ee.system.add(this.tickerUpdate,this,Yt.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ee.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Ct=new Pf;class Wr{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Wr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new me,this.page=new me,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,i,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Oi extends Wr{constructor(){super(...arguments),this.client=new me,this.movement=new me,this.offset=new me,this.global=new me,this.screen=new me}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,i,n,a,h,l,c,f,o,u,d,p,_){throw new Error("Method not implemented.")}}class je extends Oi{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class yr extends Oi{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}yr.DOM_DELTA_PIXEL=0,yr.DOM_DELTA_LINE=1,yr.DOM_DELTA_PAGE=2;const Mf=2048,Df=new me,yn=new me;class Bf{constructor(e){this.dispatch=new Vr,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((r,i)=>r.priority-i.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let r=0,i=t.length;r<i;r++)t[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Ct.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",i=this[r](this.rootTarget,this.rootTarget.eventMode,Df.set(e,t),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(e,t){if(!e.target)return;const r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,n=r.length-1;i<n;i++)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const i=Array.isArray(t)?t:[t];for(let n=r.length-1;n>=0;n--)i.forEach(a=>{e.currentTarget=r[n],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let r=0;r<Mf&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,r,i,n,a=!1){let h=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Ct.pauseUpdate=!1),e.interactiveChildren&&e.children){const f=e.children;for(let o=f.length-1;o>=0;o--){const u=f[o],d=this.hitTestMoveRecursive(u,this._isInteractive(t)?t:u.eventMode,r,i,n,a||n(e,r));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const p=e.isInteractive();(d.length>0||p)&&(p&&this._allInteractiveElements.push(e),d.push(e)),this._hitElements.length===0&&(this._hitElements=d),h=!0}}}const l=this._isInteractive(t),c=e.isInteractive();return l&&c&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:h?this._hitElements:l&&!n(e,r)&&i(e,r)?c?[e]:[]:null}hitTestRecursive(e,t,r,i,n){if(this._interactivePrune(e)||n(e,r))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Ct.pauseUpdate=!1),e.interactiveChildren&&e.children){const l=e.children;for(let c=l.length-1;c>=0;c--){const f=l[c],o=this.hitTestRecursive(f,this._isInteractive(t)?t:f.eventMode,r,i,n);if(o){if(o.length>0&&!o[o.length-1].parent)continue;const u=e.isInteractive();return(o.length>0||u)&&o.push(e),o}}}const a=this._isInteractive(t),h=e.isInteractive();return a&&i(e,r)?h?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var r;if(e.hitArea&&(e.worldTransform.applyInverse(t,yn),!e.hitArea.contains(yn.x,yn.y)))return!0;if(e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;if(i&&!((r=i.containsPoint)!=null&&r.call(i,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var n,a;t=t??e.type;const r=`on${t}`;(a=(n=e.currentTarget)[r])==null||a.call(n,e);const i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const i=t.button===2;this.dispatchEvent(t,i?"rightdown":"mousedown")}const r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var l,c;if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const r=t.pointerType==="mouse"||t.pointerType==="pen",i=this.trackingData(e.pointerId),n=this.findMountedTarget(i.overTargets);if(((l=i.overTargets)==null?void 0:l.length)>0&&n!==t.target){const f=e.type==="mousemove"?"mouseout":"pointerout",o=this.createPointerEvent(e,f,n);if(this.dispatchEvent(o,"pointerout"),r&&this.dispatchEvent(o,"mouseout"),!t.composedPath().includes(n)){const u=this.createPointerEvent(e,"pointerleave",n);for(u.eventPhase=u.AT_TARGET;u.target&&!t.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(o)}if(n!==t.target){const f=e.type==="mousemove"?"mouseover":"pointerover",o=this.clonePointerEvent(t,f);this.dispatchEvent(o,"pointerover"),r&&this.dispatchEvent(o,"mouseover");let u=n==null?void 0:n.parent;for(;u&&u!==this.rootTarget.parent&&u!==t.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const d=this.clonePointerEvent(t,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==n&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(o)}const a=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(t,"pointermove"),h&&a.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),h&&a.push("globaltouchmove")),r&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),h&&a.push("globalmousemove"),this.cursor=(c=t.target)==null?void 0:c.cursor),a.length>0&&this.all(t,a),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var a;if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),i=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(a=r.target)==null?void 0:a.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const r=e.pointerType==="mouse"||e.pointerType==="pen",i=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(e,"pointerleave",i);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.dispatchEvent(r,h?"rightup":"mouseup")}const i=this.trackingData(e.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[e.button]);let a=n;if(n&&!r.composedPath().includes(n)){let h=n;for(;h&&!r.composedPath().includes(h);){if(r.currentTarget=h,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}h=h.parent}delete i.pressTargetsByButton[e.button],a=h}if(a){const h=this.clonePointerEvent(r,"click");h.target=a,h.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:h.target,timeStamp:t});const l=i.clicksByButton[e.button];if(l.target===h.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=h.target,l.timeStamp=t,h.detail=l.clickCount,h.pointerType==="mouse"){const c=h.button===2;this.dispatchEvent(h,c?"rightclick":"click")}else h.pointerType==="touch"&&this.dispatchEvent(h,"tap");this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(r){let n=r;for(;n;)i.currentTarget=n,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof yr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){const i=this.allocateEvent(je);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=r??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],typeof t=="string"&&(i.type=t),i}createWheelEvent(e){const t=this.allocateEvent(yr);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const r=this.allocateEvent(je);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t??r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof je&&t instanceof je&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Oi&&t instanceof Oi&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const r=e.currentTarget._events[t];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let i=0,n=r.length;i<n&&!e.propagationImmediatelyStopped;i++)r[i].once&&e.currentTarget.removeListener(t,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,e)}}const Ff=1,Of={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Jn=class ea{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Bf(null),Ct.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new je(null),this.rootWheelEvent=new yr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ea.defaultEventFeatures},{set:(t,r,i)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[r]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r,ea._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,i=t.length;r<i;r++){const n=t[r],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ct.pointerMoved();const t=this.normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const r=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(e);for(let n=0,a=i.length;n<a;n++){const h=this.bootstrapEvent(this.rootPointerEvent,i[n]);h.type+=r,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Ct.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ct.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ct.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*n,e.y=(r-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,i=e.changedTouches.length;r<i;r++){const n=e.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=Ff),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Of[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};Jn.extension={name:"events",type:[W.RendererSystem,W.CanvasRendererSystem]},Jn.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let ta=Jn;Q.add(ta);function _h(s){return s==="dynamic"||s==="static"}const Lf={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??_h(ta.defaultEventMode)},set interactive(s){fe("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=s,this.eventMode=s?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??ta.defaultEventMode},set eventMode(s){this._internalInteractive=_h(s),this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof t=="object"?t.signal:void 0,n=typeof t=="object"?t.once===!0:!1,a=typeof e=="function"?void 0:e;s=r?`${s}capture`:s;const h=typeof e=="function"?e:e.handleEvent,l=this;i&&i.addEventListener("abort",()=>{l.off(s,h,a)}),n?l.once(s,h,a):l.on(s,h,a)},removeEventListener(s,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof e=="function"?void 0:e;s=r?`${s}capture`:s,e=typeof e=="function"?e:e.handleEvent,this.off(s,e,i)},dispatchEvent(s){if(!(s instanceof Wr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};Te.mixin(Lf);const Nf={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Te.mixin(Nf);const kf=9,oi=100,Uf=0,Gf=0,yh=2,vh=1,Hf=-1e3,$f=-1e3,Xf=2;class Yl{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(mt.tablet||mt.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${oi}px`,t.style.height=`${oi}px`,t.style.position="absolute",t.style.top=`${Uf}px`,t.style.left=`${Gf}px`,t.style.zIndex=yh.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${vh}px`,e.style.height=`${vh}px`,e.style.position="absolute",e.style.top=`${Hf}px`,e.style.left=`${$f}px`,e.style.zIndex=Xf.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}update(){const e=performance.now();if(mt.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:r,width:i,height:n}=this.renderer.view.getBoundingClientRect(),{width:a,height:h,resolution:l}=this.renderer,c=i/a*l,f=n/h*l;let o=this.div;o.style.left=`${t}px`,o.style.top=`${r}px`,o.style.width=`${a}px`,o.style.height=`${h}px`;for(let u=0;u<this.children.length;u++){const d=this.children[u];if(d.renderId!==this.renderId)d._accessibleActive=!1,gr(this.children,u,1),this.div.removeChild(d._accessibleDiv),this.pool.push(d._accessibleDiv),d._accessibleDiv=null,u--;else{o=d._accessibleDiv;let p=d.hitArea;const _=d.worldTransform;d.hitArea?(o.style.left=`${(_.tx+p.x*_.a)*c}px`,o.style.top=`${(_.ty+p.y*_.d)*f}px`,o.style.width=`${p.width*_.a*c}px`,o.style.height=`${p.height*_.d*f}px`):(p=d.getBounds(),this.capHitArea(p),o.style.left=`${p.x*c}px`,o.style.top=`${p.y*f}px`,o.style.width=`${p.width*c}px`,o.style.height=`${p.height*f}px`,o.title!==d.accessibleTitle&&d.accessibleTitle!==null&&(o.title=d.accessibleTitle),o.getAttribute("aria-label")!==d.accessibleHint&&d.accessibleHint!==null&&o.setAttribute("aria-label",d.accessibleHint)),(d.accessibleTitle!==o.title||d.tabIndex!==o.tabIndex)&&(o.title=d.accessibleTitle,o.tabIndex=d.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:r}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${oi}px`,t.style.height=`${oi}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=yh.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:r}=e.target,i=this.renderer.events.rootBoundary,n=Object.assign(new Wr(i),{target:r});i.rootTarget=this.renderer.lastObjectRendered,t.forEach(a=>i.dispatchEvent(n,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===kf&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Yl.extension={name:"accessibility",type:[W.RendererPlugin,W.CanvasRendererPlugin]};Q.add(Yl);const Kl=class ra{constructor(e){this.stage=new Me,e=Object.assign({forceCanvas:!1},e),this.renderer=Qd(e),ra._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const r=ra._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Kl._plugins=[];let Zl=Kl;Q.handleByList(W.Application,Zl._plugins);class Ql{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,r=n}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ql.extension=W.Application;Q.add(Ql);const xh={loader:W.LoadParser,resolver:W.ResolveParser,cache:W.CacheParser,detection:W.DetectionParser};Q.handle(W.Asset,s=>{const e=s.ref;Object.entries(xh).filter(([t])=>!!e[t]).forEach(([t,r])=>Q.add(Object.assign(e[t],{extension:e[t].extension??r})))},s=>{const e=s.ref;Object.keys(xh).filter(t=>!!e[t]).forEach(t=>Q.remove(e[t]))});class Vf{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function wr(s,e){if(Array.isArray(e)){for(const t of e)if(s.startsWith(`data:${t}`))return!0;return!1}return s.startsWith(`data:${e}`)}function Bt(s,e){const t=s.split("?")[0],r=Pe.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const Ye=(s,e,t=!1)=>(Array.isArray(s)||(s=[s]),e?s.map(r=>typeof r=="string"||t?e(r):r):s),ia=(s,e)=>{const t=e.split("?")[1];return t&&(s+=`?${t}`),s};function Jl(s,e,t,r,i){const n=e[t];for(let a=0;a<n.length;a++){const h=n[a];t<e.length-1?Jl(s.replace(r[t],h),e,t+1,r,i):i.push(s.replace(r[t],h))}}function Wf(s){const e=/\{(.*?)\}/g,t=s.match(e),r=[];if(t){const i=[];t.forEach(n=>{const a=n.substring(1,n.length-1).split(",");i.push(a)}),Jl(s,i,0,t,r)}else r.push(s);return r}const Li=s=>!Array.isArray(s);class zf{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const r=Ye(e);let i;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.test(t)){i=l.getCacheableAssets(r,t);break}}i||(i={},r.forEach(h=>{i[h]=t}));const n=Object.keys(i),a={cacheKeys:n,keys:r};if(r.forEach(h=>{this._cacheMap.set(h,a)}),n.forEach(h=>{const l=i?i[h]:t;this._cache.has(h)&&this._cache.get(h)!==l&&console.warn("[Cache] already has key:",h),this._cache.set(h,i[h])}),t instanceof K){const h=t;r.forEach(l=>{h.baseTexture!==K.EMPTY.baseTexture&&ue.addToCache(h.baseTexture,l),K.addToCache(h,l)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(r=>{this._cache.delete(r)}),t.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const Vt=new zf;class jf{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const r={promise:null,parser:null};return r.promise=(async()=>{var a,h;let i=null,n=null;if(t.loadParser&&(n=this._parserHash[t.loadParser],n||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!n){for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.load&&((a=c.test)!=null&&a.call(c,e,t,this))){n=c;break}}if(!n)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await n.load(e,t,this),r.parser=n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];c.parse&&c.parse&&await((h=c.testParse)==null?void 0:h.call(c,i,t,this))&&(i=await c.parse(i,t,this)||i,r.parser=c)}return i})(),r}async load(e,t){this._parsersValidated||this._validateParsers();let r=0;const i={},n=Li(e),a=Ye(e,c=>({alias:[c],src:c})),h=a.length,l=a.map(async c=>{const f=Pe.toAbsolute(c.src);if(!i[c.src])try{this.promiseCache[f]||(this.promiseCache[f]=this._getLoadPromiseAndParser(f,c)),i[c.src]=await this.promiseCache[f].promise,t&&t(++r/h)}catch(o){throw delete this.promiseCache[f],delete i[c.src],new Error(`[Loader.load] Failed to load ${f}.
${o}`)}});return await Promise.all(l),n?i[a[0].src]:i}async unload(e){const t=Ye(e,r=>({alias:[r],src:r})).map(async r=>{var a,h;const i=Pe.toAbsolute(r.src),n=this.promiseCache[i];if(n){const l=await n.promise;delete this.promiseCache[i],(h=(a=n.parser)==null?void 0:a.unload)==null||h.call(a,l,r,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var Je=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Je||{});const qf=".json",Yf="application/json",Kf={extension:{type:W.LoadParser,priority:Je.Low},name:"loadJson",test(s){return wr(s,Yf)||Bt(s,qf)},async load(s){return await(await q.ADAPTER.fetch(s)).json()}};Q.add(Kf);const Zf=".txt",Qf="text/plain",Jf={name:"loadTxt",extension:{type:W.LoadParser,priority:Je.Low},test(s){return wr(s,Qf)||Bt(s,Zf)},async load(s){return await(await q.ADAPTER.fetch(s)).text()}};Q.add(Jf);const ep=["normal","bold","100","200","300","400","500","600","700","800","900"],tp=[".ttf",".otf",".woff",".woff2"],rp=["font/ttf","font/otf","font/woff","font/woff2"],ip=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function sp(s){const e=Pe.extname(s),t=Pe.basename(s,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let r=t.length>0;for(const n of t)if(!n.match(ip)){r=!1;break}let i=t.join(" ");return r||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}const np=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function ap(s){return np.test(s)?s:encodeURI(s)}const op={extension:{type:W.LoadParser,priority:Je.Low},name:"loadWebFont",test(s){return wr(s,rp)||Bt(s,tp)},async load(s,e){var r,i,n;const t=q.ADAPTER.getFontFaceSet();if(t){const a=[],h=((r=e.data)==null?void 0:r.family)??sp(s),l=((n=(i=e.data)==null?void 0:i.weights)==null?void 0:n.filter(f=>ep.includes(f)))??["normal"],c=e.data??{};for(let f=0;f<l.length;f++){const o=l[f],u=new FontFace(h,`url(${ap(s)})`,{...c,weight:o});await u.load(),t.add(u),a.push(u)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(e=>q.ADAPTER.getFontFaceSet().delete(e))}};Q.add(op);const hp=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let vr=null,sa=class{constructor(){vr||(vr=URL.createObjectURL(new Blob([hp],{type:"application/javascript"}))),this.worker=new Worker(vr)}};sa.revokeObjectURL=function(){vr&&(URL.revokeObjectURL(vr),vr=null)};const lp=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let xr=null;class eu{constructor(){xr||(xr=URL.createObjectURL(new Blob([lp],{type:"application/javascript"}))),this.worker=new Worker(xr)}}eu.revokeObjectURL=function(){xr&&(URL.revokeObjectURL(xr),xr=null)};let bh=0,vn;class up{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new sa;t.addEventListener("message",r=>{t.terminate(),sa.revokeObjectURL(),e(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){vn===void 0&&(vn=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<vn&&(this._createdWorkers++,e=new eu().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const r=new Promise((i,n)=>{this.queue.push({id:e,arguments:t,resolve:i,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),r=t.id;this.resolveHash[bh]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:bh++,id:r})}}const Th=new up;function zr(s,e,t){s.resource.internal=!0;const r=new K(s),i=()=>{delete e.promiseCache[t],Vt.has(t)&&Vt.remove(t)};return r.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),i())}),r.once("destroyed",()=>{s.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),r}const cp=[".jpeg",".jpg",".png",".webp",".avif"],dp=["image/jpeg","image/png","image/webp","image/avif"];async function fp(s){const e=await q.ADAPTER.fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const Yi={name:"loadTextures",extension:{type:W.LoadParser,priority:Je.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return wr(s,dp)||Bt(s,cp)},async load(s,e,t){var h;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let i;r?this.config.preferWorkers&&await Th.isImageBitmapSupported()?i=await Th.loadImageBitmap(s):i=await fp(s):i=await new Promise((l,c)=>{const f=new Image;f.crossOrigin=this.config.crossOrigin,f.src=s,f.complete?l(f):(f.onload=()=>l(f),f.onerror=o=>c(o))});const n={...e.data};n.resolution??(n.resolution=vt(s)),r&&((h=n.resourceOptions)==null?void 0:h.ownsImageBitmap)===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const a=new ue(i,n);return a.resource.src=s,zr(a,t,s)},unload(s){s.destroy(!0)}};Q.add(Yi);const pp=".svg",mp="image/svg+xml",gp={extension:{type:W.LoadParser,priority:Je.High},name:"loadSVG",test(s){return wr(s,mp)||Bt(s,pp)},async testParse(s){return jn.test(s)},async parse(s,e,t){var n;const r=new jn(s,(n=e==null?void 0:e.data)==null?void 0:n.resourceOptions);await r.load();const i=new ue(r,{resolution:vt(s),...e==null?void 0:e.data});return i.resource.src=e.src,zr(i,t,e.src)},async load(s,e){return(await q.ADAPTER.fetch(s)).text()},unload:Yi.unload};Q.add(gp);const _p=[".mp4",".m4v",".webm",".ogv"],yp=["video/mp4","video/webm","video/ogg"],vp={name:"loadVideo",extension:{type:W.LoadParser,priority:Je.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(s){return wr(s,yp)||Bt(s,_p)},async load(s,e,t){var a;let r;const i=await(await q.ADAPTER.fetch(s)).blob(),n=URL.createObjectURL(i);try{const h={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(a=e==null?void 0:e.data)==null?void 0:a.resourceOptions,autoLoad:!0},l=new zl(n,h);await l.load();const c=new ue(l,{alphaMode:await wc(),resolution:vt(s),...e==null?void 0:e.data});c.resource.src=s,r=zr(c,t,s),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(h){throw URL.revokeObjectURL(n),h}return r},unload(s){s.destroy(!0)}};Q.add(vp);class xp{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(t[r])}`).join("&")}}getAlias(e){const{alias:t,name:r,src:i,srcs:n}=e;return Ye(t||r||i||n,a=>typeof a=="string"?a:Array.isArray(a)?a.map(h=>(h==null?void 0:h.src)??(h==null?void 0:h.srcs)??h):a!=null&&a.src||a!=null&&a.srcs?a.src??a.srcs:a,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const r=[];Array.isArray(t)?t.forEach(i=>{const n=i.src??i.srcs,a=i.alias??i.name;let h;if(typeof a=="string"){const l=this._createBundleAssetId(e,a);r.push(l),h=[a,l]}else{const l=a.map(c=>this._createBundleAssetId(e,c));r.push(...l),h=[...a,...l]}this.add({...i,alias:h,src:n})}):Object.keys(t).forEach(i=>{const n=[i,this._createBundleAssetId(e,i)];if(typeof t[i]=="string")this.add({alias:n,src:t[i]});else if(Array.isArray(t[i]))this.add({alias:n,src:t[i]});else{const a=t[i],h=a.src??a.srcs;this.add({...a,alias:n,src:Array.isArray(h)?h:[h]})}r.push(...n)}),this._bundles[e]=r}add(e,t,r,i,n){const a=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(fe("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:e,src:t,data:r,format:i,loadParser:n})):Array.isArray(e)?a.push(...e):a.push(e);let h;h=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},Ye(a).forEach(l=>{const{src:c,srcs:f}=l;let{data:o,format:u,loadParser:d}=l;const p=Ye(c||f).map(g=>typeof g=="string"?Wf(g):Array.isArray(g)?g:[g]),_=this.getAlias(l);Array.isArray(_)?_.forEach(h):h(_);const m=[];p.forEach(g=>{g.forEach(v=>{let y={};if(typeof v!="object"){y.src=v;for(let w=0;w<this._parsers.length;w++){const T=this._parsers[w];if(T.test(v)){y=T.parse(v);break}}}else o=v.data??o,u=v.format??u,d=v.loadParser??d,y={...y,...v};if(!_)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this.buildResolvedAsset(y,{aliases:_,data:o,format:u,loadParser:d}),m.push(y)})}),_.forEach(g=>{this._assetMap[g]=m})})}resolveBundle(e){const t=Li(e);e=Ye(e);const r={};return e.forEach(i=>{const n=this._bundles[i];if(n){const a=this.resolve(n),h={};for(const l in a){const c=a[l];h[this._extractAssetIdFromBundle(i,l)]=c}r[i]=h}}),t?r[e[0]]:r}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const r={};for(const i in t)r[i]=t[i].src;return r}return t.src}resolve(e){const t=Li(e);e=Ye(e);const r={};return e.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let n=this._assetMap[i];const a=n[0],h=this._getPreferredOrder(n);h==null||h.priority.forEach(l=>{h.params[l].forEach(c=>{const f=n.filter(o=>o[l]?o[l]===c:!1);f.length&&(n=f)})}),this._resolverHash[i]=n[0]??a}else this._resolverHash[i]=this.buildResolvedAsset({alias:[i],src:i},{});r[i]=this._resolverHash[i]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const r=e[0],i=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:r,data:i,loadParser:n,format:a}=t;return(this._basePath||this._rootPath)&&(e.src=Pe.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=r??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...i||{},...e.data},e.loadParser=n??e.loadParser,e.format=a??e.format??Pe.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class bp{constructor(){this._detections=[],this._initialized=!1,this.resolver=new xp,this.loader=new jf,this.cache=Vt,this._backgroundLoader=new Vf(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var n,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let h=e.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const t=((n=e.texturePreference)==null?void 0:n.resolution)??1,r=typeof t=="number"?[t]:t,i=await this._detectFormats({preferredFormats:(a=e.texturePreference)==null?void 0:a.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,r,i,n){this.resolver.add(e,t,r,i,n)}async load(e,t){this._initialized||await this.init();const r=Li(e),i=Ye(e).map(h=>{if(typeof h!="string"){const l=this.resolver.getAlias(h);return l.some(c=>!this.resolver.hasKey(c))&&this.add(h),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(h)||this.add({alias:h,src:h}),h}),n=this.resolver.resolve(i),a=await this._mapLoadToResolve(n,t);return r?a[i[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);const i=this.resolver.resolveBundle(e),n={},a=Object.keys(i);let h=0,l=0;const c=()=>{t==null||t(++h/l)},f=a.map(o=>{const u=i[o];return l+=Object.keys(u).length,this._mapLoadToResolve(u,c).then(d=>{n[o]=d})});return await Promise.all(f),r?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Vt.get(e);const t={};for(let r=0;r<e.length;r++)t[r]=Vt.get(e[r]);return t}async _mapLoadToResolve(e,t){const r=Object.values(e),i=Object.keys(e);this._backgroundLoader.active=!1;const n=await this.loader.load(r,t);this._backgroundLoader.active=!0;const a={};return r.forEach((h,l)=>{const c=n[h.src],f=[h.src];h.alias&&f.push(...h.alias),a[i[l]]=c,Vt.set(f,c)}),a}async unload(e){this._initialized||await this.init();const t=Ye(e).map(i=>typeof i!="string"?i.src:i),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=Ye(e);const t=this.resolver.resolveBundle(e),r=Object.keys(t).map(i=>this._unloadFromResolved(t[i]));await Promise.all(r)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(r=>{Vt.remove(r.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const r of e.detections)e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((r,i)=>t.indexOf(r)===i),t}get detections(){return this._detections}get preferWorkers(){return Yi.config.preferWorkers}set preferWorkers(e){fe("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(r=>r in e).forEach(r=>{t.config[r]=e[r]})})}}const hi=new bp;Q.handleByList(W.LoadParser,hi.loader.parsers).handleByList(W.ResolveParser,hi.resolver.parsers).handleByList(W.CacheParser,hi.cache.parsers).handleByList(W.DetectionParser,hi.detections);const Tp={extension:W.CacheParser,test:s=>Array.isArray(s)&&s.every(e=>e instanceof K),getCacheableAssets:(s,e)=>{const t={};return s.forEach(r=>{e.forEach((i,n)=>{t[r+(n===0?"":n+1)]=i})}),t}};Q.add(Tp);async function tu(s){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(s)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Ap={extension:{type:W.DetectionParser,priority:1},test:async()=>tu("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(e=>e!=="avif")};Q.add(Ap);const wp={extension:{type:W.DetectionParser,priority:0},test:async()=>tu("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(e=>e!=="webp")};Q.add(wp);const Ah=["png","jpg","jpeg"],Ep={extension:{type:W.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...Ah],remove:async s=>s.filter(e=>!Ah.includes(e))};Q.add(Ep);const Sp="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ba(s){return Sp?!1:document.createElement("video").canPlayType(s)!==""}const Ip={extension:{type:W.DetectionParser,priority:0},test:async()=>ba("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(e=>e!=="webm")};Q.add(Ip);const Cp={extension:{type:W.DetectionParser,priority:0},test:async()=>ba("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(e=>e!=="mp4"&&e!=="m4v")};Q.add(Cp);const Rp={extension:{type:W.DetectionParser,priority:0},test:async()=>ba("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(e=>e!=="ogv")};Q.add(Rp);const Pp={extension:W.ResolveParser,test:Yi.test,parse:s=>{var e;return{resolution:parseFloat(((e=q.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:Pe.extname(s).slice(1),src:s}}};Q.add(Pp);var De=(s=>(s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",s[s.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",s[s.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",s[s.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",s[s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",s[s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",s[s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",s))(De||{});const Ni={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let rt,ur;function wh(){ur={bptc:rt.getExtension("EXT_texture_compression_bptc"),astc:rt.getExtension("WEBGL_compressed_texture_astc"),etc:rt.getExtension("WEBGL_compressed_texture_etc"),s3tc:rt.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:rt.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:rt.getExtension("WEBGL_compressed_texture_pvrtc")||rt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:rt.getExtension("WEBGL_compressed_texture_etc1"),atc:rt.getExtension("WEBGL_compressed_texture_atc")}}const Mp={extension:{type:W.DetectionParser,priority:2},test:async()=>{const s=q.ADAPTER.createCanvas().getContext("webgl");return s?(rt=s,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async s=>{ur||wh();const e=[];for(const t in ur)ur[t]&&e.push(t);return[...e,...s]},remove:async s=>(ur||wh(),s.filter(e=>!(e in ur)))};Q.add(Mp);class Dp extends Vi{constructor(e,t={width:1,height:1,autoLoad:!0}){let r,i;typeof e=="string"?(r=e,i=new Uint8Array):(r=null,i=e),super(i,t),this.origin=r,this.buffer=i?new Fn(i):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Fn(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class jt extends Dp{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=jt._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||jt._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,r){const i=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;i.pixelStorei(i.UNPACK_ALIGNMENT,4);for(let n=0,a=this.levels;n<a;n++){const{levelID:h,levelWidth:l,levelHeight:c,levelBuffer:f}=this._levelBuffers[n];i.compressedTexImage2D(i.TEXTURE_2D,h,this.format,l,c,0,f)}return!0}onBlobLoaded(){this._levelBuffers=jt._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,r,i,n,a,h){const l=new Array(r);let c=e.byteOffset,f=a,o=h,u=f+i-1&~(i-1),d=o+n-1&~(n-1),p=u*d*Ni[t];for(let _=0;_<r;_++)l[_]={levelID:_,levelWidth:r>1?f:u,levelHeight:r>1?o:d,levelBuffer:new Uint8Array(e.buffer,c,p)},c+=p,f=f>>1||1,o=o>>1||1,u=f+i-1&~(i-1),d=o+n-1&~(n-1),p=u*d*Ni[t];return l}}const xn=4,li=124,Bp=32,Eh=20,Fp=542327876,ui={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Op={FOURCC:2},ci={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},Lp=1,Np=2,kp=4,Up=64,Gp=512,Hp=131072,$p=827611204,Xp=861165636,Vp=894720068,Wp=808540228,zp=4,jp={[$p]:De.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Xp]:De.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Vp]:De.COMPRESSED_RGBA_S3TC_DXT5_EXT},qp={70:De.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:De.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:De.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:De.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:De.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:De.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:De.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:De.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:De.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:De.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:De.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:De.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:De.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Yp(s){const e=new Uint32Array(s);if(e[0]!==Fp)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(s,0,li/Uint32Array.BYTES_PER_ELEMENT),r=t[ui.HEIGHT],i=t[ui.WIDTH],n=t[ui.MIPMAP_COUNT],a=new Uint32Array(s,ui.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Bp/Uint32Array.BYTES_PER_ELEMENT),h=a[Lp];if(h&kp){const l=a[Op.FOURCC];if(l!==Wp){const v=jp[l],y=xn+li,w=new Uint8Array(s,y);return[new jt(w,{format:v,width:i,height:r,levels:n})]}const c=xn+li,f=new Uint32Array(e.buffer,c,Eh/Uint32Array.BYTES_PER_ELEMENT),o=f[ci.DXGI_FORMAT],u=f[ci.RESOURCE_DIMENSION],d=f[ci.MISC_FLAG],p=f[ci.ARRAY_SIZE],_=qp[o];if(_===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${o}`);if(d===zp)throw new Error("DDSParser does not support cubemap textures");if(u===6)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,g=xn+li+Eh;if(p===1)m.push(new Uint8Array(s,g));else{const v=Ni[_];let y=0,w=i,T=r;for(let b=0;b<n;b++){const B=Math.max(1,w+3&-4),N=Math.max(1,T+3&-4),U=B*N*v;y+=U,w=w>>>1,T=T>>>1}let R=g;for(let b=0;b<p;b++)m.push(new Uint8Array(s,R,y)),R+=y}return m.map(v=>new jt(v,{format:_,width:i,height:r,levels:n}))}throw h&Up?new Error("DDSParser does not support uncompressed texture data."):h&Gp?new Error("DDSParser does not supported YUV uncompressed texture data."):h&Hp?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&Np?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Sh=[171,75,84,88,32,49,49,187,13,10,26,10],Kp=67305985,We={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},na=64,Ih={[ae.UNSIGNED_BYTE]:1,[ae.UNSIGNED_SHORT]:2,[ae.INT]:4,[ae.UNSIGNED_INT]:4,[ae.FLOAT]:4,[ae.HALF_FLOAT]:8},Zp={[H.RGBA]:4,[H.RGB]:3,[H.RG]:2,[H.RED]:1,[H.LUMINANCE]:1,[H.LUMINANCE_ALPHA]:2,[H.ALPHA]:1},Qp={[ae.UNSIGNED_SHORT_4_4_4_4]:2,[ae.UNSIGNED_SHORT_5_5_5_1]:2,[ae.UNSIGNED_SHORT_5_6_5]:2};function Jp(s,e,t=!1){const r=new DataView(e);if(!em(s,r))return null;const i=r.getUint32(We.ENDIANNESS,!0)===Kp,n=r.getUint32(We.GL_TYPE,i),a=r.getUint32(We.GL_FORMAT,i),h=r.getUint32(We.GL_INTERNAL_FORMAT,i),l=r.getUint32(We.PIXEL_WIDTH,i),c=r.getUint32(We.PIXEL_HEIGHT,i)||1,f=r.getUint32(We.PIXEL_DEPTH,i)||1,o=r.getUint32(We.NUMBER_OF_ARRAY_ELEMENTS,i)||1,u=r.getUint32(We.NUMBER_OF_FACES,i),d=r.getUint32(We.NUMBER_OF_MIPMAP_LEVELS,i),p=r.getUint32(We.BYTES_OF_KEY_VALUE_DATA,i);if(c===0||f!==1)throw new Error("Only 2D textures are supported");if(u!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(o!==1)throw new Error("WebGL does not support array textures");const _=4,m=4,g=l+3&-4,v=c+3&-4,y=new Array(o);let w=l*c;n===0&&(w=g*v);let T;if(n!==0?Ih[n]?T=Ih[n]*Zp[a]:T=Qp[n]:T=Ni[h],T===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const R=t?rm(r,p,i):null;let b=w*T,B=l,N=c,U=g,V=v,C=na+p;for(let M=0;M<d;M++){const k=r.getUint32(C,i);let z=C+4;for(let A=0;A<o;A++){let E=y[A];E||(E=y[A]=new Array(d)),E[M]={levelID:M,levelWidth:d>1||n!==0?B:U,levelHeight:d>1||n!==0?N:V,levelBuffer:new Uint8Array(e,z,b)},z+=b}C+=k+4,C=C%4!==0?C+4-C%4:C,B=B>>1||1,N=N>>1||1,U=B+_-1&-4,V=N+m-1&-4,b=U*V*T}return n!==0?{uncompressed:y.map(M=>{let k=M[0].levelBuffer,z=!1;return n===ae.FLOAT?k=new Float32Array(M[0].levelBuffer.buffer,M[0].levelBuffer.byteOffset,M[0].levelBuffer.byteLength/4):n===ae.UNSIGNED_INT?(z=!0,k=new Uint32Array(M[0].levelBuffer.buffer,M[0].levelBuffer.byteOffset,M[0].levelBuffer.byteLength/4)):n===ae.INT&&(z=!0,k=new Int32Array(M[0].levelBuffer.buffer,M[0].levelBuffer.byteOffset,M[0].levelBuffer.byteLength/4)),{resource:new Vi(k,{width:M[0].levelWidth,height:M[0].levelHeight}),type:n,format:z?tm(a):a}}),kvData:R}:{compressed:y.map(M=>new jt(null,{format:h,width:l,height:c,levels:d,levelBuffers:M})),kvData:R}}function em(s,e){for(let t=0;t<Sh.length;t++)if(e.getUint8(t)!==Sh[t])return console.error(`${s} is not a valid *.ktx file!`),!1;return!0}function tm(s){switch(s){case H.RGBA:return H.RGBA_INTEGER;case H.RGB:return H.RGB_INTEGER;case H.RG:return H.RG_INTEGER;case H.RED:return H.RED_INTEGER;default:return s}}function rm(s,e,t){const r=new Map;let i=0;for(;i<e;){const n=s.getUint32(na+i,t),a=na+i+4,h=3-(n+3)%4;if(n===0||n>e-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&s.getUint8(a+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=new TextDecoder().decode(new Uint8Array(s.buffer,a,l)),f=new DataView(s.buffer,a+l+1,n-l-1);r.set(c,f),i+=4+n+h}return r}const im={extension:{type:W.LoadParser,priority:Je.High},name:"loadDDS",test(s){return Bt(s,".dds")},async load(s,e,t){const r=await(await q.ADAPTER.fetch(s)).arrayBuffer(),i=Yp(r).map(n=>{const a=new ue(n,{mipmap:lt.OFF,alphaMode:Oe.NO_PREMULTIPLIED_ALPHA,resolution:vt(s),...e.data});return zr(a,t,s)});return i.length===1?i[0]:i},unload(s){Array.isArray(s)?s.forEach(e=>e.destroy(!0)):s.destroy(!0)}};Q.add(im);const sm={extension:{type:W.LoadParser,priority:Je.High},name:"loadKTX",test(s){return Bt(s,".ktx")},async load(s,e,t){const r=await(await q.ADAPTER.fetch(s)).arrayBuffer(),{compressed:i,uncompressed:n,kvData:a}=Jp(s,r),h=i??n,l={mipmap:lt.OFF,alphaMode:Oe.NO_PREMULTIPLIED_ALPHA,resolution:vt(s),...e.data},c=h.map(f=>{h===n&&Object.assign(l,{type:f.type,format:f.format});const o=f.resource??f,u=new ue(o,l);return u.ktxKeyValueData=a,zr(u,t,s)});return c.length===1?c[0]:c},unload(s){Array.isArray(s)?s.forEach(e=>e.destroy(!0)):s.destroy(!0)}};Q.add(sm);const nm=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],am={extension:W.ResolveParser,test:s=>{const e=Pe.extname(s).slice(1);return["basis","ktx","dds"].includes(e)},parse:s=>{var r,i;const e=s.split("."),t=e.pop();if(["ktx","dds"].includes(t)){const n=e.pop();if(nm.includes(n))return{resolution:parseFloat(((r=q.RETINA_PREFIX.exec(s))==null?void 0:r[1])??"1"),format:n,src:s}}return{resolution:parseFloat(((i=q.RETINA_PREFIX.exec(s))==null?void 0:i[1])??"1"),format:t,src:s}}};Q.add(am);const di=new ce,om=4,ru=class Nr{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,r,i){const n=new Image;return n.src=await this.base64(e,t,r,i),n}async base64(e,t,r,i){const n=this.canvas(e,i);if(n.toBlob!==void 0)return new Promise((a,h)=>{n.toBlob(l=>{if(!l){h(new Error("ICanvas.toBlob failed!"));return}const c=new FileReader;c.onload=()=>a(c.result),c.onerror=h,c.readAsDataURL(l)},t,r)});if(n.toDataURL!==void 0)return n.toDataURL(t,r);if(n.convertToBlob!==void 0){const a=await n.convertToBlob({type:t,quality:r});return new Promise((h,l)=>{const c=new FileReader;c.onload=()=>h(c.result),c.onerror=l,c.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:r,width:i,height:n,flipY:a,premultipliedAlpha:h}=this._rawPixels(e,t);a&&Nr._flipY(r,i,n),h&&Nr._unpremultiplyAlpha(r);const l=new Gc(i,n,1),c=new ImageData(new Uint8ClampedArray(r.buffer),i,n);return l.context.putImageData(c,0,0),l.canvas}pixels(e,t){const{pixels:r,width:i,height:n,flipY:a,premultipliedAlpha:h}=this._rawPixels(e,t);return a&&Nr._flipY(r,i,n),h&&Nr._unpremultiplyAlpha(r),r}_rawPixels(e,t){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let i,n=!1,a=!1,h,l=!1;e&&(e instanceof Zt?h=e:(h=r.generateTexture(e,{region:t,resolution:r.resolution,multisample:r.multisample}),l=!0,t&&(di.width=t.width,di.height=t.height,t=di)));const c=r.gl;if(h){if(i=h.baseTexture.resolution,t=t??h.frame,n=!1,a=h.baseTexture.alphaMode>0&&h.baseTexture.format===H.RGBA,!l){r.renderTexture.bind(h);const d=h.framebuffer.glFramebuffers[r.CONTEXT_UID];d.blitFramebuffer&&r.framebuffer.bind(d.blitFramebuffer)}}else i=r.resolution,t||(t=di,t.width=r.width/i,t.height=r.height/i),n=!0,a=this._rendererPremultipliedAlpha,r.renderTexture.bind();const f=Math.max(Math.round(t.width*i),1),o=Math.max(Math.round(t.height*i),1),u=new Uint8Array(om*f*o);return c.readPixels(Math.round(t.x*i),Math.round(t.y*i),f,o,c.RGBA,c.UNSIGNED_BYTE,u),l&&(h==null||h.destroy(!0)),{pixels:u,width:f,height:o,flipY:n,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(e,t,r){const i=t<<2,n=r>>1,a=new Uint8Array(i);for(let h=0;h<n;h++){const l=h*i,c=(r-h-1)*i;a.set(e.subarray(l,l+i)),e.copyWithin(l,c,c+i),e.set(a,c)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let r=0;r<t;r+=4){const i=e[r+3];if(i!==0){const n=255.001/i;e[r]=e[r]*n+.5,e[r+1]=e[r+1]*n+.5,e[r+2]=e[r+2]*n+.5}}}};ru.extension={name:"extract",type:W.RendererSystem};let hm=ru;Q.add(hm);const ki={build(s){const e=s.points;let t,r,i,n,a,h;if(s.type===Be.CIRC){const p=s.shape;t=p.x,r=p.y,a=h=p.radius,i=n=0}else if(s.type===Be.ELIP){const p=s.shape;t=p.x,r=p.y,a=p.width,h=p.height,i=n=0}else{const p=s.shape,_=p.width/2,m=p.height/2;t=p.x+_,r=p.y+m,a=h=Math.max(0,Math.min(p.radius,Math.min(_,m))),i=_-a,n=m-h}if(!(a>=0&&h>=0&&i>=0&&n>=0)){e.length=0;return}const l=Math.ceil(2.3*Math.sqrt(a+h)),c=l*8+(i?4:0)+(n?4:0);if(e.length=c,c===0)return;if(l===0){e.length=8,e[0]=e[6]=t+i,e[1]=e[3]=r+n,e[2]=e[4]=t-i,e[5]=e[7]=r-n;return}let f=0,o=l*4+(i?2:0)+2,u=o,d=c;{const p=i+a,_=n,m=t+p,g=t-p,v=r+_;if(e[f++]=m,e[f++]=v,e[--o]=v,e[--o]=g,n){const y=r-_;e[u++]=g,e[u++]=y,e[--d]=y,e[--d]=m}}for(let p=1;p<l;p++){const _=Math.PI/2*(p/l),m=i+Math.cos(_)*a,g=n+Math.sin(_)*h,v=t+m,y=t-m,w=r+g,T=r-g;e[f++]=v,e[f++]=w,e[--o]=w,e[--o]=y,e[u++]=y,e[u++]=T,e[--d]=T,e[--d]=v}{const p=i,_=n+h,m=t+p,g=t-p,v=r+_,y=r-_;e[f++]=m,e[f++]=v,e[--d]=y,e[--d]=m,i&&(e[f++]=g,e[f++]=v,e[--d]=y,e[--d]=g)}},triangulate(s,e){const t=s.points,r=e.points,i=e.indices;if(t.length===0)return;let n=r.length/2;const a=n;let h,l;if(s.type!==Be.RREC){const f=s.shape;h=f.x,l=f.y}else{const f=s.shape;h=f.x+f.width/2,l=f.y+f.height/2}const c=s.matrix;r.push(s.matrix?c.a*h+c.c*l+c.tx:h,s.matrix?c.b*h+c.d*l+c.ty:l),n++,r.push(t[0],t[1]);for(let f=2;f<t.length;f+=2)r.push(t[f],t[f+1]),i.push(n++,a,n);i.push(a+1,a,n)}};function Ch(s,e=!1){const t=s.length;if(t<6)return;let r=0;for(let i=0,n=s[t-2],a=s[t-1];i<t;i+=2){const h=s[i],l=s[i+1];r+=(h-n)*(l+a),n=h,a=l}if(!e&&r>0||e&&r<=0){const i=t/2;for(let n=i+i%2;n<t;n+=2){const a=t-n-2,h=t-n-1,l=n,c=n+1;[s[a],s[l]]=[s[l],s[a]],[s[h],s[c]]=[s[c],s[h]]}}}const iu={build(s){s.points=s.shape.points.slice()},triangulate(s,e){let t=s.points;const r=s.holes,i=e.points,n=e.indices;if(t.length>=6){Ch(t,!1);const a=[];for(let c=0;c<r.length;c++){const f=r[c];Ch(f.points,!0),a.push(t.length/2),t=t.concat(f.points)}const h=ku(t,a,2);if(!h)return;const l=i.length/2;for(let c=0;c<h.length;c+=3)n.push(h[c]+l),n.push(h[c+1]+l),n.push(h[c+2]+l);for(let c=0;c<t.length;c++)i.push(t[c])}}},lm={build(s){const e=s.shape,t=e.x,r=e.y,i=e.width,n=e.height,a=s.points;a.length=0,i>=0&&n>=0&&a.push(t,r,t+i,r,t+i,r+n,t,r+n)},triangulate(s,e){const t=s.points,r=e.points;if(t.length===0)return;const i=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},um={build(s){ki.build(s)},triangulate(s,e){ki.triangulate(s,e)}};var Ue=(s=>(s.MITER="miter",s.BEVEL="bevel",s.ROUND="round",s))(Ue||{}),Pt=(s=>(s.BUTT="butt",s.ROUND="round",s.SQUARE="square",s))(Pt||{});const Tr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(s,e=20){if(!this.adaptive||!s||isNaN(s))return e;let t=Math.ceil(s/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class Rh{static curveTo(e,t,r,i,n,a){const h=a[a.length-2],l=a[a.length-1]-t,c=h-e,f=i-t,o=r-e,u=Math.abs(l*o-c*f);if(u<1e-8||n===0)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;const d=l*l+c*c,p=f*f+o*o,_=l*f+c*o,m=n*Math.sqrt(d)/u,g=n*Math.sqrt(p)/u,v=m*_/d,y=g*_/p,w=m*o+g*c,T=m*f+g*l,R=c*(g+v),b=l*(g+v),B=o*(m+y),N=f*(m+y),U=Math.atan2(b-T,R-w),V=Math.atan2(N-T,B-w);return{cx:w+e,cy:T+t,radius:n,startAngle:U,endAngle:V,anticlockwise:c*f>o*l}}static arc(e,t,r,i,n,a,h,l,c){const f=h-a,o=Tr._segmentsCount(Math.abs(f)*n,Math.ceil(Math.abs(f)/Ri)*40),u=f/(o*2),d=u*2,p=Math.cos(u),_=Math.sin(u),m=o-1,g=m%1/m;for(let v=0;v<=m;++v){const y=v+g*v,w=u+a+d*y,T=Math.cos(w),R=-Math.sin(w);c.push((p*T+_*R)*n+r,(p*-R+_*T)*n+i)}}}class cm{constructor(){this.reset()}begin(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Ta{static curveLength(e,t,r,i,n,a,h,l){let c=0,f=0,o=0,u=0,d=0,p=0,_=0,m=0,g=0,v=0,y=0,w=e,T=t;for(let R=1;R<=10;++R)f=R/10,o=f*f,u=o*f,d=1-f,p=d*d,_=p*d,m=_*e+3*p*f*r+3*d*o*n+u*h,g=_*t+3*p*f*i+3*d*o*a+u*l,v=w-m,y=T-g,w=m,T=g,c+=Math.sqrt(v*v+y*y);return c}static curveTo(e,t,r,i,n,a,h){const l=h[h.length-2],c=h[h.length-1];h.length-=2;const f=Tr._segmentsCount(Ta.curveLength(l,c,e,t,r,i,n,a));let o=0,u=0,d=0,p=0,_=0;h.push(l,c);for(let m=1,g=0;m<=f;++m)g=m/f,o=1-g,u=o*o,d=u*o,p=g*g,_=p*g,h.push(d*l+3*u*g*e+3*o*p*r+_*n,d*c+3*u*g*t+3*o*p*i+_*a)}}function Ph(s,e,t,r,i,n,a,h){const l=s-t*i,c=e-r*i,f=s+t*n,o=e+r*n;let u,d;a?(u=r,d=-t):(u=-r,d=t);const p=l+u,_=c+d,m=f+u,g=o+d;return h.push(p,_,m,g),2}function Nt(s,e,t,r,i,n,a,h){const l=t-s,c=r-e;let f=Math.atan2(l,c),o=Math.atan2(i-s,n-e);h&&f<o?f+=Math.PI*2:!h&&f>o&&(o+=Math.PI*2);let u=f;const d=o-f,p=Math.abs(d),_=Math.sqrt(l*l+c*c),m=(15*p*Math.sqrt(_)/Math.PI>>0)+1,g=d/m;if(u+=g,h){a.push(s,e,t,r);for(let v=1,y=u;v<m;v++,y+=g)a.push(s,e,s+Math.sin(y)*_,e+Math.cos(y)*_);a.push(s,e,i,n)}else{a.push(t,r,s,e);for(let v=1,y=u;v<m;v++,y+=g)a.push(s+Math.sin(y)*_,e+Math.cos(y)*_,s,e);a.push(i,n,s,e)}return m*2}function dm(s,e){const t=s.shape;let r=s.points||t.points.slice();const i=e.closePointEps;if(r.length===0)return;const n=s.lineStyle,a=new me(r[0],r[1]),h=new me(r[r.length-2],r[r.length-1]),l=t.type!==Be.POLY||t.closeStroke,c=Math.abs(a.x-h.x)<i&&Math.abs(a.y-h.y)<i;if(l){r=r.slice(),c&&(r.pop(),r.pop(),h.set(r[r.length-2],r[r.length-1]));const E=(a.x+h.x)*.5,x=(h.y+a.y)*.5;r.unshift(E,x),r.push(E,x)}const f=e.points,o=r.length/2;let u=r.length;const d=f.length/2,p=n.width/2,_=p*p,m=n.miterLimit*n.miterLimit;let g=r[0],v=r[1],y=r[2],w=r[3],T=0,R=0,b=-(v-w),B=g-y,N=0,U=0,V=Math.sqrt(b*b+B*B);b/=V,B/=V,b*=p,B*=p;const C=n.alignment,M=(1-C)*2,k=C*2;l||(n.cap===Pt.ROUND?u+=Nt(g-b*(M-k)*.5,v-B*(M-k)*.5,g-b*M,v-B*M,g+b*k,v+B*k,f,!0)+2:n.cap===Pt.SQUARE&&(u+=Ph(g,v,b,B,M,k,!0,f))),f.push(g-b*M,v-B*M,g+b*k,v+B*k);for(let E=1;E<o-1;++E){g=r[(E-1)*2],v=r[(E-1)*2+1],y=r[E*2],w=r[E*2+1],T=r[(E+1)*2],R=r[(E+1)*2+1],b=-(v-w),B=g-y,V=Math.sqrt(b*b+B*B),b/=V,B/=V,b*=p,B*=p,N=-(w-R),U=y-T,V=Math.sqrt(N*N+U*U),N/=V,U/=V,N*=p,U*=p;const x=y-g,P=v-w,S=y-T,I=R-w,O=x*S+P*I,F=P*S-I*x,G=F<0;if(Math.abs(F)<.001*Math.abs(O)){f.push(y-b*M,w-B*M,y+b*k,w+B*k),O>=0&&(n.join===Ue.ROUND?u+=Nt(y,w,y-b*M,w-B*M,y-N*M,w-U*M,f,!1)+4:u+=2,f.push(y-N*k,w-U*k,y+N*M,w+U*M));continue}const $=(-b+g)*(-B+w)-(-b+y)*(-B+v),Y=(-N+T)*(-U+w)-(-N+y)*(-U+R),Z=(x*Y-S*$)/F,J=(I*$-P*Y)/F,ie=(Z-y)*(Z-y)+(J-w)*(J-w),X=y+(Z-y)*M,te=w+(J-w)*M,se=y-(Z-y)*k,le=w-(J-w)*k,pe=Math.min(x*x+P*P,S*S+I*I),re=G?M:k,ne=pe+re*re*_,Ae=ie<=ne;let Ie=n.join;if(Ie===Ue.MITER&&ie/_>m&&(Ie=Ue.BEVEL),Ae)switch(Ie){case Ue.MITER:{f.push(X,te,se,le);break}case Ue.BEVEL:{G?f.push(X,te,y+b*k,w+B*k,X,te,y+N*k,w+U*k):f.push(y-b*M,w-B*M,se,le,y-N*M,w-U*M,se,le),u+=2;break}case Ue.ROUND:{G?(f.push(X,te,y+b*k,w+B*k),u+=Nt(y,w,y+b*k,w+B*k,y+N*k,w+U*k,f,!0)+4,f.push(X,te,y+N*k,w+U*k)):(f.push(y-b*M,w-B*M,se,le),u+=Nt(y,w,y-b*M,w-B*M,y-N*M,w-U*M,f,!1)+4,f.push(y-N*M,w-U*M,se,le));break}}else{switch(f.push(y-b*M,w-B*M,y+b*k,w+B*k),Ie){case Ue.MITER:{G?f.push(se,le,se,le):f.push(X,te,X,te),u+=2;break}case Ue.ROUND:{G?u+=Nt(y,w,y+b*k,w+B*k,y+N*k,w+U*k,f,!0)+2:u+=Nt(y,w,y-b*M,w-B*M,y-N*M,w-U*M,f,!1)+2;break}}f.push(y-N*M,w-U*M,y+N*k,w+U*k),u+=2}}g=r[(o-2)*2],v=r[(o-2)*2+1],y=r[(o-1)*2],w=r[(o-1)*2+1],b=-(v-w),B=g-y,V=Math.sqrt(b*b+B*B),b/=V,B/=V,b*=p,B*=p,f.push(y-b*M,w-B*M,y+b*k,w+B*k),l||(n.cap===Pt.ROUND?u+=Nt(y-b*(M-k)*.5,w-B*(M-k)*.5,y-b*M,w-B*M,y+b*k,w+B*k,f,!1)+2:n.cap===Pt.SQUARE&&(u+=Ph(y,w,b,B,M,k,!1,f)));const z=e.indices,A=Tr.epsilon*Tr.epsilon;for(let E=d;E<u+d-2;++E)g=f[E*2],v=f[E*2+1],y=f[(E+1)*2],w=f[(E+1)*2+1],T=f[(E+2)*2],R=f[(E+2)*2+1],!(Math.abs(g*(w-R)+y*(R-v)+T*(v-w))<A)&&z.push(E,E+1,E+2)}function fm(s,e){let t=0;const r=s.shape,i=s.points||r.points,n=r.type!==Be.POLY||r.closeStroke;if(i.length===0)return;const a=e.points,h=e.indices,l=i.length/2,c=a.length/2;let f=c;for(a.push(i[0],i[1]),t=1;t<l;t++)a.push(i[t*2],i[t*2+1]),h.push(f,f+1),f++;n&&h.push(f,c)}function Mh(s,e){s.lineStyle.native?fm(s,e):dm(s,e)}class Aa{static curveLength(e,t,r,i,n,a){const h=e-2*r+n,l=t-2*i+a,c=2*r-2*e,f=2*i-2*t,o=4*(h*h+l*l),u=4*(h*c+l*f),d=c*c+f*f,p=2*Math.sqrt(o+u+d),_=Math.sqrt(o),m=2*o*_,g=2*Math.sqrt(d),v=u/_;return(m*p+_*u*(p-g)+(4*d*o-u*u)*Math.log((2*_+v+p)/(v+g)))/(4*m)}static curveTo(e,t,r,i,n){const a=n[n.length-2],h=n[n.length-1],l=Tr._segmentsCount(Aa.curveLength(a,h,e,t,r,i));let c=0,f=0;for(let o=1;o<=l;++o){const u=o/l;c=a+(e-a)*u,f=h+(t-h)*u,n.push(c+(e+(r-e)*u-c)*u,f+(t+(i-t)*u-f)*u)}}}const bn={[Be.POLY]:iu,[Be.CIRC]:ki,[Be.ELIP]:ki,[Be.RECT]:lm,[Be.RREC]:um},Dh=[],fi=[];class Ui{constructor(e,t=null,r=null,i=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=i,this.type=e.type}clone(){return new Ui(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ar=new me,su=class nu extends ll{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Fi,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),fi.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Dh.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,i=null){const n=new Ui(e,t,r,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new Ui(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const i=t[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,ar):ar.copyFrom(e),i.shape.contains(ar.x,ar.y))){let n=!1;if(i.holes){for(let a=0;a<i.holes.length;a++)if(i.holes[a].shape.contains(ar.x,ar.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let l=this.shapeIndex;l<t.length;l++){this.shapeIndex++;const c=t[l],f=c.fillStyle,o=c.lineStyle;bn[c.type].build(c),c.matrix&&this.transformPoints(c.points,c.matrix),(f.visible||o.visible)&&this.processHoles(c.holes);for(let u=0;u<2;u++){const d=u===0?f:o;if(!d.visible)continue;const p=d.texture.baseTexture,_=this.indices.length,m=this.points.length/2;p.wrapMode=Mt.REPEAT,u===0?this.processFill(c):this.processLine(c);const g=this.points.length/2-m;g!==0&&(r&&!this._compareStyles(i,d)&&(r.end(_,m),r=null),r||(r=Dh.pop()||new cm,r.begin(d,_,m),this.batches.push(r),i=d),this.addUvs(this.points,e,d.texture,m,g,d.matrix))}}const n=this.indices.length,a=this.points.length/2;if(r&&r.end(n,a),this.batches.length===0){this.batchable=!0;return}const h=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&h===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=h?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const i=e[t];for(let n=0;n<i.size;n++){const a=i.start+n;this.indicesUint16[a]=this.indicesUint16[a]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<nu.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++ue._globalBatch;for(let o=0;o<this.drawCalls.length;o++)this.drawCalls[o].texArray.clear(),fi.push(this.drawCalls[o]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let i=fi.pop();i||(i=new Nn,i.texArray=new Hn),i.texArray.count=0,i.start=0,i.size=0,i.type=at.TRIANGLES;let n=0,a=null,h=0,l=!1,c=at.TRIANGLES,f=0;this.drawCalls.push(i);for(let o=0;o<this.batches.length;o++){const u=this.batches[o],d=8,p=u.style,_=p.texture.baseTexture;l!==!!p.native&&(l=!!p.native,c=l?at.LINES:at.TRIANGLES,a=null,n=d,e++),a!==_&&(a=_,_._batchEnabled!==e&&(n===d&&(e++,n=0,i.size>0&&(i=fi.pop(),i||(i=new Nn,i.texArray=new Hn),this.drawCalls.push(i)),i.start=f,i.size=0,i.texArray.count=0,i.type=c),_.touched=1,_._batchEnabled=e,_._batchLocation=n,_.wrapMode=Mt.REPEAT,i.texArray.elements[i.texArray.count++]=_,n++)),i.size+=u.size,f+=u.size,h=_._batchLocation,this.addColors(t,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(r,h,u.attribSize,u.attribStart)}ue._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(e.length*3*4),a=new Float32Array(n),h=new Uint32Array(n);let l=0;for(let c=0;c<e.length/2;c++)a[l++]=e[c*2],a[l++]=e[c*2+1],a[l++]=t[c*2],a[l++]=t[c*2+1],h[l++]=r[c],a[l++]=i[c];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?iu.triangulate(e,this):bn[e.type].triangulate(e,this)}processLine(e){Mh(e,this);for(let t=0;t<e.holes.length;t++)Mh(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];bn[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const i=e[r*2],n=e[r*2+1];e[r*2]=t.a*i+t.c*n+t.tx,e[r*2+1]=t.b*i+t.d*n+t.ty}}addColors(e,t,r,i,n=0){const a=ve.shared.setValue(t).toLittleEndianNumber(),h=ve.shared.setValue(a).toPremultiplied(r);e.length=Math.max(e.length,n+i);for(let l=0;l<i;l++)e[n+l]=h}addTextureIds(e,t,r,i=0){e.length=Math.max(e.length,i+r);for(let n=0;n<r;n++)e[i+n]=t}addUvs(e,t,r,i,n,a=null){let h=0;const l=t.length,c=r.frame;for(;h<n;){let o=e[(i+h)*2],u=e[(i+h)*2+1];if(a){const d=a.a*o+a.c*u+a.tx;u=a.b*o+a.d*u+a.ty,o=d}h++,t.push(o/c.width,u/c.height)}const f=r.baseTexture;(c.width<f.width||c.height<f.height)&&this.adjustUvs(t,r,l,n)}adjustUvs(e,t,r,i){const n=t.baseTexture,a=1e-6,h=r+i*2,l=t.frame,c=l.width/n.width,f=l.height/n.height;let o=l.x/l.width,u=l.y/l.height,d=Math.floor(e[r]+a),p=Math.floor(e[r+1]+a);for(let _=r+2;_<h;_+=2)d=Math.min(d,Math.floor(e[_]+a)),p=Math.min(p,Math.floor(e[_+1]+a));o-=d,u-=p;for(let _=r;_<h;_+=2)e[_]=(e[_]+o)*c,e[_+1]=(e[_+1]+u)*f}};su.BATCHABLE_SIZE=100;let pm=su;class Ki{constructor(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Ki;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class wa extends Ki{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Pt.BUTT,this.join=Ue.MITER,this.miterLimit=10}clone(){const e=new wa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Pt.BUTT,this.join=Ue.MITER,this.miterLimit=10}}const Tn={},aa=class Ai extends Me{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ki,this._lineStyle=new wa,this._matrix=null,this._holeMode=!1,this.state=ut.for2d(),this._geometry=e||new pm,this._geometry.refCount++,this._transformID=-1,this._tintColor=new ve(16777215),this.blendMode=oe.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ai(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r,i=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:i,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:K.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Pt.BUTT,join:Ue.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new zt,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new zt,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return(i!==e||n!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Aa.curveTo(e,t,r,i,n),this}bezierCurveTo(e,t,r,i,n,a){return this._initCurve(),Ta.curveTo(e,t,r,i,n,a,this.currentPath.points),this}arcTo(e,t,r,i,n){this._initCurve(e,t);const a=this.currentPath.points,h=Rh.curveTo(e,t,r,i,n,a);if(h){const{cx:l,cy:c,radius:f,startAngle:o,endAngle:u,anticlockwise:d}=h;this.arc(l,c,f,o,u,d)}return this}arc(e,t,r,i,n,a=!1){if(i===n)return this;if(!a&&n<=i?n+=Ri:a&&i<=n&&(i+=Ri),n-i===0)return this;const h=e+Math.cos(i)*r,l=t+Math.sin(i)*r,c=this._geometry.closePointEps;let f=this.currentPath?this.currentPath.points:null;if(f){const o=Math.abs(f[f.length-2]-h),u=Math.abs(f[f.length-1]-l);o<c&&u<c||f.push(h,l)}else this.moveTo(h,l),f=this.currentPath.points;return Rh.arc(h,l,e,t,r,i,n,a,f),this}beginFill(e=0,t){return this.beginTextureFill({texture:K.WHITE,color:e,alpha:t})}normalizeColor(e){const t=ve.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:K.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:r},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,i){return this.drawShape(new ce(e,t,r,i))}drawRoundedRect(e,t,r,i,n){return this.drawShape(new ji(e,t,r,i,n))}drawCircle(e,t,r){return this.drawShape(new Wi(e,t,r))}drawEllipse(e,t,r,i){return this.drawShape(new zi(e,t,r,i))}drawPolygon(...e){let t,r=!0;const i=e[0];i.points?(r=i.closeStroke,t=i.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new zt(t);return n.closeStroke=r,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Be.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let i=0;i<r;i++){const n=e.batches[i],a=n.style.color,h=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),l=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),f={vertexData:h,blendMode:t,indices:c,uvs:l,_batchRGB:ve.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=f}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,i=this.worldAlpha,n=t.uniforms,a=r.drawCalls;n.translationMatrix=this.transform.worldTransform,ve.shared.setValue(this._tintColor).premultiply(i).toArray(n.tint),e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let h=0,l=a.length;h<l;h++)this._renderDrawCallDirect(e,r.drawCalls[h])}_renderDrawCallDirect(e,t){const{texArray:r,type:i,size:n,start:a}=t,h=r.count;for(let l=0;l<h;l++)e.texture.bind(r.elements[l],l);e.geometry.draw(i,n,a)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!Tn[r]){const{maxTextures:i}=e.plugins[r],n=new Int32Array(i);for(let l=0;l<i;l++)n[l]=l;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new xe,default:Ze.from({uSamplers:n},!0)},h=e.plugins[r]._shader.program;Tn[r]=new ht(h,a)}t=Tn[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:i,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,r,i,n)}containsPoint(e){return this.worldTransform.applyInverse(e,Ai._TEMP_POINT),this._geometry.containsPoint(Ai._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=ve.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,i=t.b,n=t.c,a=t.d,h=t.tx,l=t.ty,c=this._geometry.points,f=this.vertexData;let o=0;for(let u=0;u<c.length;u+=2){const d=c[u],p=c[u+1];f[o++]=r*d+n*p+h,f[o++]=a*p+i*d+l}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};aa.curves=Tr,aa._TEMP_POINT=new me;let Ea=aa;class mm{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const An=new me,Bh=new zt,au=class ou extends Me{constructor(e,t,r,i=at.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||ut.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===at.TRIANGLES&&t.length<ou.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const i=this.transform.worldTransform,n=i.a,a=i.b,h=i.c,l=i.d,c=i.tx,f=i.ty,o=this.vertexData;for(let u=0;u<o.length/2;u++){const d=t[u*2],p=t[u*2+1];o[u*2]=n*d+h*p+c,o[u*2+1]=a*d+l*p+f}if(this._roundPixels){const u=q.RESOLUTION;for(let d=0;d<o.length;++d)o[d]=Math.round(o[d]*u)/u}this.vertexDirty=r}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new mm(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,An);const t=this.geometry.getBuffer("aVertexPosition").data,r=Bh.points,i=this.geometry.getIndex().data,n=i.length,a=this.drawMode===4?3:1;for(let h=0;h+2<n;h+=a){const l=i[h]*2,c=i[h+1]*2,f=i[h+2]*2;if(r[0]=t[l],r[1]=t[l+1],r[2]=t[c],r[3]=t[c+1],r[4]=t[f],r[5]=t[f+1],Bh.contains(An.x,An.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};au.BATCHABLE_SIZE=100;let Fh=au;class gm extends Dt{constructor(e,t,r){super();const i=new we(e),n=new we(t,!0),a=new we(r,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,ae.FLOAT).addAttribute("aTextureCoord",n,2,!1,ae.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var _m=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,ym=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Oh extends ht{constructor(e,t){const r={uSampler:e,alpha:1,uTextureMatrix:xe.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(r,t.uniforms),super(t.program||_t.from(ym,_m),r),this._colorDirty=!1,this.uvMatrix=new Al(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new ve(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;ve.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Lh{constructor(e,t,r){this.geometry=new Dt,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<e.length;++i){let n=e[i];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||ae.FLOAT,offset:n.offset},t[i]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new we(kc(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];h.offset=t,t+=h.size,this.dynamicStride+=h.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new we(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];h.offset=i,i+=h.size,this.staticStride+=h.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new we(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];e.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===ae.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];e.addAttribute(h.attributeName,this.staticBuffer,0,h.type===ae.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(e,t,r){for(let i=0;i<this.dynamicProperties.length;i++){const n=this.dynamicProperties[i];n.uploadFunction(e,t,r,n.type===ae.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,r){for(let i=0;i<this.staticProperties.length;i++){const n=this.staticProperties[i];n.uploadFunction(e,t,r,n.type===ae.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var vm=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,xm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class hu extends qi{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new xe,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ae.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ht.from(xm,vm,{}),this.state=ut.for2d()}render(e){const t=e.children,r=e._maxSize,i=e._batchSize,n=this.renderer;let a=t.length;if(a===0)return;a>r&&!e.autoResize&&(a=r);let h=e._buffers;h||(h=e._buffers=this.generateBuffers(e));const l=t[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=al(e.blendMode,c),n.state.set(this.state);const f=n.gl,o=e.worldTransform.copyTo(this.tempMatrix);o.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=o.toArray(!0),this.shader.uniforms.uColor=ve.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let u=!1;for(let d=0,p=0;d<a;d+=i,p+=1){let _=a-d;_>i&&(_=i),p>=h.length&&h.push(this._generateOneMoreBuffer(e));const m=h[p];m.uploadDynamic(t,d,_);const g=e._bufferUpdateIDs[p]||0;u=u||m._updateID<g,u&&(m._updateID=e._updateID,m.uploadStatic(t,d,_)),n.geometry.bind(m.geometry),f.drawElements(f.TRIANGLES,_*6,f.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],r=e._maxSize,i=e._batchSize,n=e._properties;for(let a=0;a<r;a+=i)t.push(new Lh(this.properties,n,i));return t}_generateOneMoreBuffer(e){const t=e._batchSize,r=e._properties;return new Lh(this.properties,r,t)}uploadVertices(e,t,r,i,n,a){let h=0,l=0,c=0,f=0;for(let o=0;o<r;++o){const u=e[t+o],d=u._texture,p=u.scale.x,_=u.scale.y,m=d.trim,g=d.orig;m?(l=m.x-u.anchor.x*g.width,h=l+m.width,f=m.y-u.anchor.y*g.height,c=f+m.height):(h=g.width*(1-u.anchor.x),l=g.width*-u.anchor.x,c=g.height*(1-u.anchor.y),f=g.height*-u.anchor.y),i[a]=l*p,i[a+1]=f*_,i[a+n]=h*p,i[a+n+1]=f*_,i[a+n*2]=h*p,i[a+n*2+1]=c*_,i[a+n*3]=l*p,i[a+n*3+1]=c*_,a+=n*4}}uploadPosition(e,t,r,i,n,a){for(let h=0;h<r;h++){const l=e[t+h].position;i[a]=l.x,i[a+1]=l.y,i[a+n]=l.x,i[a+n+1]=l.y,i[a+n*2]=l.x,i[a+n*2+1]=l.y,i[a+n*3]=l.x,i[a+n*3+1]=l.y,a+=n*4}}uploadRotation(e,t,r,i,n,a){for(let h=0;h<r;h++){const l=e[t+h].rotation;i[a]=l,i[a+n]=l,i[a+n*2]=l,i[a+n*3]=l,a+=n*4}}uploadUvs(e,t,r,i,n,a){for(let h=0;h<r;++h){const l=e[t+h]._texture._uvs;l?(i[a]=l.x0,i[a+1]=l.y0,i[a+n]=l.x1,i[a+n+1]=l.y1,i[a+n*2]=l.x2,i[a+n*2+1]=l.y2,i[a+n*3]=l.x3,i[a+n*3+1]=l.y3,a+=n*4):(i[a]=0,i[a+1]=0,i[a+n]=0,i[a+n+1]=0,i[a+n*2]=0,i[a+n*2+1]=0,i[a+n*3]=0,i[a+n*3+1]=0,a+=n*4)}}uploadTint(e,t,r,i,n,a){for(let h=0;h<r;++h){const l=e[t+h],c=ve.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);i[a]=c,i[a+n]=c,i[a+n*2]=c,i[a+n*3]=c,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}hu.extension={name:"particle",type:W.RendererPlugin};Q.add(hu);var Zi=(s=>(s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",s))(Zi||{});const pi={willReadFrequently:!0},it=class ee{static get experimentalLetterSpacingSupported(){let e=ee._experimentalLetterSpacingSupported;if(e!==void 0){const t=q.ADAPTER.getCanvasRenderingContext2D().prototype;e=ee._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,i,n,a,h,l,c){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=n,this.lineWidths=a,this.lineHeight=h,this.maxLineWidth=l,this.fontProperties=c}static measureText(e,t,r,i=ee._canvas){r=r??t.wordWrap;const n=t.toFontString(),a=ee.measureFont(n);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);const h=i.getContext("2d",pi);h.font=n;const l=(r?ee.wordWrap(e,t,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let f=0;for(let p=0;p<l.length;p++){const _=ee._measureText(l[p],t.letterSpacing,h);c[p]=_,f=Math.max(f,_)}let o=f+t.strokeThickness;t.dropShadow&&(o+=t.dropShadowDistance);const u=t.lineHeight||a.fontSize+t.strokeThickness;let d=Math.max(u,a.fontSize+t.strokeThickness*2)+t.leading+(l.length-1)*(u+t.leading);return t.dropShadow&&(d+=t.dropShadowDistance),new ee(e,t,o,d,l,c,u+t.leading,f,a)}static _measureText(e,t,r){let i=!1;ee.experimentalLetterSpacingSupported&&(ee.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(e).width;return n>0&&(i?n-=t:n+=(ee.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,r=ee._canvas){const i=r.getContext("2d",pi);let n=0,a="",h="";const l=Object.create(null),{letterSpacing:c,whiteSpace:f}=t,o=ee.collapseSpaces(f),u=ee.collapseNewlines(f);let d=!o;const p=t.wordWrapWidth+c,_=ee.tokenize(e);for(let m=0;m<_.length;m++){let g=_[m];if(ee.isNewline(g)){if(!u){h+=ee.addLine(a),d=!o,a="",n=0;continue}g=" "}if(o){const y=ee.isBreakingSpace(g),w=ee.isBreakingSpace(a[a.length-1]);if(y&&w)continue}const v=ee.getFromCache(g,c,l,i);if(v>p)if(a!==""&&(h+=ee.addLine(a),a="",n=0),ee.canBreakWords(g,t.breakWords)){const y=ee.wordWrapSplit(g);for(let w=0;w<y.length;w++){let T=y[w],R=T,b=1;for(;y[w+b];){const N=y[w+b];if(!ee.canBreakChars(R,N,g,w,t.breakWords))T+=N;else break;R=N,b++}w+=b-1;const B=ee.getFromCache(T,c,l,i);B+n>p&&(h+=ee.addLine(a),d=!1,a="",n=0),a+=T,n+=B}}else{a.length>0&&(h+=ee.addLine(a),a="",n=0);const y=m===_.length-1;h+=ee.addLine(g,!y),d=!1,a="",n=0}else v+n>p&&(d=!1,h+=ee.addLine(a),a="",n=0),(a.length>0||!ee.isBreakingSpace(g)||d)&&(a+=g,n+=v)}return h+=ee.addLine(a,!1),h}static addLine(e,t=!0){return e=ee.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,i){let n=r[e];return typeof n!="number"&&(n=ee._measureText(e,t,i)+t,r[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!ee.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:ee._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:ee._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const n=e[i],a=e[i+1];if(ee.isBreakingSpace(n,a)||ee.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,n){return!0}static wordWrapSplit(e){return ee.graphemeSegmenter(e)}static measureFont(e){if(ee._fonts[e])return ee._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=ee._canvas,i=ee._context;i.font=e;const n=ee.METRICS_STRING+ee.BASELINE_SYMBOL,a=Math.ceil(i.measureText(n).width);let h=Math.ceil(i.measureText(ee.BASELINE_SYMBOL).width);const l=Math.ceil(ee.HEIGHT_MULTIPLIER*h);if(h=h*ee.BASELINE_MULTIPLIER|0,a===0||l===0)return ee._fonts[e]=t,t;r.width=a,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,a,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,h);const c=i.getImageData(0,0,a,l).data,f=c.length,o=a*4;let u=0,d=0,p=!1;for(u=0;u<h;++u){for(let _=0;_<o;_+=4)if(c[d+_]!==255){p=!0;break}if(!p)d+=o;else break}for(t.ascent=h-u,d=f-o,p=!1,u=l;u>h;--u){for(let _=0;_<o;_+=4)if(c[d+_]!==255){p=!0;break}if(!p)d-=o;else break}return t.descent=u-h,t.fontSize=t.ascent+t.descent,ee._fonts[e]=t,t}static clearMetrics(e=""){e?delete ee._fonts[e]:ee._fonts={}}static get _canvas(){var e;if(!ee.__canvas){let t;try{const r=new OffscreenCanvas(0,0);if((e=r.getContext("2d",pi))!=null&&e.measureText)return ee.__canvas=r,r;t=q.ADAPTER.createCanvas()}catch{t=q.ADAPTER.createCanvas()}t.width=t.height=10,ee.__canvas=t}return ee.__canvas}static get _context(){return ee.__context||(ee.__context=ee._canvas.getContext("2d",pi)),ee.__context}};it.METRICS_STRING="|q",it.BASELINE_SYMBOL="M",it.BASELINE_MULTIPLIER=1.4,it.HEIGHT_MULTIPLIER=2,it.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return e=>[...s.segment(e)].map(t=>t.segment)}return s=>[...s]})(),it.experimentalLetterSpacing=!1,it._fonts={},it._newlines=[10,13],it._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let It=it;const bm=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],lu=class kr{constructor(e){this.styleID=0,this.reset(),En(this,e,e)}clone(){const e={};return En(e,this,kr.defaultStyle),new kr(e)}reset(){En(this,kr.defaultStyle,kr.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=wn(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=wn(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){Tm(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=wn(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let i=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!bm.includes(i)&&(i=`"${i}"`),t[r]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};lu.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Zi.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Qe=lu;function wn(s){const e=ve.shared,t=r=>{const i=e.setValue(r);return i.alpha===1?i.toHex():i.toRgbaString()};return Array.isArray(s)?s.map(t):t(s)}function Tm(s,e){if(!Array.isArray(s)||!Array.isArray(e)||s.length!==e.length)return!1;for(let t=0;t<s.length;++t)if(s[t]!==e[t])return!1;return!0}function En(s,e,t){for(const r in t)Array.isArray(e[r])?s[r]=e[r].slice():s[r]=e[r]}const Am={texture:!0,children:!1,baseTexture:!0},uu=class oa extends Le{constructor(e,t,r){let i=!1;r||(r=q.ADAPTER.createCanvas(),i=!0),r.width=3,r.height=3;const n=K.from(r);n.orig=new ce,n.trim=new ce,super(n),this._ownCanvas=i,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=oa.defaultResolution??q.RESOLUTION,this._autoResolution=oa.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return It.experimentalLetterSpacing}static set experimentalLetterSpacing(e){fe("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),It.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,i=It.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,a=i.height,h=i.lines,l=i.lineHeight,c=i.lineWidths,f=i.maxLineWidth,o=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let u,d;const p=t.dropShadow?2:1;for(let _=0;_<p;++_){const m=t.dropShadow&&_===0,g=m?Math.ceil(Math.max(1,a)+t.padding*2):0,v=g*this._resolution;if(m){r.fillStyle="black",r.strokeStyle="black";const w=t.dropShadowColor,T=t.dropShadowBlur*this._resolution,R=t.dropShadowDistance*this._resolution;r.shadowColor=ve.shared.setValue(w).setAlpha(t.dropShadowAlpha).toRgbaString(),r.shadowBlur=T,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*R,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*R+v}else r.fillStyle=this._generateFillStyle(t,h,i),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let y=(l-o.fontSize)/2;l-o.fontSize<0&&(y=0);for(let w=0;w<h.length;w++)u=t.strokeThickness/2,d=t.strokeThickness/2+w*l+o.ascent+y,t.align==="right"?u+=f-c[w]:t.align==="center"&&(u+=(f-c[w])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(h[w],u+t.padding,d+t.padding-g,!0),t.fill&&this.drawLetterSpacing(h[w],u+t.padding,d+t.padding-g)}this.updateTexture()}drawLetterSpacing(e,t,r,i=!1){const n=this._style.letterSpacing;let a=!1;if(It.experimentalLetterSpacingSupported&&(It.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||a){i?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let h=t;const l=It.graphemeSegmenter(e);let c=this.context.measureText(e).width,f=0;for(let o=0;o<l.length;++o){const u=l[o];i?this.context.strokeText(u,h,r):this.context.fillText(u,h,r);let d="";for(let p=o+1;p<l.length;++p)d+=l[p];f=this.context.measureText(d).width,h+=c-f+n,c=f}}updateTexture(){const e=this.canvas;if(this._style.trim){const a=$c(e);a.data&&(e.width=a.width,e.height=a.height,this.context.putImageData(a.data,0,0))}const t=this._texture,r=this._style,i=r.trim?0:r.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const i=e.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const a=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,l=this.canvas.width/this._resolution-a-h*2,c=this.canvas.height/this._resolution-a-h*2,f=i.slice(),o=e.fillGradientStops.slice();if(!o.length){const u=f.length+1;for(let d=1;d<u;++d)o.push(d/u)}if(f.unshift(i[0]),o.unshift(0),f.push(i[i.length-1]),o.push(1),e.fillGradientType===Zi.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,h,l/2,c+h);const u=r.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const p=r.lineHeight*(d-1)+u,_=r.lineHeight*d;let m=_;d>0&&p>_&&(m=(_+p)/2);const g=_+u,v=r.lineHeight*(d+1);let y=g;d+1<t.length&&v<g&&(y=(g+v)/2);const w=(y-m)/c;for(let T=0;T<f.length;T++){let R=0;typeof o[T]=="number"?R=o[T]:R=T/f.length;let b=Math.min(1,Math.max(0,m/c+R*w));b=Number(b.toFixed(5)),n.addColorStop(b,f[T])}}}else{n=this.context.createLinearGradient(h,c/2,l+h,c/2);const u=f.length+1;let d=1;for(let p=0;p<f.length;p++){let _;typeof o[p]=="number"?_=o[p]:_=d/u,n.addColorStop(_,f[p]),d++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Am,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Rt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Rt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Qe?this._style=e:this._style=new Qe(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};uu.defaultAutoResolution=!0;let $r=uu;class wm{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Em(s,e){var r;let t=!1;if((r=s==null?void 0:s._textures)!=null&&r.length){for(let i=0;i<s._textures.length;i++)if(s._textures[i]instanceof K){const n=s._textures[i].baseTexture;e.includes(n)||(e.push(n),t=!0)}}return t}function Sm(s,e){if(s.baseTexture instanceof ue){const t=s.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Im(s,e){if(s._texture&&s._texture instanceof K){const t=s._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Cm(s,e){return e instanceof $r?(e.updateText(!0),!0):!1}function Rm(s,e){if(e instanceof Qe){const t=e.toFontString();return It.measureFont(t),!0}return!1}function Pm(s,e){if(s instanceof $r){e.includes(s.style)||e.push(s.style),e.includes(s)||e.push(s);const t=s._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Mm(s,e){return s instanceof Qe?(e.includes(s)||e.push(s),!0):!1}const cu=class du{constructor(e){this.limiter=new wm(du.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Pm),this.registerFindHook(Mm),this.registerFindHook(Em),this.registerFindHook(Sm),this.registerFindHook(Im),this.registerUploadHook(Cm),this.registerUploadHook(Rm)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ee.system.addOnce(this.tick,this,Yt.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ee.system.addOnce(this.tick,this,Yt.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Me)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Ee.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};cu.uploadsPerFrame=4;let ha=cu;Object.defineProperties(q,{UPLOADS_PER_FRAME:{get(){return ha.uploadsPerFrame},set(s){fe("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ha.uploadsPerFrame=s}}});function fu(s,e){return e instanceof ue?(e._glTextures[s.CONTEXT_UID]||s.texture.bind(e),!0):!1}function Dm(s,e){if(!(e instanceof Ea))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:r}=t;for(let i=0;i<r.length;i++){const{texture:n}=r[i].style;n&&fu(s,n.baseTexture)}return t.batchable||s.geometry.bind(t,e._resolveDirectShader(s)),!0}function Bm(s,e){return s instanceof Ea?(e.push(s),!0):!1}class pu extends ha{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Bm),this.registerUploadHook(fu),this.registerUploadHook(Dm)}}pu.extension={name:"prepare",type:W.RendererSystem};Q.add(pu);var Fm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Om=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Lm=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Nh=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Nm=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const mi=new xe;class mu extends qi{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new vl,this.state=ut.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=ht.from(Nh,Nm,t),this.shader=e.context.webGLVersion>1?ht.from(Om,Fm,t):ht.from(Nh,Lm,t)}render(e){const t=this.renderer,r=this.quad;let i=r.vertices;i[0]=i[6]=e._width*-e.anchor.x,i[1]=i[3]=e._height*-e.anchor.y,i[2]=i[4]=e._width*(1-e.anchor.x),i[5]=i[7]=e._height*(1-e.anchor.y);const n=e.uvRespectAnchor?e.anchor.x:0,a=e.uvRespectAnchor?e.anchor.y:0;i=r.uvs,i[0]=i[6]=-n,i[1]=i[3]=-a,i[2]=i[4]=1-n,i[5]=i[7]=1-a,r.invalidate();const h=e._texture,l=h.baseTexture,c=l.alphaMode>0,f=e.tileTransform.localTransform,o=e.uvMatrix;let u=l.isPowerOfTwo&&h.frame.width===l.width&&h.frame.height===l.height;u&&(l._glTextures[t.CONTEXT_UID]?u=l.wrapMode!==Mt.CLAMP:l.wrapMode===Mt.CLAMP&&(l.wrapMode=Mt.REPEAT));const d=u?this.simpleShader:this.shader,p=h.width,_=h.height,m=e._width,g=e._height;mi.set(f.a*p/m,f.b*p/g,f.c*_/m,f.d*_/g,f.tx/m,f.ty/g),mi.invert(),u?mi.prepend(o.mapCoord):(d.uniforms.uMapCoord=o.mapCoord.toArray(!0),d.uniforms.uClampFrame=o.uClampFrame,d.uniforms.uClampOffset=o.uClampOffset),d.uniforms.uTransform=mi.toArray(!0),d.uniforms.uColor=ve.shared.setValue(e.tint).premultiply(e.worldAlpha,c).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=h,t.shader.bind(d),t.geometry.bind(r),this.state.blendMode=al(e.blendMode,c),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}mu.extension={name:"tilingSprite",type:W.RendererPlugin};Q.add(mu);const gu=class Ur{constructor(e,t,r){this.linkedSheets=[],(e instanceof ue||e instanceof K)&&(e={texture:e,data:t,resolutionFilename:r});const{texture:i,data:n,resolutionFilename:a=null,cachePrefix:h=""}=e;this.cachePrefix=h,this._texture=i instanceof K?i:null,this.baseTexture=i instanceof ue?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const l=this.baseTexture.resource;this.resolution=this._updateResolution(a||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=vt(e,null);return r===null&&(r=typeof t=="number"?t:parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ur.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=Ur.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],a=n.frame;if(a){let h=null,l=null;const c=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,f=new ce(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);n.rotated?h=new ce(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):h=new ce(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new ce(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new K(this.baseTexture,h,f,l,n.rotated?2:0,n.anchor,n.borders),K.addToCache(this.textures[i],this.cachePrefix+i.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ur.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ur.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};gu.BATCH_SIZE=1e3;let kh=gu;const km=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function _u(s,e,t){const r={};if(s.forEach(i=>{r[i]=e}),Object.keys(e.textures).forEach(i=>{r[`${e.cachePrefix}${i}`]=e.textures[i]}),!t){const i=Pe.dirname(s[0]);e.linkedSheets.forEach((n,a)=>{Object.assign(r,_u([`${i}/${e.data.meta.related_multi_packs[a]}`],n,!0))})}return r}const Um={extension:W.Asset,cache:{test:s=>s instanceof kh,getCacheableAssets:(s,e)=>_u(s,e,!1)},resolver:{test:s=>{const e=s.split("?")[0].split("."),t=e.pop(),r=e.pop();return t==="json"&&km.includes(r)},parse:s=>{var t;const e=s.split(".");return{resolution:parseFloat(((t=q.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:e[e.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:W.LoadParser,priority:Je.Normal},async testParse(s,e){return Pe.extname(e.src).toLowerCase()===".json"&&!!s.frames},async parse(s,e,t){var f,o;const{texture:r,imageFilename:i,cachePrefix:n}=(e==null?void 0:e.data)??{};let a=Pe.dirname(e.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let h;if(r&&r.baseTexture)h=r;else{const u=ia(a+(i??s.meta.image),e.src);h=(await t.load([u]))[u]}const l=new kh({texture:h.baseTexture,data:s,resolutionFilename:e.src,cachePrefix:n});await l.parse();const c=(f=s==null?void 0:s.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(c)){const u=[];for(const p of c){if(typeof p!="string")continue;let _=a+p;(o=e.data)!=null&&o.ignoreMultiPack||(_=ia(_,e.src),u.push(t.load({src:_,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);l.linkedSheets=d,d.forEach(p=>{p.linkedSheets=[l].concat(l.linkedSheets.filter(_=>_!==p))})}return l},unload(s){s.destroy(!0)}}};Q.add(Um);class Gi{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class wi{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in t){const a=t[n].match(/^[a-z]+/gm)[0],h=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const c in h){const f=h[c].split("="),o=f[0],u=f[1].replace(/"/gm,""),d=parseFloat(u),p=isNaN(d)?u:d;l[o]=p}r[a].push(l)}const i=new Gi;return r.info.forEach(n=>i.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>i.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>i.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>i.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>i.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>i.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),i}}class la{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new Gi,r=e.getElementsByTagName("info"),i=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),h=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let c=0;c<r.length;c++)t.info.push({face:r[c].getAttribute("face"),size:parseInt(r[c].getAttribute("size"),10)});for(let c=0;c<i.length;c++)t.common.push({lineHeight:parseInt(i[c].getAttribute("lineHeight"),10)});for(let c=0;c<n.length;c++)t.page.push({id:parseInt(n[c].getAttribute("id"),10)||0,file:n[c].getAttribute("file")});for(let c=0;c<a.length;c++){const f=a[c];t.char.push({id:parseInt(f.getAttribute("id"),10),page:parseInt(f.getAttribute("page"),10)||0,x:parseInt(f.getAttribute("x"),10),y:parseInt(f.getAttribute("y"),10),width:parseInt(f.getAttribute("width"),10),height:parseInt(f.getAttribute("height"),10),xoffset:parseInt(f.getAttribute("xoffset"),10),yoffset:parseInt(f.getAttribute("yoffset"),10),xadvance:parseInt(f.getAttribute("xadvance"),10)})}for(let c=0;c<h.length;c++)t.kerning.push({first:parseInt(h[c].getAttribute("first"),10),second:parseInt(h[c].getAttribute("second"),10),amount:parseInt(h[c].getAttribute("amount"),10)});for(let c=0;c<l.length;c++)t.distanceField.push({fieldType:l[c].getAttribute("fieldType"),distanceRange:parseInt(l[c].getAttribute("distanceRange"),10)});return t}}class ua{static test(e){return typeof e=="string"&&e.includes("<font>")?la.test(q.ADAPTER.parseXML(e)):!1}static parse(e){return la.parse(q.ADAPTER.parseXML(e))}}const Sn=[wi,la,ua];function Gm(s){for(let e=0;e<Sn.length;e++)if(Sn[e].test(s))return Sn[e];return null}function Hm(s,e,t,r,i,n){const a=t.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let h;const l=t.dropShadow?t.dropShadowDistance:0,c=t.padding||0,f=s.width/r-l-c*2,o=s.height/r-l-c*2,u=a.slice(),d=t.fillGradientStops.slice();if(!d.length){const p=u.length+1;for(let _=1;_<p;++_)d.push(_/p)}if(u.unshift(a[0]),d.unshift(0),u.push(a[a.length-1]),d.push(1),t.fillGradientType===Zi.LINEAR_VERTICAL){h=e.createLinearGradient(f/2,c,f/2,o+c);let p=0;const _=(n.fontProperties.fontSize+t.strokeThickness)/o;for(let m=0;m<i.length;m++){const g=n.lineHeight*m;for(let v=0;v<u.length;v++){let y=0;typeof d[v]=="number"?y=d[v]:y=v/u.length;const w=g/o+y*_;let T=Math.max(p,w);T=Math.min(T,1),h.addColorStop(T,u[v]),p=T}}}else{h=e.createLinearGradient(c,o/2,f+c,o/2);const p=u.length+1;let _=1;for(let m=0;m<u.length;m++){let g;typeof d[m]=="number"?g=d[m]:g=_/p,h.addColorStop(g,u[m]),_++}}return h}function $m(s,e,t,r,i,n,a){const h=t.text,l=t.fontProperties;e.translate(r,i),e.scale(n,n);const c=a.strokeThickness/2,f=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=Hm(s,e,a,n,[h],t),e.strokeStyle=a.stroke,a.dropShadow){const o=a.dropShadowColor,u=a.dropShadowBlur*n,d=a.dropShadowDistance*n;e.shadowColor=ve.shared.setValue(o).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=u,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*d,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*d}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(h,c,f+t.lineHeight-l.descent),a.fill&&e.fillText(h,c,f+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Ei(s){return s.codePointAt?s.codePointAt(0):s.charCodeAt(0)}function yu(s){return Array.from?Array.from(s):s.split("")}function Xm(s){typeof s=="string"&&(s=[s]);const e=[];for(let t=0,r=s.length;t<r;t++){const i=s[t];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const n=i[0].charCodeAt(0),a=i[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let h=n,l=a;h<=l;h++)e.push(String.fromCharCode(h))}else e.push(...yu(i))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const Et=class st{constructor(e,t,r){var f;const[i]=e.info,[n]=e.common,[a]=e.page,[h]=e.distanceField,l=vt(a.file),c={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=c;for(let o=0;o<e.page.length;o++){const{id:u,file:d}=e.page[o];c[u]=t instanceof Array?t[o]:t[d],h!=null&&h.fieldType&&h.fieldType!=="none"&&(c[u].baseTexture.alphaMode=Oe.NO_PREMULTIPLIED_ALPHA,c[u].baseTexture.mipmap=lt.OFF)}for(let o=0;o<e.char.length;o++){const{id:u,page:d}=e.char[o];let{x:p,y:_,width:m,height:g,xoffset:v,yoffset:y,xadvance:w}=e.char[o];p/=l,_/=l,m/=l,g/=l,v/=l,y/=l,w/=l;const T=new ce(p+c[d].frame.x/l,_+c[d].frame.y/l,m,g);this.chars[u]={xOffset:v,yOffset:y,xAdvance:w,kerning:{},texture:new K(c[d].baseTexture,T),page:d}}for(let o=0;o<e.kerning.length;o++){let{first:u,second:d,amount:p}=e.kerning[o];u/=l,d/=l,p/=l,this.chars[d]&&(this.chars[d].kerning[u]=p)}this.distanceFieldRange=h==null?void 0:h.distanceRange,this.distanceFieldType=((f=h==null?void 0:h.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let i;if(e instanceof Gi)i=e;else{const a=Gm(e);if(!a)throw new Error("Unrecognized data format for font.");i=a.parse(e)}t instanceof K&&(t=[t]);const n=new st(i,t,r);return st.available[n.font]=n,n}static uninstall(e){const t=st.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete st.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:a,textureWidth:h,textureHeight:l,...c}=Object.assign({},st.defaultOptions,r),f=Xm(i),o=t instanceof Qe?t:new Qe(t),u=h,d=new Gi;d.info[0]={face:o.fontFamily,size:o.fontSize},d.common[0]={lineHeight:o.fontSize};let p=0,_=0,m,g,v,y=0;const w=[];for(let R=0;R<f.length;R++){m||(m=q.ADAPTER.createCanvas(),m.width=h,m.height=l,g=m.getContext("2d"),v=new ue(m,{resolution:a,...c}),w.push(new K(v)),d.page.push({id:w.length-1,file:""}));const b=f[R],B=It.measureText(b,o,!1,m),N=B.width,U=Math.ceil(B.height),V=Math.ceil((o.fontStyle==="italic"?2:1)*N);if(_>=l-U*a){if(_===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${o.fontFamily}', fontSize: ${o.fontSize}px, char: '${b}')`);--R,m=null,g=null,v=null,_=0,p=0,y=0;continue}if(y=Math.max(U+B.fontProperties.descent,y),V*a+p>=u){if(p===0)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${o.fontFamily}', fontSize: ${o.fontSize}px, char: '${b}')`);--R,_+=y*a,_=Math.ceil(_),p=0,y=0;continue}$m(m,g,B,p,_,a,o);const C=Ei(B.text);d.char.push({id:C,page:w.length-1,x:p/a,y:_/a,width:V,height:U,xoffset:0,yoffset:0,xadvance:N-(o.dropShadow?o.dropShadowDistance:0)-(o.stroke?o.strokeThickness:0)}),p+=(V+2*n)*a,p=Math.ceil(p)}if(!(r!=null&&r.skipKerning))for(let R=0,b=f.length;R<b;R++){const B=f[R];for(let N=0;N<b;N++){const U=f[N],V=g.measureText(B).width,C=g.measureText(U).width,M=g.measureText(B+U).width-(V+C);M&&d.kerning.push({first:Ei(B),second:Ei(U),amount:M})}}const T=new st(d,w,!0);return st.available[e]!==void 0&&st.uninstall(e),st.available[e]=T,T}};Et.ALPHA=[["a","z"],["A","Z"]," "],Et.NUMERIC=[["0","9"]],Et.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Et.ASCII=[[" ","~"]],Et.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Et.ALPHANUMERIC},Et.available={};let St=Et;var Vm=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Wm=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Uh=[],Gh=[],Hh=[],zm=class vu extends Me{constructor(e,t={}){super();const{align:r,tint:i,maxWidth:n,letterSpacing:a,fontName:h,fontSize:l}=Object.assign({},vu.styleDefaults,t);if(!St.available[h])throw new Error(`Missing BitmapFont "${h}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new ve(i),this._font=void 0,this._fontName=h,this._fontSize=l,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new gt(()=>{this.dirty=!0},this,0,0),this._roundPixels=q.ROUND_PIXELS,this.dirty=!0,this._resolution=q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var V;const e=St.available[this._fontName],t=this.fontSize,r=t/e.size,i=new me,n=[],a=[],h=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",c=yu(l),f=this._maxWidth*e.size/t,o=e.distanceFieldType==="none"?Uh:Gh;let u=null,d=0,p=0,_=0,m=-1,g=0,v=0,y=0,w=0;for(let C=0;C<c.length;C++){const M=c[C],k=Ei(M);if(/(?:\s)/.test(M)&&(m=C,g=d,w++),M==="\r"||M===`
`){a.push(d),h.push(-1),p=Math.max(p,d),++_,++v,i.x=0,i.y+=e.lineHeight,u=null,w=0;continue}const z=e.chars[k];if(!z)continue;u&&z.kerning[u]&&(i.x+=z.kerning[u]);const A=Hh.pop()||{texture:K.EMPTY,line:0,charCode:0,prevSpaces:0,position:new me};A.texture=z.texture,A.line=_,A.charCode=k,A.position.x=Math.round(i.x+z.xOffset+this._letterSpacing/2),A.position.y=Math.round(i.y+z.yOffset),A.prevSpaces=w,n.push(A),d=A.position.x+Math.max(z.xAdvance-z.xOffset,z.texture.orig.width),i.x+=z.xAdvance+this._letterSpacing,y=Math.max(y,z.yOffset+z.texture.height),u=k,m!==-1&&f>0&&i.x>f&&(++v,gr(n,1+m-v,1+C-m),C=m,m=-1,a.push(g),h.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,g),_++,i.x=0,i.y+=e.lineHeight,u=null,w=0)}const T=c[c.length-1];T!=="\r"&&T!==`
`&&(/(?:\s)/.test(T)&&(d=g),a.push(d),p=Math.max(p,d),h.push(-1));const R=[];for(let C=0;C<=_;C++){let M=0;this._align==="right"?M=p-a[C]:this._align==="center"?M=(p-a[C])/2:this._align==="justify"&&(M=h[C]<0?0:(p-a[C])/h[C]),R.push(M)}const b=n.length,B={},N=[],U=this._activePagesMeshData;o.push(...U);for(let C=0;C<b;C++){const M=n[C].texture,k=M.baseTexture.uid;if(!B[k]){let z=o.pop();if(!z){const E=new gm;let x,P;e.distanceFieldType==="none"?(x=new Oh(K.EMPTY),P=oe.NORMAL):(x=new Oh(K.EMPTY,{program:_t.from(Wm,Vm),uniforms:{uFWidth:0}}),P=oe.NORMAL_NPM);const S=new Fh(E,x);S.blendMode=P,z={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:S,vertices:null,uvs:null,indices:null}}z.index=0,z.indexCount=0,z.vertexCount=0,z.uvsCount=0,z.total=0;const{_textureCache:A}=this;A[k]=A[k]||new K(M.baseTexture),z.mesh.texture=A[k],z.mesh.tint=this._tintColor.value,N.push(z),B[k]=z}B[k].total++}for(let C=0;C<U.length;C++)N.includes(U[C])||this.removeChild(U[C].mesh);for(let C=0;C<N.length;C++)N[C].mesh.parent!==this&&this.addChild(N[C].mesh);this._activePagesMeshData=N;for(const C in B){const M=B[C],k=M.total;if(!(((V=M.indices)==null?void 0:V.length)>6*k)||M.vertices.length<Fh.BATCHABLE_SIZE*2)M.vertices=new Float32Array(4*2*k),M.uvs=new Float32Array(4*2*k),M.indices=new Uint16Array(6*k);else{const z=M.total,A=M.vertices;for(let E=z*4*2;E<A.length;E++)A[E]=0}M.mesh.size=6*k}for(let C=0;C<b;C++){const M=n[C];let k=M.position.x+R[M.line]*(this._align==="justify"?M.prevSpaces:1);this._roundPixels&&(k=Math.round(k));const z=k*r,A=M.position.y*r,E=M.texture,x=B[E.baseTexture.uid],P=E.frame,S=E._uvs,I=x.index++;x.indices[I*6+0]=0+I*4,x.indices[I*6+1]=1+I*4,x.indices[I*6+2]=2+I*4,x.indices[I*6+3]=0+I*4,x.indices[I*6+4]=2+I*4,x.indices[I*6+5]=3+I*4,x.vertices[I*8+0]=z,x.vertices[I*8+1]=A,x.vertices[I*8+2]=z+P.width*r,x.vertices[I*8+3]=A,x.vertices[I*8+4]=z+P.width*r,x.vertices[I*8+5]=A+P.height*r,x.vertices[I*8+6]=z,x.vertices[I*8+7]=A+P.height*r,x.uvs[I*8+0]=S.x0,x.uvs[I*8+1]=S.y0,x.uvs[I*8+2]=S.x1,x.uvs[I*8+3]=S.y1,x.uvs[I*8+4]=S.x2,x.uvs[I*8+5]=S.y2,x.uvs[I*8+6]=S.x3,x.uvs[I*8+7]=S.y3}this._textWidth=p*r,this._textHeight=(i.y+e.lineHeight)*r;for(const C in B){const M=B[C];if(this.anchor.x!==0||this.anchor.y!==0){let E=0;const x=this._textWidth*this.anchor.x,P=this._textHeight*this.anchor.y;for(let S=0;S<M.total;S++)M.vertices[E++]-=x,M.vertices[E++]-=P,M.vertices[E++]-=x,M.vertices[E++]-=P,M.vertices[E++]-=x,M.vertices[E++]-=P,M.vertices[E++]-=x,M.vertices[E++]-=P}this._maxLineHeight=y*r;const k=M.mesh.geometry.getBuffer("aVertexPosition"),z=M.mesh.geometry.getBuffer("aTextureCoord"),A=M.mesh.geometry.getIndex();k.data=M.vertices,z.data=M.uvs,A.data=M.indices,k.update(),z.update(),A.update()}for(let C=0;C<n.length;C++)Hh.push(n[C]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:i}=St.available[this._fontName];if(r!=="none"){const{a:n,b:a,c:h,d:l}=this.worldTransform,c=Math.sqrt(n*n+a*a),f=Math.sqrt(h*h+l*l),o=(Math.abs(c)+Math.abs(f))/2,u=this.fontSize/i,d=e._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=o*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=St.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!St.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??St.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,r=St.available[this._fontName].distanceFieldType==="none"?Uh:Gh;r.push(...this._activePagesMeshData);for(const i of this._activePagesMeshData)this.removeChild(i.mesh);this._activePagesMeshData=[],r.filter(i=>t[i.mesh.texture.baseTexture.uid]).forEach(i=>{i.mesh.texture=K.EMPTY});for(const i in t)t[i].destroy(),delete t[i];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};zm.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const jm=[".xml",".fnt"],qm={extension:{type:W.LoadParser,priority:Je.Normal},name:"loadBitmapFont",test(s){return jm.includes(Pe.extname(s).toLowerCase())},async testParse(s){return wi.test(s)||ua.test(s)},async parse(s,e,t){const r=wi.test(s)?wi.parse(s):ua.parse(s),{src:i}=e,{page:n}=r,a=[];for(let c=0;c<n.length;++c){const f=n[c].file;let o=Pe.join(Pe.dirname(i),f);o=ia(o,i),a.push(o)}const h=await t.load(a),l=a.map(c=>h[c]);return St.install(r,l,!0)},async load(s,e){return(await q.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}};Q.add(qm);const ca=class cr extends Qe{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new cr(Object.keys(cr.defaultOptions).reduce((t,r)=>({...t,[r]:e[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete cr.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:r}=cr;if(r[e]){const i=r[e];return this._fonts.push(i),i.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return q.ADAPTER.fetch(e).then(i=>i.blob()).then(async i=>new Promise((n,a)=>{const h=URL.createObjectURL(i),l=new FileReader;l.onload=()=>n([h,l.result]),l.onerror=a,l.readAsDataURL(i)})).then(async([i,n])=>{const a=Object.assign({family:Pe.basename(e,Pe.extname(e)),weight:"normal",style:"normal",display:"auto",src:i,dataSrc:n,refs:1,originalUrl:e,fontFace:null},t);r[e]=a,this._fonts.push(a),this.styleID++;const h=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=h,await h.load(),document.fonts.add(h),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(r=>!this._overrides.includes(r));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(r=>this._overrides.includes(r));t.length>0&&(this._overrides=this._overrides.filter(r=>!t.includes(r)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=Lc(e)),typeof e=="number"?Oc(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const n=`${r}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,cr.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=q.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ca.availableFonts={},ca.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let In=ca;const gi=class dr extends Le{constructor(e="",t={}){super(K.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,i=K.from(r,{scaleMode:q.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new ce,i.trim=new ce,this.texture=i;const n="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",h=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),c=document.createElementNS(a,"div"),f=document.createElementNS(a,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",h.appendChild(l),this.maxWidth=dr.defaultMaxWidth,this.maxHeight=dr.defaultMaxHeight,this._domElement=c,this._styleElement=f,this._svgRoot=h,this._foreignObject=l,this._foreignObject.appendChild(f),this._foreignObject.appendChild(c),this._image=r,this._loadImage=new Image,this._autoResolution=dr.defaultAutoResolution,this._resolution=dr.defaultResolution??q.RESOLUTION,this.text=e,this.style=t}measureText(e){var f,o;const{text:t,style:r,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:r.toCSS(i)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:h}=n;(a>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const l=Math.min(this.maxWidth,Math.ceil(a)),c=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",c.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(f=this._style)==null?void 0:f.toCSS(i)}),this._styleElement.textContent=(o=this._style)==null?void 0:o.toGlobalCSS()),{width:l+r.padding*2,height:c+r.padding*2}}async updateText(e=!0){const{style:t,_image:r,_loadImage:i}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:n,height:a}=this.measureText();r.width=i.width=Math.ceil(Math.max(1,n)),r.height=i.height=Math.ceil(Math.max(1,a)),this._updateID++;const h=this._updateID;await new Promise(l=>{i.onload=async()=>{if(h<this._updateID){l();return}await t.onBeforeDraw(),r.src=i.src,i.onload=null,i.src="",this.updateTexture(),l()};const c=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(c)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:r,resolution:i}=this,{padding:n}=e,{baseTexture:a}=t;t.trim.width=t._frame.width=r.width/i,t.trim.height=t._frame.height=r.height/i,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),a.setRealSize(r.width,r.height,i),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var r,i,n,a,h;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},dr.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=t,(i=this._svgRoot)==null||i.remove(),this._svgRoot=t,(n=this._domElement)==null||n.remove(),this._domElement=t,(a=this._foreignObject)==null||a.remove(),this._foreignObject=t,(h=this._styleElement)==null||h.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Rt(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Rt(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof In?(this.ownsStyle=!1,this._style=e):e instanceof Qe?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=In.from(e)):(this.ownsStyle=!0,this._style=new In(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};gi.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},gi.defaultMaxWidth=2024,gi.defaultMaxHeight=2024,gi.defaultAutoResolution=!0;class Xr{static createStyledText(e,t,r,i=2e-4){const n=new Qe({fontSize:50,fontWeight:"bold",fill:["#F2C53D","#F23838"],stroke:"#ffffff",strokeThickness:4,dropShadow:!0,dropShadowColor:"#0D0D0D",dropShadowBlur:5,dropShadowAngle:Math.PI/4,dropShadowDistance:5}),a=new $r(e,n);a.anchor.set(0),a.position.set(t,r);let h=1;const l=()=>{a.transform&&(a.scale.x>1.05&&(h=-1),a.scale.x<.95&&(h=1),a.scale.x+=i*h,a.scale.y+=i*h)};return Ee.shared.add(l),a.destroy=(c=>function(f){Ee.shared.remove(l),c.call(this,f)})(a.destroy),a}static createText(e,t,r,i,n){const a=new Qe({fontSize:i,fontWeight:"bold",fill:["#0D0D0D","#0D0D0D"],stroke:"#ffffff",strokeThickness:4,dropShadow:!0,dropShadowColor:"#0D0D0D",dropShadowBlur:5,dropShadowAngle:Math.PI/4,dropShadowDistance:3}),h=new $r(e,a);return h.anchor.set(n),h.position.set(t,r),h.destroy=(l=>function(c){l.call(this,c)})(h.destroy),h}}class Hi{static createButtonDOM(e){const t=document.createElement("button");if(t.classList.add("scene-button"),e.image&&e.image.trim()!==""){const r=document.createElement("img");r.src=e.image,r.style.width="100%",r.style.height="100%",t.appendChild(r)}return e.top!==void 0&&(t.style.top=`${e.top}px`),e.bottom!==void 0&&(t.style.bottom=`${e.bottom}px`),e.left!==void 0&&(t.style.left=`${e.left}px`),e.right!==void 0&&(t.style.right=`${e.right}px`),e.width!==void 0&&(t.style.width=`${e.width}px`),e.height!==void 0&&(t.style.height=`${e.height}px`),e.name&&t.setAttribute("name",e.name),t}static createButtonSprite(e){const t=K.from(e.image),r=new Le(t);return t.baseTexture.valid?this.adjustSpriteSize(r,e.width,e.height):t.baseTexture.once("loaded",()=>{this.adjustSpriteSize(r,e.width,e.height)}),r.x=e.x,r.y=e.y,r.eventMode="static",r.anchor.set(.5),r.on("pointerover",()=>{r.scale.set(r.scale.x*1.1,r.scale.y*1.1)}),r.on("pointerout",()=>{r.scale.set(r.scale.x*.9,r.scale.y*.9)}),r}static adjustSpriteSize(e,t,r){const i=e.texture.width,n=e.texture.height,a=Math.min(t/i,r/n);e.scale.set(a)}}var Cn={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var $h;function Ym(){return $h||($h=1,function(s){(function(){var e=function(){this.init()};e.prototype={init:function(){var o=this||t;return o._counter=1e3,o._html5AudioPool=[],o.html5PoolSize=10,o._codecs={},o._howls=[],o._muted=!1,o._volume=1,o._canPlayEvent="canplaythrough",o._navigator=typeof window<"u"&&window.navigator?window.navigator:null,o.masterGain=null,o.noAudio=!1,o.usingWebAudio=!0,o.autoSuspend=!0,o.ctx=null,o.autoUnlock=!0,o._setup(),o},volume:function(o){var u=this||t;if(o=parseFloat(o),u.ctx||f(),typeof o<"u"&&o>=0&&o<=1){if(u._volume=o,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(o,t.ctx.currentTime);for(var d=0;d<u._howls.length;d++)if(!u._howls[d]._webAudio)for(var p=u._howls[d]._getSoundIds(),_=0;_<p.length;_++){var m=u._howls[d]._soundById(p[_]);m&&m._node&&(m._node.volume=m._volume*o)}return u}return u._volume},mute:function(o){var u=this||t;u.ctx||f(),u._muted=o,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(o?0:u._volume,t.ctx.currentTime);for(var d=0;d<u._howls.length;d++)if(!u._howls[d]._webAudio)for(var p=u._howls[d]._getSoundIds(),_=0;_<p.length;_++){var m=u._howls[d]._soundById(p[_]);m&&m._node&&(m._node.muted=o?!0:m._muted)}return u},stop:function(){for(var o=this||t,u=0;u<o._howls.length;u++)o._howls[u].stop();return o},unload:function(){for(var o=this||t,u=o._howls.length-1;u>=0;u--)o._howls[u].unload();return o.usingWebAudio&&o.ctx&&typeof o.ctx.close<"u"&&(o.ctx.close(),o.ctx=null,f()),o},codecs:function(o){return(this||t)._codecs[o.replace(/^x-/,"")]},_setup:function(){var o=this||t;if(o.state=o.ctx&&o.ctx.state||"suspended",o._autoSuspend(),!o.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(o._canPlayEvent="canplay")}catch{o.noAudio=!0}else o.noAudio=!0;try{var u=new Audio;u.muted&&(o.noAudio=!0)}catch{}return o.noAudio||o._setupCodecs(),o},_setupCodecs:function(){var o=this||t,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return o}if(!u||typeof u.canPlayType!="function")return o;var d=u.canPlayType("audio/mpeg;").replace(/^no$/,""),p=o._navigator?o._navigator.userAgent:"",_=p.match(/OPR\/(\d+)/g),m=_&&parseInt(_[0].split("/")[1],10)<33,g=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,v=p.match(/Version\/(.*?) /),y=g&&v&&parseInt(v[1],10)<15;return o._codecs={mp3:!!(!m&&(d||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},o},_unlockAudio:function(){var o=this||t;if(!(o._audioUnlocked||!o.ctx)){o._audioUnlocked=!1,o.autoUnlock=!1,!o._mobileUnloaded&&o.ctx.sampleRate!==44100&&(o._mobileUnloaded=!0,o.unload()),o._scratchBuffer=o.ctx.createBuffer(1,1,22050);var u=function(d){for(;o._html5AudioPool.length<o.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,o._releaseHtml5Audio(p)}catch{o.noAudio=!0;break}for(var _=0;_<o._howls.length;_++)if(!o._howls[_]._webAudio)for(var m=o._howls[_]._getSoundIds(),g=0;g<m.length;g++){var v=o._howls[_]._soundById(m[g]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}o._autoResume();var y=o.ctx.createBufferSource();y.buffer=o._scratchBuffer,y.connect(o.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof o.ctx.resume=="function"&&o.ctx.resume(),y.onended=function(){y.disconnect(0),o._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var w=0;w<o._howls.length;w++)o._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),o}},_obtainHtml5Audio:function(){var o=this||t;if(o._html5AudioPool.length)return o._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(o){var u=this||t;return o._unlocked&&u._html5AudioPool.push(o),u},_autoSuspend:function(){var o=this;if(!(!o.autoSuspend||!o.ctx||typeof o.ctx.suspend>"u"||!t.usingWebAudio)){for(var u=0;u<o._howls.length;u++)if(o._howls[u]._webAudio){for(var d=0;d<o._howls[u]._sounds.length;d++)if(!o._howls[u]._sounds[d]._paused)return o}return o._suspendTimer&&clearTimeout(o._suspendTimer),o._suspendTimer=setTimeout(function(){if(o.autoSuspend){o._suspendTimer=null,o.state="suspending";var p=function(){o.state="suspended",o._resumeAfterSuspend&&(delete o._resumeAfterSuspend,o._autoResume())};o.ctx.suspend().then(p,p)}},3e4),o}},_autoResume:function(){var o=this;if(!(!o.ctx||typeof o.ctx.resume>"u"||!t.usingWebAudio))return o.state==="running"&&o.ctx.state!=="interrupted"&&o._suspendTimer?(clearTimeout(o._suspendTimer),o._suspendTimer=null):o.state==="suspended"||o.state==="running"&&o.ctx.state==="interrupted"?(o.ctx.resume().then(function(){o.state="running";for(var u=0;u<o._howls.length;u++)o._howls[u]._emit("resume")}),o._suspendTimer&&(clearTimeout(o._suspendTimer),o._suspendTimer=null)):o.state==="suspending"&&(o._resumeAfterSuspend=!0),o}};var t=new e,r=function(o){var u=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(o)};r.prototype={init:function(o){var u=this;return t.ctx||f(),u._autoplay=o.autoplay||!1,u._format=typeof o.format!="string"?o.format:[o.format],u._html5=o.html5||!1,u._muted=o.mute||!1,u._loop=o.loop||!1,u._pool=o.pool||5,u._preload=typeof o.preload=="boolean"||o.preload==="metadata"?o.preload:!0,u._rate=o.rate||1,u._sprite=o.sprite||{},u._src=typeof o.src!="string"?o.src:[o.src],u._volume=o.volume!==void 0?o.volume:1,u._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:o.xhr&&o.xhr.withCredentials?o.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=o.onend?[{fn:o.onend}]:[],u._onfade=o.onfade?[{fn:o.onfade}]:[],u._onload=o.onload?[{fn:o.onload}]:[],u._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[],u._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[],u._onpause=o.onpause?[{fn:o.onpause}]:[],u._onplay=o.onplay?[{fn:o.onplay}]:[],u._onstop=o.onstop?[{fn:o.onstop}]:[],u._onmute=o.onmute?[{fn:o.onmute}]:[],u._onvolume=o.onvolume?[{fn:o.onvolume}]:[],u._onrate=o.onrate?[{fn:o.onrate}]:[],u._onseek=o.onseek?[{fn:o.onseek}]:[],u._onunlock=o.onunlock?[{fn:o.onunlock}]:[],u._onresume=[],u._webAudio=t.usingWebAudio&&!u._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var o=this,u=null;if(t.noAudio){o._emit("loaderror",null,"No audio support.");return}typeof o._src=="string"&&(o._src=[o._src]);for(var d=0;d<o._src.length;d++){var p,_;if(o._format&&o._format[d])p=o._format[d];else{if(_=o._src[d],typeof _!="string"){o._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(_),p||(p=/\.([^.]+)$/.exec(_.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&t.codecs(p)){u=o._src[d];break}}if(!u){o._emit("loaderror",null,"No codec support for selected audio sources.");return}return o._src=u,o._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(o._html5=!0,o._webAudio=!1),new i(o),o._webAudio&&a(o),o},play:function(o,u){var d=this,p=null;if(typeof o=="number")p=o,o=null;else{if(typeof o=="string"&&d._state==="loaded"&&!d._sprite[o])return null;if(typeof o>"u"&&(o="__default",!d._playLock)){for(var _=0,m=0;m<d._sounds.length;m++)d._sounds[m]._paused&&!d._sounds[m]._ended&&(_++,p=d._sounds[m]._id);_===1?o=null:p=null}}var g=p?d._soundById(p):d._inactiveSound();if(!g)return null;if(p&&!o&&(o=g._sprite||"__default"),d._state!=="loaded"){g._sprite=o,g._ended=!1;var v=g._id;return d._queue.push({event:"play",action:function(){d.play(v)}}),v}if(p&&!g._paused)return u||d._loadQueue("play"),g._id;d._webAudio&&t._autoResume();var y=Math.max(0,g._seek>0?g._seek:d._sprite[o][0]/1e3),w=Math.max(0,(d._sprite[o][0]+d._sprite[o][1])/1e3-y),T=w*1e3/Math.abs(g._rate),R=d._sprite[o][0]/1e3,b=(d._sprite[o][0]+d._sprite[o][1])/1e3;g._sprite=o,g._ended=!1;var B=function(){g._paused=!1,g._seek=y,g._start=R,g._stop=b,g._loop=!!(g._loop||d._sprite[o][2])};if(y>=b){d._ended(g);return}var N=g._node;if(d._webAudio){var U=function(){d._playLock=!1,B(),d._refreshBuffer(g);var k=g._muted||d._muted?0:g._volume;N.gain.setValueAtTime(k,t.ctx.currentTime),g._playStart=t.ctx.currentTime,typeof N.bufferSource.start>"u"?g._loop?N.bufferSource.noteGrainOn(0,y,86400):N.bufferSource.noteGrainOn(0,y,w):g._loop?N.bufferSource.start(0,y,86400):N.bufferSource.start(0,y,w),T!==1/0&&(d._endTimers[g._id]=setTimeout(d._ended.bind(d,g),T)),u||setTimeout(function(){d._emit("play",g._id),d._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?U():(d._playLock=!0,d.once("resume",U),d._clearTimer(g._id))}else{var V=function(){N.currentTime=y,N.muted=g._muted||d._muted||t._muted||N.muted,N.volume=g._volume*t.volume(),N.playbackRate=g._rate;try{var k=N.play();if(k&&typeof Promise<"u"&&(k instanceof Promise||typeof k.then=="function")?(d._playLock=!0,B(),k.then(function(){d._playLock=!1,N._unlocked=!0,u?d._loadQueue():d._emit("play",g._id)}).catch(function(){d._playLock=!1,d._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),g._ended=!0,g._paused=!0})):u||(d._playLock=!1,B(),d._emit("play",g._id)),N.playbackRate=g._rate,N.paused){d._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}o!=="__default"||g._loop?d._endTimers[g._id]=setTimeout(d._ended.bind(d,g),T):(d._endTimers[g._id]=function(){d._ended(g),N.removeEventListener("ended",d._endTimers[g._id],!1)},N.addEventListener("ended",d._endTimers[g._id],!1))}catch(z){d._emit("playerror",g._id,z)}};N.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(N.src=d._src,N.load());var C=window&&window.ejecta||!N.readyState&&t._navigator.isCocoonJS;if(N.readyState>=3||C)V();else{d._playLock=!0,d._state="loading";var M=function(){d._state="loaded",V(),N.removeEventListener(t._canPlayEvent,M,!1)};N.addEventListener(t._canPlayEvent,M,!1),d._clearTimer(g._id)}}return g._id},pause:function(o){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(o)}}),u;for(var d=u._getSoundIds(o),p=0;p<d.length;p++){u._clearTimer(d[p]);var _=u._soundById(d[p]);if(_&&!_._paused&&(_._seek=u.seek(d[p]),_._rateSeek=0,_._paused=!0,u._stopFade(d[p]),_._node))if(u._webAudio){if(!_._node.bufferSource)continue;typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),u._cleanBuffer(_._node)}else(!isNaN(_._node.duration)||_._node.duration===1/0)&&_._node.pause();arguments[1]||u._emit("pause",_?_._id:null)}return u},stop:function(o,u){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(o)}}),d;for(var p=d._getSoundIds(o),_=0;_<p.length;_++){d._clearTimer(p[_]);var m=d._soundById(p[_]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,d._stopFade(p[_]),m._node&&(d._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&d._clearSound(m._node))),u||d._emit("stop",m._id))}return d},mute:function(o,u){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(o,u)}}),d;if(typeof u>"u")if(typeof o=="boolean")d._muted=o;else return d._muted;for(var p=d._getSoundIds(u),_=0;_<p.length;_++){var m=d._soundById(p[_]);m&&(m._muted=o,m._interval&&d._stopFade(m._id),d._webAudio&&m._node?m._node.gain.setValueAtTime(o?0:m._volume,t.ctx.currentTime):m._node&&(m._node.muted=t._muted?!0:o),d._emit("mute",m._id))}return d},volume:function(){var o=this,u=arguments,d,p;if(u.length===0)return o._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var _=o._getSoundIds(),m=_.indexOf(u[0]);m>=0?p=parseInt(u[0],10):d=parseFloat(u[0])}else u.length>=2&&(d=parseFloat(u[0]),p=parseInt(u[1],10));var g;if(typeof d<"u"&&d>=0&&d<=1){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,u)}}),o;typeof p>"u"&&(o._volume=d),p=o._getSoundIds(p);for(var v=0;v<p.length;v++)g=o._soundById(p[v]),g&&(g._volume=d,u[2]||o._stopFade(p[v]),o._webAudio&&g._node&&!g._muted?g._node.gain.setValueAtTime(d,t.ctx.currentTime):g._node&&!g._muted&&(g._node.volume=d*t.volume()),o._emit("volume",g._id))}else return g=p?o._soundById(p):o._sounds[0],g?g._volume:0;return o},fade:function(o,u,d,p){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"fade",action:function(){_.fade(o,u,d,p)}}),_;o=Math.min(Math.max(0,parseFloat(o)),1),u=Math.min(Math.max(0,parseFloat(u)),1),d=parseFloat(d),_.volume(o,p);for(var m=_._getSoundIds(p),g=0;g<m.length;g++){var v=_._soundById(m[g]);if(v){if(p||_._stopFade(m[g]),_._webAudio&&!v._muted){var y=t.ctx.currentTime,w=y+d/1e3;v._volume=o,v._node.gain.setValueAtTime(o,y),v._node.gain.linearRampToValueAtTime(u,w)}_._startFadeInterval(v,o,u,d,m[g],typeof p>"u")}}return _},_startFadeInterval:function(o,u,d,p,_,m){var g=this,v=u,y=d-u,w=Math.abs(y/.01),T=Math.max(4,w>0?p/w:p),R=Date.now();o._fadeTo=d,o._interval=setInterval(function(){var b=(Date.now()-R)/p;R=Date.now(),v+=y*b,v=Math.round(v*100)/100,y<0?v=Math.max(d,v):v=Math.min(d,v),g._webAudio?o._volume=v:g.volume(v,o._id,!0),m&&(g._volume=v),(d<u&&v<=d||d>u&&v>=d)&&(clearInterval(o._interval),o._interval=null,o._fadeTo=null,g.volume(d,o._id),g._emit("fade",o._id))},T)},_stopFade:function(o){var u=this,d=u._soundById(o);return d&&d._interval&&(u._webAudio&&d._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(d._interval),d._interval=null,u.volume(d._fadeTo,o),d._fadeTo=null,u._emit("fade",o)),u},loop:function(){var o=this,u=arguments,d,p,_;if(u.length===0)return o._loop;if(u.length===1)if(typeof u[0]=="boolean")d=u[0],o._loop=d;else return _=o._soundById(parseInt(u[0],10)),_?_._loop:!1;else u.length===2&&(d=u[0],p=parseInt(u[1],10));for(var m=o._getSoundIds(p),g=0;g<m.length;g++)_=o._soundById(m[g]),_&&(_._loop=d,o._webAudio&&_._node&&_._node.bufferSource&&(_._node.bufferSource.loop=d,d&&(_._node.bufferSource.loopStart=_._start||0,_._node.bufferSource.loopEnd=_._stop,o.playing(m[g])&&(o.pause(m[g],!0),o.play(m[g],!0)))));return o},rate:function(){var o=this,u=arguments,d,p;if(u.length===0)p=o._sounds[0]._id;else if(u.length===1){var _=o._getSoundIds(),m=_.indexOf(u[0]);m>=0?p=parseInt(u[0],10):d=parseFloat(u[0])}else u.length===2&&(d=parseFloat(u[0]),p=parseInt(u[1],10));var g;if(typeof d=="number"){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,u)}}),o;typeof p>"u"&&(o._rate=d),p=o._getSoundIds(p);for(var v=0;v<p.length;v++)if(g=o._soundById(p[v]),g){o.playing(p[v])&&(g._rateSeek=o.seek(p[v]),g._playStart=o._webAudio?t.ctx.currentTime:g._playStart),g._rate=d,o._webAudio&&g._node&&g._node.bufferSource?g._node.bufferSource.playbackRate.setValueAtTime(d,t.ctx.currentTime):g._node&&(g._node.playbackRate=d);var y=o.seek(p[v]),w=(o._sprite[g._sprite][0]+o._sprite[g._sprite][1])/1e3-y,T=w*1e3/Math.abs(g._rate);(o._endTimers[p[v]]||!g._paused)&&(o._clearTimer(p[v]),o._endTimers[p[v]]=setTimeout(o._ended.bind(o,g),T)),o._emit("rate",g._id)}}else return g=o._soundById(p),g?g._rate:o._rate;return o},seek:function(){var o=this,u=arguments,d,p;if(u.length===0)o._sounds.length&&(p=o._sounds[0]._id);else if(u.length===1){var _=o._getSoundIds(),m=_.indexOf(u[0]);m>=0?p=parseInt(u[0],10):o._sounds.length&&(p=o._sounds[0]._id,d=parseFloat(u[0]))}else u.length===2&&(d=parseFloat(u[0]),p=parseInt(u[1],10));if(typeof p>"u")return 0;if(typeof d=="number"&&(o._state!=="loaded"||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,u)}}),o;var g=o._soundById(p);if(g)if(typeof d=="number"&&d>=0){var v=o.playing(p);v&&o.pause(p,!0),g._seek=d,g._ended=!1,o._clearTimer(p),!o._webAudio&&g._node&&!isNaN(g._node.duration)&&(g._node.currentTime=d);var y=function(){v&&o.play(p,!0),o._emit("seek",p)};if(v&&!o._webAudio){var w=function(){o._playLock?setTimeout(w,0):y()};setTimeout(w,0)}else y()}else if(o._webAudio){var T=o.playing(p)?t.ctx.currentTime-g._playStart:0,R=g._rateSeek?g._rateSeek-g._seek:0;return g._seek+(R+T*Math.abs(g._rate))}else return g._node.currentTime;return o},playing:function(o){var u=this;if(typeof o=="number"){var d=u._soundById(o);return d?!d._paused:!1}for(var p=0;p<u._sounds.length;p++)if(!u._sounds[p]._paused)return!0;return!1},duration:function(o){var u=this,d=u._duration,p=u._soundById(o);return p&&(d=u._sprite[p._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var o=this,u=o._sounds,d=0;d<u.length;d++)u[d]._paused||o.stop(u[d]._id),o._webAudio||(o._clearSound(u[d]._node),u[d]._node.removeEventListener("error",u[d]._errorFn,!1),u[d]._node.removeEventListener(t._canPlayEvent,u[d]._loadFn,!1),u[d]._node.removeEventListener("ended",u[d]._endFn,!1),t._releaseHtml5Audio(u[d]._node)),delete u[d]._node,o._clearTimer(u[d]._id);var p=t._howls.indexOf(o);p>=0&&t._howls.splice(p,1);var _=!0;for(d=0;d<t._howls.length;d++)if(t._howls[d]._src===o._src||o._src.indexOf(t._howls[d]._src)>=0){_=!1;break}return n&&_&&delete n[o._src],t.noAudio=!1,o._state="unloaded",o._sounds=[],o=null,null},on:function(o,u,d,p){var _=this,m=_["_on"+o];return typeof u=="function"&&m.push(p?{id:d,fn:u,once:p}:{id:d,fn:u}),_},off:function(o,u,d){var p=this,_=p["_on"+o],m=0;if(typeof u=="number"&&(d=u,u=null),u||d)for(m=0;m<_.length;m++){var g=d===_[m].id;if(u===_[m].fn&&g||!u&&g){_.splice(m,1);break}}else if(o)p["_on"+o]=[];else{var v=Object.keys(p);for(m=0;m<v.length;m++)v[m].indexOf("_on")===0&&Array.isArray(p[v[m]])&&(p[v[m]]=[])}return p},once:function(o,u,d){var p=this;return p.on(o,u,d,1),p},_emit:function(o,u,d){for(var p=this,_=p["_on"+o],m=_.length-1;m>=0;m--)(!_[m].id||_[m].id===u||o==="load")&&(setTimeout((function(g){g.call(this,u,d)}).bind(p,_[m].fn),0),_[m].once&&p.off(o,_[m].fn,_[m].id));return p._loadQueue(o),p},_loadQueue:function(o){var u=this;if(u._queue.length>0){var d=u._queue[0];d.event===o&&(u._queue.shift(),u._loadQueue()),o||d.action()}return u},_ended:function(o){var u=this,d=o._sprite;if(!u._webAudio&&o._node&&!o._node.paused&&!o._node.ended&&o._node.currentTime<o._stop)return setTimeout(u._ended.bind(u,o),100),u;var p=!!(o._loop||u._sprite[d][2]);if(u._emit("end",o._id),!u._webAudio&&p&&u.stop(o._id,!0).play(o._id),u._webAudio&&p){u._emit("play",o._id),o._seek=o._start||0,o._rateSeek=0,o._playStart=t.ctx.currentTime;var _=(o._stop-o._start)*1e3/Math.abs(o._rate);u._endTimers[o._id]=setTimeout(u._ended.bind(u,o),_)}return u._webAudio&&!p&&(o._paused=!0,o._ended=!0,o._seek=o._start||0,o._rateSeek=0,u._clearTimer(o._id),u._cleanBuffer(o._node),t._autoSuspend()),!u._webAudio&&!p&&u.stop(o._id,!0),u},_clearTimer:function(o){var u=this;if(u._endTimers[o]){if(typeof u._endTimers[o]!="function")clearTimeout(u._endTimers[o]);else{var d=u._soundById(o);d&&d._node&&d._node.removeEventListener("ended",u._endTimers[o],!1)}delete u._endTimers[o]}return u},_soundById:function(o){for(var u=this,d=0;d<u._sounds.length;d++)if(o===u._sounds[d]._id)return u._sounds[d];return null},_inactiveSound:function(){var o=this;o._drain();for(var u=0;u<o._sounds.length;u++)if(o._sounds[u]._ended)return o._sounds[u].reset();return new i(o)},_drain:function(){var o=this,u=o._pool,d=0,p=0;if(!(o._sounds.length<u)){for(p=0;p<o._sounds.length;p++)o._sounds[p]._ended&&d++;for(p=o._sounds.length-1;p>=0;p--){if(d<=u)return;o._sounds[p]._ended&&(o._webAudio&&o._sounds[p]._node&&o._sounds[p]._node.disconnect(0),o._sounds.splice(p,1),d--)}}},_getSoundIds:function(o){var u=this;if(typeof o>"u"){for(var d=[],p=0;p<u._sounds.length;p++)d.push(u._sounds[p]._id);return d}else return[o]},_refreshBuffer:function(o){var u=this;return o._node.bufferSource=t.ctx.createBufferSource(),o._node.bufferSource.buffer=n[u._src],o._panner?o._node.bufferSource.connect(o._panner):o._node.bufferSource.connect(o._node),o._node.bufferSource.loop=o._loop,o._loop&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop||0),o._node.bufferSource.playbackRate.setValueAtTime(o._rate,t.ctx.currentTime),u},_cleanBuffer:function(o){var u=this,d=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!o.bufferSource)return u;if(t._scratchBuffer&&o.bufferSource&&(o.bufferSource.onended=null,o.bufferSource.disconnect(0),d))try{o.bufferSource.buffer=t._scratchBuffer}catch{}return o.bufferSource=null,u},_clearSound:function(o){var u=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);u||(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(o){this._parent=o,this.init()};i.prototype={init:function(){var o=this,u=o._parent;return o._muted=u._muted,o._loop=u._loop,o._volume=u._volume,o._rate=u._rate,o._seek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++t._counter,u._sounds.push(o),o.create(),o},create:function(){var o=this,u=o._parent,d=t._muted||o._muted||o._parent._muted?0:o._volume;return u._webAudio?(o._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),o._node.gain.setValueAtTime(d,t.ctx.currentTime),o._node.paused=!0,o._node.connect(t.masterGain)):t.noAudio||(o._node=t._obtainHtml5Audio(),o._errorFn=o._errorListener.bind(o),o._node.addEventListener("error",o._errorFn,!1),o._loadFn=o._loadListener.bind(o),o._node.addEventListener(t._canPlayEvent,o._loadFn,!1),o._endFn=o._endListener.bind(o),o._node.addEventListener("ended",o._endFn,!1),o._node.src=u._src,o._node.preload=u._preload===!0?"auto":u._preload,o._node.volume=d*t.volume(),o._node.load()),o},reset:function(){var o=this,u=o._parent;return o._muted=u._muted,o._loop=u._loop,o._volume=u._volume,o._rate=u._rate,o._seek=0,o._rateSeek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++t._counter,o},_errorListener:function(){var o=this;o._parent._emit("loaderror",o._id,o._node.error?o._node.error.code:0),o._node.removeEventListener("error",o._errorFn,!1)},_loadListener:function(){var o=this,u=o._parent;u._duration=Math.ceil(o._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),o._node.removeEventListener(t._canPlayEvent,o._loadFn,!1)},_endListener:function(){var o=this,u=o._parent;u._duration===1/0&&(u._duration=Math.ceil(o._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(o)),o._node.removeEventListener("ended",o._endFn,!1)}};var n={},a=function(o){var u=o._src;if(n[u]){o._duration=n[u].duration,c(o);return}if(/^data:[^;]+;base64,/.test(u)){for(var d=atob(u.split(",")[1]),p=new Uint8Array(d.length),_=0;_<d.length;++_)p[_]=d.charCodeAt(_);l(p.buffer,o)}else{var m=new XMLHttpRequest;m.open(o._xhr.method,u,!0),m.withCredentials=o._xhr.withCredentials,m.responseType="arraybuffer",o._xhr.headers&&Object.keys(o._xhr.headers).forEach(function(g){m.setRequestHeader(g,o._xhr.headers[g])}),m.onload=function(){var g=(m.status+"")[0];if(g!=="0"&&g!=="2"&&g!=="3"){o._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}l(m.response,o)},m.onerror=function(){o._webAudio&&(o._html5=!0,o._webAudio=!1,o._sounds=[],delete n[u],o.load())},h(m)}},h=function(o){try{o.send()}catch{o.onerror()}},l=function(o,u){var d=function(){u._emit("loaderror",null,"Decoding audio data failed.")},p=function(_){_&&u._sounds.length>0?(n[u._src]=_,c(u,_)):d()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(o).then(p).catch(d):t.ctx.decodeAudioData(o,p,d)},c=function(o,u){u&&!o._duration&&(o._duration=u.duration),Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue())},f=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var o=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),u=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=u?parseInt(u[1],10):null;if(o&&d&&d<9){var p=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!p&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};s.Howler=t,s.Howl=r,typeof ft<"u"?(ft.HowlerGlobal=e,ft.Howler=t,ft.Howl=r,ft.Sound=i):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=r,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var i=r._howls.length-1;i>=0;i--)r._howls[i].stereo(t);return r},HowlerGlobal.prototype.pos=function(t,r,i){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(r=typeof r!="number"?n._pos[1]:r,i=typeof i!="number"?n._pos[2]:i,typeof t=="number")n._pos=[t,r,i],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(t,r,i,n,a,h){var l=this;if(!l.ctx||!l.ctx.listener)return l;var c=l._orientation;if(r=typeof r!="number"?c[1]:r,i=typeof i!="number"?c[2]:i,n=typeof n!="number"?c[3]:n,a=typeof a!="number"?c[4]:a,h=typeof h!="number"?c[5]:h,typeof t=="number")l._orientation=[t,r,i,n,a,h],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(t,r,i,n,a,h);else return c;return l},Howl.prototype.init=function(t){return function(r){var i=this;return i._orientation=r.orientation||[1,0,0],i._stereo=r.stereo||null,i._pos=r.pos||null,i._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},i._onstereo=r.onstereo?[{fn:r.onstereo}]:[],i._onpos=r.onpos?[{fn:r.onpos}]:[],i._onorientation=r.onorientation?[{fn:r.onorientation}]:[],t.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,r){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(t,r)}}),i;var n=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof t=="number")i._stereo=t,i._pos=[t,0,0];else return i._stereo;for(var a=i._getSoundIds(r),h=0;h<a.length;h++){var l=i._soundById(a[h]);if(l)if(typeof t=="number")l._stereo=t,l._pos=[t,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&e(l,n),n==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(t,0,0):l._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),i._emit("stereo",l._id);else return l._stereo}return i},Howl.prototype.pos=function(t,r,i,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(t,r,i,n)}}),a;if(r=typeof r!="number"?0:r,i=typeof i!="number"?-.5:i,typeof n>"u")if(typeof t=="number")a._pos=[t,r,i];else return a._pos;for(var h=a._getSoundIds(n),l=0;l<h.length;l++){var c=a._soundById(h[l]);if(c)if(typeof t=="number")c._pos=[t,r,i],c._node&&((!c._panner||c._panner.pan)&&e(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):c._panner.setPosition(t,r,i)),a._emit("pos",c._id);else return c._pos}return a},Howl.prototype.orientation=function(t,r,i,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(t,r,i,n)}}),a;if(r=typeof r!="number"?a._orientation[1]:r,i=typeof i!="number"?a._orientation[2]:i,typeof n>"u")if(typeof t=="number")a._orientation=[t,r,i];else return a._orientation;for(var h=a._getSoundIds(n),l=0;l<h.length;l++){var c=a._soundById(h[l]);if(c)if(typeof t=="number")c._orientation=[t,r,i],c._node&&(c._panner||(c._pos||(c._pos=a._pos||[0,0,-.5]),e(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):c._panner.setOrientation(t,r,i)),a._emit("orientation",c._id);else return c._orientation}return a},Howl.prototype.pannerAttr=function(){var t=this,r=arguments,i,n,a;if(!t._webAudio)return t;if(r.length===0)return t._pannerAttr;if(r.length===1)if(typeof r[0]=="object")i=r[0],typeof n>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),t._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:t._panningModel});else return a=t._soundById(parseInt(r[0],10)),a?a._pannerAttr:t._pannerAttr;else r.length===2&&(i=r[0],n=parseInt(r[1],10));for(var h=t._getSoundIds(n),l=0;l<h.length;l++)if(a=t._soundById(h[l]),a){var c=a._pannerAttr;c={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:c.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:c.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:c.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:c.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:c.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:c.panningModel};var f=a._panner;f||(a._pos||(a._pos=t._pos||[0,0,-.5]),e(a,"spatial"),f=a._panner),f.coneInnerAngle=c.coneInnerAngle,f.coneOuterAngle=c.coneOuterAngle,f.coneOuterGain=c.coneOuterGain,f.distanceModel=c.distanceModel,f.maxDistance=c.maxDistance,f.refDistance=c.refDistance,f.rolloffFactor=c.rolloffFactor,f.panningModel=c.panningModel}return t},Sound.prototype.init=function(t){return function(){var r=this,i=r._parent;r._orientation=i._orientation,r._stereo=i._stereo,r._pos=i._pos,r._pannerAttr=i._pannerAttr,t.call(this),r._stereo?i.stereo(r._stereo):r._pos&&i.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var r=this,i=r._parent;return r._orientation=i._orientation,r._stereo=i._stereo,r._pos=i._pos,r._pannerAttr=i._pannerAttr,r._stereo?i.stereo(r._stereo):r._pos?i.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,i._refreshBuffer(r)),t.call(this)}}(Sound.prototype.reset);var e=function(t,r){r=r||"spatial",r==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()}(Cn)),Cn}var yt=Ym();class Km extends Me{constructor(){super();he(this,"cards",[]);he(this,"stacks",[]);he(this,"cardsAmount",144);he(this,"stacksAmount",4);he(this,"stacksTopPosition",400);he(this,"minStackSpacing",100);he(this,"fpsCorrection",16.67);he(this,"cardOffset",1);he(this,"cardScale",.15);he(this,"cardImage","/images/cards/card_back.svg");he(this,"animationInterval",1e3);he(this,"animationDuration",2e3);he(this,"intervalId");he(this,"activeStackIndex",0);he(this,"audioShuffle");he(this,"audioCardMove");this.createScene(),this.createStacks(),this.createCards(),this.createUI(),this.loadAudio(),this.playShuffle(),this.waitForClick(),this.startCardAnimation()}createScene(){const t=Xr.createStyledText("Ace of Shadows",10,610);this.addChild(t)}createStacks(){this.stacks=[];const t=1200,i=(t-(this.stacksAmount+1)*this.minStackSpacing)/this.stacksAmount,n=(t-((this.stacksAmount-1)*this.minStackSpacing+this.stacksAmount*i))/2;for(let a=0;a<this.stacksAmount;a++){const h=new Me;h.x=n+a*(i+this.minStackSpacing),h.y=this.stacksTopPosition,this.stacks.push(h),this.addChild(h)}}createCards(){for(let t=0;t<this.cardsAmount;t++){const r=Le.from(this.cardImage);r.anchor.set(.5),r.scale.set(this.cardScale,this.cardScale),r.x=0,r.y=-t*this.cardOffset,r.zIndex=t,this.cards.push(r),this.stacks[0].addChild(r)}}createUI(){const t=Hi.createButtonSprite({width:50,height:50,x:300,y:500,image:"./images/ui/button_left.svg"});t.on("pointerdown",()=>this.setSpeed(this.animationInterval+200)),this.addChild(t);const r=Hi.createButtonSprite({width:50,height:50,x:360,y:500,image:"./images/ui/button_right.svg"});r.on("pointerdown",()=>this.setSpeed(this.animationInterval-200)),this.addChild(r);const i=Xr.createText("Animation speed",100,485,20,0);this.addChild(i)}loadAudio(){yt.Howler.volume(.5),this.audioShuffle=new yt.Howl({src:["./audio/chat/shuffle_cards.ogg"]}),this.audioCardMove=new yt.Howl({src:["./audio/cards/card_sound.ogg"]})}waitForClick(){window.addEventListener("focus",function(){yt.Howler.stop()})}playShuffle(){this.audioShuffle!==void 0&&this.audioShuffle.play()}setSpeed(t){t<200||t>2e3||(this.animationInterval=t,this.animationDuration=t*2,clearInterval(this.intervalId),this.startCardAnimation())}startCardAnimation(){this.intervalId=window.setInterval(()=>{this.moveTopCard()},this.animationInterval)}moveTopCard(){if(this.cards.length===0||this.stacksAmount<2)return;this.audioCardMove!==void 0&&this.audioCardMove.play();const t=this.cards.pop();t.parent&&(this.activeStackIndex++,this.activeStackIndex>=this.stacksAmount&&(this.activeStackIndex=1),this.animateCardMove(t,this.stacks[this.activeStackIndex]))}animateCardMove(t,r){const i=t.parent;if(!i)return;const n=i.toGlobal(t.position),a=r.toGlobal(new me(0,-r.children.length*2));i.removeChild(t),this.addChild(t),t.position.set(n.x,n.y);let h=0;const l=c=>{if(!t.transform)return;h+=c*this.fpsCorrection;const f=Math.min(h/this.animationDuration,1);t.x=n.x+(a.x-n.x)*f,t.y=n.y+(a.y-n.y)*f,f===1&&(Ee.shared.remove(l),r.addChild(t),t.position.set(0,-r.children.length*2))};Ee.shared.add(l)}destroy(t){this.intervalId&&clearInterval(this.intervalId),Ee.shared.stop(),this.cards.forEach(r=>r.destroy()),this.cards=[],this.stacks.forEach(r=>r.destroy()),this.stacks=[],this.audioCardMove!==void 0&&this.audioCardMove.stop(),this.audioShuffle!==void 0&&this.audioShuffle.stop(),super.destroy(t)}}class br{static async fetchData(e){const t=e;try{const r=await fetch(t);if(!r.ok)throw new Error("Failed to fetch");return await r.json()}catch{return console.warn("Can't load JSON, using local data."),{dialogue:[{name:"Sheldon",text:"I admit {satisfied} the design of Cookie Crush is quite elegant in its simplicity."},{name:"Leonard",text:"Thats practically a compliment, Sheldon. {intrigued} Are you feeling okay?"},{name:"Penny",text:"Dont worry, Leonard. Hes probably just trying to justify playing it himself."},{name:"Sheldon",text:"Incorrect. {neutral} Im studying its mechanics. The progression system is oddly satisfying."},{name:"Penny",text:"Its called fun, Sheldon. You should try it more often."},{name:"Leonard",text:"Shes got a point. Sometimes, a simple game can be relaxing."},{name:"Neighbour",text:"I fully agree {affirmative}"},{name:"Sheldon",text:"Relaxing? I suppose theres merit in low-stakes gameplay to reduce cortisol levels."},{name:"Penny",text:"Translation: Sheldon likes crushing cookies but wont admit it. {laughing}"},{name:"Sheldon",text:"Fine. I find the color-matching oddly soothing. Happy?"},{name:"Leonard",text:"Very. Now we can finally play as a team in Wordscapes."},{name:"Penny",text:"Wait, Sheldons doing team games now? Whats next, co-op decorating?"},{name:"Sheldon",text:"Unlikely. But if the design involves symmetry and efficiency, I may consider it."},{name:"Penny",text:"See? Casual gaming brings people together!"},{name:"Leonard",text:"Even Sheldon. Thats a win for everyone. {win}"},{name:"Sheldon",text:"Agreed. {neutral} Though I still maintain chess simulators are superior."},{name:"Penny",text:"Sure, Sheldon. {intrigued} You can play chess *after* we beat this next level."}],emojies:[{name:"sad",url:"https://api.dicebear.com:81/9.x/fun-emoji/png?seed=Sad"},{name:"intrigued",url:"https://api.dicebear.com/9.x/fun-emoji/png?seed=Sawyer"},{name:"neutral",url:"https://api.dicebear.com/9.x/fun-emoji/png?seed=Destiny"},{name:"satisfied",url:"https://api.dicebear.com/9.x/fun-emoji/png?seed=Jocelyn"},{name:"laughing",url:"https://api.dicebear.com/9.x/fun-emoji/png?seed=Sophia"}],avatars:[{name:"Sheldon",url:"https://api.dicebear.com/9.x/personas/png?body=squared&clothingColor=6dbb58&eyes=open&hair=buzzcut&hairColor=6c4545&mouth=smirk&nose=smallRound&skinColor=e5a07e",position:"left"},{name:"Penny",url:"https://api.dicebear.com/9.x/personas/png?body=squared&clothingColor=f55d81&eyes=happy&hair=extraLong&hairColor=f29c65&mouth=smile&nose=smallRound&skinColor=e5a07e",position:"right"},{name:"Leonard",url:"https://api.dicebear.com/9.x/personas/png?body=checkered&clothingColor=f3b63a&eyes=glasses&hair=shortCombover&hairColor=362c47&mouth=surprise&nose=mediumRound&skinColor=d78774",position:"right"}]}}}static async loadImage(e,t=3e3){return this.imageCache.has(e)?this.imageCache.get(e):new Promise(r=>{if(e===void 0)return this.defaultAvatar;const i=K.from(e),n=setTimeout(()=>{console.warn(`Image ${e} was not loaded in time`),r(this.defaultAvatar)},t);i.baseTexture.on("loaded",()=>{clearTimeout(n),this.imageCache.set(e,i),r(i)}),i.baseTexture.on("error",()=>{clearTimeout(n),console.error(`Image loading error: ${e}`),r(this.defaultAvatar)})})}}he(br,"imageCache",new Map),he(br,"defaultAvatar",K.from("./images/chat/default-avatar.svg"));const Wt=class Wt{static async createMessageBlock(e,t,r,i){const n=new Me,a=[],h=new Qe({fontSize:18,fill:"#ffffff",wordWrap:!0,wordWrapWidth:300}),l=await Wt.parseMessageContent(e,h,i);a.push(...l.elements);const c=this.createBackground(t,l.totalHeight);n.addChild(c,...a);const f=await br.loadImage(r)||Wt.defaultAvatar,o=this.createAvatar(f,t),u=new Me;return n.x=t?300:520,n.y=10,u.addChild(o,n),u}static async parseMessageContent(e,t,r){const i=[];let n=10,a=5,h=30,l=0,c=h;const f=e.split(/(<img src="([^"]+)"[^>]*>|\{(\w+)\})/g);for(const o of f){if(!o)continue;const u=o.match(/<img src="([^"]+)"/);if(u){const d=await br.loadImage(u[1])||Wt.defaultAvatar,p=new Le(d);p.width=24,p.height=24,p.x=n,p.y=a,i.push(p),n+=28,l+=40,l>300&&(n=10,a+=h,c+=h,p.x=n,p.y=a,l=40)}else if(o.startsWith("{")&&o.endsWith("}")){const d=o.slice(1,-1),p=r[d]||"",_=p?await br.loadImage(p):Wt.defaultAvatar,m=new Le(_);m.width=24,m.height=24,m.x=n,m.y=a,i.push(m),n+=28,l+=40,l>300&&(n=10,a+=h,c+=h,m.x=n,m.y=a,l=40)}else if(o.trim().length>0){const d=new $r(o,t);d.x=n,d.y=a,i.push(d),n+=d.width+5,l+=d.width,l>300&&(n=10,a+=h,c+=h,d.x=n,d.y=a,l=d.width)}}return c=Math.max(h,Math.round(l/150)*h),{elements:i,totalHeight:c}}static createBackground(e,t){const r=new Ea;return r.beginFill(e?4886754:5294200,1),r.lineStyle(2,e?3238828:3906660,1),r.drawRoundedRect(0,0,320,t+10,10),r.endFill(),r}static createAvatar(e,t){const r=new Le(e);return r.width=40,r.height=40,r.anchor.set(.5),r.x=t?250:900,r.y=30,r}};he(Wt,"defaultAvatar",K.from("./images/chat/default-avatar.svg"));let da=Wt;const Zm="https://private-624120-softgamesassignment.apiary-mock.com/v2/magicwords",Qm={chatURI:Zm};class Jm extends Me{constructor(){super();he(this,"messages");he(this,"dialogue",[]);he(this,"avatars",{});he(this,"emojiMap",{});he(this,"currentIndex",0);he(this,"loadingText");he(this,"loadingTextIntervalID");he(this,"loadingTextContent","LOADING");he(this,"loadingTextAvatars","LOADING AVATARS");he(this,"loadingTextEmojies","LOADING EMOJIES");he(this,"audioMessage");this.createScene(),this.messages=new Me,this.messages.y=580,this.addChild(this.messages),this.showLoading(this.loadingTextContent),this.loadAudio(),this.loadChatData()}createScene(){const t=Xr.createStyledText("Magic Words",10,610);this.addChild(t)}showLoading(t,r){this.loadingText=Xr.createText(t,500-(r||0),300,60,0),this.addChild(this.loadingText),this.loadingTextIntervalID=setInterval(()=>{this.loadingText&&(this.loadingText.text=this.loadingText.text+".",t.length+3<this.loadingText.text.length&&(this.loadingText.text=t))},1e3)}loadAudio(){this.audioMessage=new yt.Howl({src:["./audio/chat/message.ogg"]})}destroyLoading(){var t;clearInterval(this.loadingTextIntervalID),(t=this.loadingText)==null||t.destroy()}async loadChatData(){const t=await br.fetchData(Qm.chatURI);this.destroyLoading(),this.dialogue=t.dialogue,this.showLoading(this.loadingTextAvatars,150),this.avatars={};for(const r of t.avatars)this.avatars[r.name]=r.url;this.destroyLoading(),this.showLoading(this.loadingTextEmojies,250),this.emojiMap={};for(const r of t.emojies)this.emojiMap[r.name]=r.url;this.destroyLoading(),this.startDialogue()}startDialogue(){const t=setInterval(()=>{if(this.currentIndex>=this.dialogue.length){clearInterval(t);return}const r=this.dialogue[this.currentIndex];this.addMessage(r.name,r.text),this.currentIndex++},2e3)}async addMessage(t,r){const i=t==="Sheldon",n=await da.createMessageBlock(r,i,this.avatars[t],this.emojiMap);this.moveMessagesUp(n.height),this.messages.addChild(n),this.audioMessage!==void 0&&this.audioMessage.play()}moveMessagesUp(t){let n=t+5;const a=10;for(let h=this.messages.children.length-1;h>=0;h--){const l=this.messages.children[h];let c=n;const f=setInterval(()=>{l||clearInterval(f),c<=a&&(l.y=l.y-c,clearInterval(f)),l.y=l.y-a,c=c-a},10)}}destroy(t){this.loadingTextIntervalID&&clearInterval(this.loadingTextIntervalID),Ee.shared.stop(),this.audioMessage!==void 0&&this.audioMessage.stop(),super.destroy(t)}}class eg extends Me{constructor(){super();he(this,"particles",new Map);he(this,"particlesAmount",10);he(this,"particlesLifeTime",40);he(this,"flareImage","./images/fire/yellow_flare.png");he(this,"campFireImage","./images/fire/camp_fire_01.png");he(this,"fireTexture");he(this,"intervalId");he(this,"firePosition",{x:600,y:400});he(this,"audioFire");this.createScene(),this.createFire(),this.loadAudio(),this.playAudio(),this.startAnimation()}createScene(){const t=Xr.createStyledText("Phoenix Flame",10,610);this.addChild(t)}createFire(){this.fireTexture=K.from(this.flareImage),this.createCampfire()}createCampfire(){const t=K.from(this.campFireImage),r=new Le(t);r.scale.set(.5),r.x=this.firePosition.x,r.y=this.firePosition.y,r.anchor.set(.5),this.addChild(r)}loadAudio(){yt.Howler.volume(.5),this.audioFire=new yt.Howl({src:"./audio/fire/fire_sound.ogg",loop:!0})}playAudio(){this.audioFire!==void 0&&this.audioFire.play()}startAnimation(){this.intervalId&&clearInterval(this.intervalId),Ee.shared.add(this.updateParticles,this),this.intervalId=setInterval(()=>{this.addFireParticle()},50)}addFireParticle(){if(this.particles.size>=this.particlesAmount)return;const t=new Le(this.fireTexture);t.anchor.set(.5),t.scale.set(.3+Math.random()*.2),t.alpha=1,t.x=this.firePosition.x+(Math.random()-.5)*30,t.y=this.firePosition.y-20;const r=this.particlesLifeTime*(.7+Math.random()*.5);this.addChild(t),this.particles.set(t,r)}updateParticles(t){const r=[];for(const[i,n]of this.particles){const a=n-t;if(a<=0){r.push(i);continue}i.y-=2*t,i.x+=(Math.random()-.5)*2;const h=a/this.particlesLifeTime;i.alpha=Math.max(0,h),i.scale.set(.3+.7*h),this.particles.set(i,a)}r.forEach(i=>{this.removeChild(i),this.particles.delete(i)})}destroy(t){clearInterval(this.intervalId),Ee.shared.remove(this.updateParticles,this),this.particles.forEach((r,i)=>this.removeChild(i)),this.particles.clear(),this.audioFire!==void 0&&this.audioFire.stop(),super.destroy(t)}}class Xh{constructor(){}static enableFullscreen(){const e=document.getElementById("fullscreen-btn");e==null||e.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error(`Fullscreen error: ${t.message}`)})}),window.addEventListener("resize",()=>{document.body.style.overflow="hidden"})}static createFullscreenButton(e,t,r){const i=document.createElement("button");i.id="fullscreen-btn",i.classList.add("scene-button");const n=document.createElement("img");n.src="/images/ui/button_fullscreen.svg",n.alt="Fullscreen",n.style.width="100%",n.style.height="100%",i.appendChild(n),i.style.width=`${r}px`,i.style.height=`${r}px`,i.style.position="absolute",i.style.top=`${e}px`,i.style.right=`${t}px`,i.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(a=>{console.error(`Fullscreen error: ${a.message}`)})}),document.body.appendChild(i)}}class tg{constructor(e){he(this,"app");he(this,"currentScene",null);he(this,"topStart",80);he(this,"interval",60);he(this,"soundMuted",!1);he(this,"buttonImages",{cards:"/images/ui/button_game_cards.svg",chat:"/images/ui/button_game_chat.svg",fire:"/images/ui/button_game_fire.svg"});this.app=e,this.createUI()}changeScene(e){this.currentScene&&(this.app.stage.removeChild(this.currentScene),this.currentScene.destroy({children:!0})),e==="cards"?this.currentScene=new Km:e==="chat"?this.currentScene=new Jm:e==="fire"&&(this.currentScene=new eg),this.currentScene&&this.app.stage.addChild(this.currentScene)}createUI(){this.createFullscreenButton(),this.createSceneButtons(),this.createAudioButton()}createFullscreenButton(){Xh.createFullscreenButton(10,10,50),Xh.enableFullscreen()}createSceneButtons(){["cards","chat","fire"].forEach((t,r)=>{const i=Hi.createButtonDOM({width:50,height:50,right:10,top:this.topStart+r*this.interval,image:this.buttonImages[t]});i.addEventListener("click",()=>{this.changeScene(t)}),document.body.appendChild(i)})}createAudioButton(){const e=Hi.createButtonDOM({width:50,height:50,right:70,top:10,image:"./images/ui/button_sound.svg"}),t=e.querySelector("img");e.addEventListener("click",()=>{this.soundMuted?(this.soundMuted=!1,yt.Howler.mute(this.soundMuted),t&&(t.src="./images/ui/button_sound.svg")):(this.soundMuted=!0,yt.Howler.mute(this.soundMuted),console.log("Sound is now OFF"),t&&(t.src="./images/ui/button_sound_off.svg"))}),document.body.appendChild(e)}}var Si={exports:{}},rg=Si.exports,Vh;function ig(){return Vh||(Vh=1,function(s,e){(function(t,r){s.exports=r()})(rg,function(){var t=function(){function r(d){return a.appendChild(d.dom),d}function i(d){for(var p=0;p<a.children.length;p++)a.children[p].style.display=p===d?"block":"none";n=d}var n=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(d){d.preventDefault(),i(++n%a.children.length)},!1);var h=(performance||Date).now(),l=h,c=0,f=r(new t.Panel("FPS","#0ff","#002")),o=r(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=r(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:a,addPanel:r,showPanel:i,begin:function(){h=(performance||Date).now()},end:function(){c++;var d=(performance||Date).now();if(o.update(d-h,200),d>l+1e3&&(f.update(1e3*c/(d-l),100),l=d,c=0,u)){var p=performance.memory;u.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){h=this.end()},domElement:a,setMode:i}};return t.Panel=function(r,i,n){var a=1/0,h=0,l=Math.round,c=l(window.devicePixelRatio||1),f=80*c,o=48*c,u=3*c,d=2*c,p=3*c,_=15*c,m=74*c,g=30*c,v=document.createElement("canvas");v.width=f,v.height=o,v.style.cssText="width:80px;height:48px";var y=v.getContext("2d");return y.font="bold "+9*c+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,f,o),y.fillStyle=i,y.fillText(r,u,d),y.fillRect(p,_,m,g),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(p,_,m,g),{dom:v,update:function(w,T){a=Math.min(a,w),h=Math.max(h,w),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,f,_),y.fillStyle=i,y.fillText(l(w)+" "+r+" ("+l(a)+"-"+l(h)+")",u,d),y.drawImage(v,p+c,_,m-c,g,p,_,m-c,g),y.fillRect(p+m-c,_,c,g),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(p+m-c,_,c,l((1-w/T)*g))}}},t})}(Si)),Si.exports}var sg=ig();const ng=pa(sg);class ag{constructor(){he(this,"stats");this.stats=new ng,this.stats.showPanel(0),this.stats.dom.style.position="absolute",this.stats.dom.style.top="10px",this.stats.dom.style.left="10px",this.stats.dom.style.zIndex="100",document.body.appendChild(this.stats.dom)}startTracking(e){e.add(()=>{this.stats.begin(),this.stats.end()})}}var _i={},Wh;function og(){if(Wh)return _i;Wh=1,_i.generatePerlinNoise=s,_i.generateWhiteNoise=e;function s(r,i,n){n=n||{};var a=n.octaveCount||4,h=n.amplitude||.1,l=n.persistence||.2,c=e(r,i),f=new Array(a),o;for(o=0;o<a;++o)f[o]=_(o);var u=new Array(r*i),d=0;for(o=a-1;o>=0;--o){h*=l,d+=h;for(var p=0;p<u.length;++p)u[p]=u[p]||0,u[p]+=f[o][p]*h}for(o=0;o<u.length;++o)u[o]/=d;return u;function _(m){for(var g=new Array(r*i),v=Math.pow(2,m),y=1/v,w=0,T=0;T<i;++T)for(var R=Math.floor(T/v)*v,b=(R+v)%i,B=(T-R)*y,N=0;N<r;++N){var U=Math.floor(N/v)*v,V=(U+v)%r,C=(N-U)*y,M=t(c[R*r+U],c[b*r+U],B),k=t(c[R*r+V],c[b*r+V],B);g[w]=t(M,k,C),w+=1}return g}}function e(r,i){for(var n=new Array(r*i),a=0;a<n.length;++a)n[a]=Math.random();return n}function t(r,i,n){return r*(1-n)+n*i}return _i}var hg=og();function lg(s,e){const t=document.createElement("canvas");t.width=s,t.height=e;const r=t.getContext("2d");if(!r)throw new Error("Could not get 2D context for Perlin noise texture");const i=hg.generatePerlinNoise(s,e).flat(),n={r:250,g:250,b:250},a={r:235,g:235,b:235},h=r.createImageData(s,e);for(let l=0;l<i.length;l++){const c=i[l],f=Math.floor(n.r+(a.r-n.r)*c),o=Math.floor(n.g+(a.g-n.g)*c),u=Math.floor(n.b+(a.b-n.b)*c);h.data[l*4]=f,h.data[l*4+1]=o,h.data[l*4+2]=u,h.data[l*4+3]=255}return r.putImageData(h,0,0),K.from(t)}const qe=1200,pr=16/9,Er=new Zl({width:qe,height:qe/pr});document.body.appendChild(Er.view);const ug=lg(qe,qe/pr),cg=new Le(ug);Er.stage.addChild(cg);function xu(s){const e=window.innerWidth,t=window.innerHeight;let r=e/qe;r*(qe/pr)>t&&(r=t/(qe/pr));const i=s.view;i.style.width=`${qe*r}px`,i.style.height=`${qe/pr*r}px`,i.style.position="absolute",i.style.left=`${(e-qe*r)/2}px`,i.style.top=`${(t-qe/pr*r)/2}px`}xu(Er);window.addEventListener("resize",()=>requestAnimationFrame(()=>xu(Er)));const dg=new ag;dg.startTracking(Er.ticker);const fg=new tg(Er);fg.changeScene("cards");
